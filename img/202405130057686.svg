<svg id="SvgjsSvg1006" width="713.5" height="689" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1007"><pattern patternUnits="userSpaceOnUse" id="pattern_mark_0" width="300" height="300"><text x="150" y="100" fill="rgba(229,229,229,0.8)" font-size="18" transform="rotate(-45, 150, 150)" style="dominant-baseline: middle; text-anchor: middle;"></text></pattern><pattern patternUnits="userSpaceOnUse" id="pattern_mark_1" width="300" height="300"><text x="150" y="200" fill="rgba(229,229,229,0.8)" font-size="18" transform="rotate(-45, 150, 150)" style="dominant-baseline: middle; text-anchor: middle;"></text></pattern></defs><rect id="svgbackgroundid" width="713.5" height="689" fill="transparent"></rect><rect id="SvgjsRect1009" width="713.5" height="689" fill="url(#pattern_mark_0)"></rect><rect id="SvgjsRect1010" width="713.5" height="689" fill="url(#pattern_mark_1)"></rect><g id="SvgjsG1011" transform="translate(25,25)"><path id="SvgjsPath1012" d="M0 0L331.5 0L331.5 26.4546 L0 26.4546Z" stroke="rgba(183,191,174,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1013" d="M331.5 0L663 0L663 26.4546 L331.5 26.4546Z" stroke="rgba(183,191,174,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1014" d="M0 26.4546L331.5 26.4546L331.5 88.5654 L0 88.5654Z" stroke="rgba(183,191,174,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1015" d="M331.5 26.4546L663 26.4546L663 88.5654 L331.5 88.5654Z" stroke="rgba(183,191,174,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1016" d="M0 88.50150000000001L331.5 88.50150000000001L331.5 474.5853 L0 474.5853Z" stroke="rgba(183,191,174,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1017" d="M331.5 88.50150000000001L663 88.50150000000001L663 474.5853 L331.5 474.5853Z" stroke="rgba(183,191,174,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1018" d="M0 474.5853L331.5 474.5853L331.5 639 L0 639Z" stroke="rgba(183,191,174,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1019" d="M331.5 474.5853L663 474.5853L663 639 L331.5 639Z" stroke="rgba(183,191,174,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1020"><text id="SvgjsText1021" font-family="&quot;Comic Sans MS&quot;" text-anchor="start" font-size="12px" width="332px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="&quot;Comic Sans MS&quot;" size="12px" weight="400" font-style="" opacity="1" y="-2.5" transform="rotate(0)"><tspan id="SvgjsTspan1022" dy="15" x="0"><tspan id="SvgjsTspan1023" style="">session_1</tspan></tspan></text></g><g id="SvgjsG1024"><text id="SvgjsText1025" font-family="&quot;Comic Sans MS&quot;" text-anchor="start" font-size="12px" width="332px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="&quot;Comic Sans MS&quot;" size="12px" weight="400" font-style="" opacity="1" y="-2.5" transform="rotate(0)"><tspan id="SvgjsTspan1026" dy="15" x="331.5"><tspan id="SvgjsTspan1027" style="">session_2</tspan></tspan></text></g><g id="SvgjsG1028"><text id="SvgjsText1029" font-family="&quot;Comic Sans MS&quot;" text-anchor="start" font-size="12px" width="332px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="&quot;Comic Sans MS&quot;" size="12px" weight="400" font-style="" opacity="1" y="23.9546" transform="rotate(0)"><tspan id="SvgjsTspan1030" dy="15" x="0"><tspan id="SvgjsTspan1031" style="">获得表 mylock 的 WRITE 锁定</tspan></tspan><tspan id="SvgjsTspan1032" dy="15" x="0"><tspan id="SvgjsTspan1033" style="">mysql&gt; LOCK TABLE mylock WRITE;</tspan></tspan><tspan id="SvgjsTspan1034" dy="15" x="0"><tspan id="SvgjsTspan1035" style="">Query OK, 0 rows affected (0.02 sec)</tspan></tspan></text></g><g id="SvgjsG1036"><text id="SvgjsText1037" font-family="&quot;Comic Sans MS&quot;" text-anchor="start" font-size="12px" width="332px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="&quot;Comic Sans MS&quot;" size="12px" weight="400" font-style="" opacity="1" y="23.9546" transform="rotate(0)"><tspan id="SvgjsTspan1038" dy="15" x="331.5"><tspan id="SvgjsTspan1039" style="">待 session_1 开启写锁之后，session_2再连接终端</tspan></tspan></text></g><g id="SvgjsG1040"><text id="SvgjsText1041" font-family="&quot;Comic Sans MS&quot;" text-anchor="start" font-size="12px" width="332px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="&quot;Comic Sans MS&quot;" size="12px" weight="400" font-style="" opacity="1" y="86.00150000000001" transform="rotate(0)"><tspan id="SvgjsTspan1042" dy="15" x="0"><tspan id="SvgjsTspan1043" style="">当前 session 对锁定表的查询+更新+插入操作都可以执行：</tspan></tspan><tspan id="SvgjsTspan1044" dy="15" x="0"><tspan id="SvgjsTspan1045" style="">mysql&gt; SELECT * FROM mylock WHERE id = 1;</tspan></tspan><tspan id="SvgjsTspan1046" dy="15" x="0"><tspan id="SvgjsTspan1047" style="">+----+------+</tspan></tspan><tspan id="SvgjsTspan1048" dy="15" x="0"><tspan id="SvgjsTspan1049" style="">| id | name |</tspan></tspan><tspan id="SvgjsTspan1050" dy="15" x="0"><tspan id="SvgjsTspan1051" style="">+----+------+</tspan></tspan><tspan id="SvgjsTspan1052" dy="15" x="0"><tspan id="SvgjsTspan1053" style="">|  1 | s    |</tspan></tspan><tspan id="SvgjsTspan1054" dy="15" x="0"><tspan id="SvgjsTspan1055" style="">+----+------+</tspan></tspan><tspan id="SvgjsTspan1056" dy="15" x="0"><tspan id="SvgjsTspan1057" style="">1 row in set (0.01 sec)</tspan></tspan><tspan id="SvgjsTspan1058" dy="15" x="0"><tspan id="SvgjsTspan1059" style=""> </tspan></tspan><tspan id="SvgjsTspan1060" dy="15" x="0"><tspan id="SvgjsTspan1061" style="">mysql&gt; UPDATE mylock SET name = 'a2' WHERE id = 1;</tspan></tspan><tspan id="SvgjsTspan1062" dy="15" x="0"><tspan id="SvgjsTspan1063" style="">Query OK, 1 row affected (0.02 sec)</tspan></tspan><tspan id="SvgjsTspan1064" dy="15" x="0"><tspan id="SvgjsTspan1065" style="">Rows matched: 1  Changed: 1  Warnings: 0</tspan></tspan><tspan id="SvgjsTspan1066" dy="15" x="0"><tspan id="SvgjsTspan1067" style=""> </tspan></tspan><tspan id="SvgjsTspan1068" dy="15" x="0"><tspan id="SvgjsTspan1069" style="">mysql&gt; INSERT INTO mylock(name) VALUES('f');</tspan></tspan><tspan id="SvgjsTspan1070" dy="15" x="0"><tspan id="SvgjsTspan1071" style="">Query OK, 1 row affected (0.01 sec)</tspan></tspan><tspan id="SvgjsTspan1072" dy="15" x="0"><tspan id="SvgjsTspan1073" style=""> </tspan></tspan><tspan id="SvgjsTspan1074" dy="15" x="0"><tspan id="SvgjsTspan1075" style="">mysql&gt; SELECT * FROM mylock;</tspan></tspan><tspan id="SvgjsTspan1076" dy="15" x="0"><tspan id="SvgjsTspan1077" style="">+----+------+</tspan></tspan><tspan id="SvgjsTspan1078" dy="15" x="0"><tspan id="SvgjsTspan1079" style="">| id | name |</tspan></tspan><tspan id="SvgjsTspan1080" dy="15" x="0"><tspan id="SvgjsTspan1081" style="">+----+------+</tspan></tspan><tspan id="SvgjsTspan1082" dy="15" x="0"><tspan id="SvgjsTspan1083" style="">|  1 | a2   |</tspan></tspan><tspan id="SvgjsTspan1084" dy="15" x="0"><tspan id="SvgjsTspan1085" style="">|  2 | e    |</tspan></tspan><tspan id="SvgjsTspan1086" dy="15" x="0"><tspan id="SvgjsTspan1087" style="">|  3 | f    |</tspan></tspan><tspan id="SvgjsTspan1088" dy="15" x="0"><tspan id="SvgjsTspan1089" style="">+----+------+</tspan></tspan><tspan id="SvgjsTspan1090" dy="15" x="0"><tspan id="SvgjsTspan1091" style="">3 rows in set (0.02 sec)</tspan></tspan></text></g><g id="SvgjsG1092"><text id="SvgjsText1093" font-family="&quot;Comic Sans MS&quot;" text-anchor="start" font-size="12px" width="332px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="&quot;Comic Sans MS&quot;" size="12px" weight="400" font-style="" opacity="1" y="86.00150000000001" transform="rotate(0)"><tspan id="SvgjsTspan1094" dy="15" x="331.5"><tspan id="SvgjsTspan1095" style="">其它 session 对锁定表的查询被阻塞，需要等待锁被释放：</tspan></tspan><tspan id="SvgjsTspan1096" dy="15" x="331.5"><tspan id="SvgjsTspan1097" style="">mysql&gt; SELECT * FROM mylock;</tspan></tspan><tspan id="SvgjsTspan1098" dy="15" x="331.5"><tspan id="SvgjsTspan1099" style=""> </tspan></tspan><tspan id="SvgjsTspan1100" dy="15" x="331.5"><tspan id="SvgjsTspan1101" style="">在锁表前，如果 session_2 有数据缓存，锁表以后，在锁住的</tspan></tspan><tspan id="SvgjsTspan1102" dy="15" x="331.5"><tspan id="SvgjsTspan1103" style="">表不发生改变的情况下 session2 可以读出缓存数据，一旦数据</tspan></tspan><tspan id="SvgjsTspan1104" dy="15" x="331.5"><tspan id="SvgjsTspan1105" style="">发生改变，缓存将失效，操作将被阻塞住。（mysq1 8没有缓</tspan></tspan><tspan id="SvgjsTspan1106" dy="15" x="331.5"><tspan id="SvgjsTspan1107" style="">存）</tspan></tspan></text></g><g id="SvgjsG1108"><text id="SvgjsText1109" font-family="&quot;Comic Sans MS&quot;" text-anchor="start" font-size="12px" width="332px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="&quot;Comic Sans MS&quot;" size="12px" weight="400" font-style="" opacity="1" y="472.0853" transform="rotate(0)"><tspan id="SvgjsTspan1110" dy="15" x="0"><tspan id="SvgjsTspan1111" style="">释放锁：</tspan></tspan><tspan id="SvgjsTspan1112" dy="15" x="0"><tspan id="SvgjsTspan1113" style="">mysql&gt; UNLOCK TABLES;</tspan></tspan><tspan id="SvgjsTspan1114" dy="15" x="0"><tspan id="SvgjsTspan1115" style="">Query OK, 0 rows affected (0.00 sec)</tspan></tspan></text></g><g id="SvgjsG1116"><text id="SvgjsText1117" font-family="&quot;Comic Sans MS&quot;" text-anchor="start" font-size="12px" width="332px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="&quot;Comic Sans MS&quot;" size="12px" weight="400" font-style="" opacity="1" y="472.0853" transform="rotate(0)"><tspan id="SvgjsTspan1118" dy="15" x="331.5"><tspan id="SvgjsTspan1119" style="">session_2获得锁，查询返回：</tspan></tspan><tspan id="SvgjsTspan1120" dy="15" x="331.5"><tspan id="SvgjsTspan1121" style="">mysql&gt; SELECT * FROM mylock;</tspan></tspan><tspan id="SvgjsTspan1122" dy="15" x="331.5"><tspan id="SvgjsTspan1123" style="">+----+------+</tspan></tspan><tspan id="SvgjsTspan1124" dy="15" x="331.5"><tspan id="SvgjsTspan1125" style="">| id | name |</tspan></tspan><tspan id="SvgjsTspan1126" dy="15" x="331.5"><tspan id="SvgjsTspan1127" style="">+----+------+</tspan></tspan><tspan id="SvgjsTspan1128" dy="15" x="331.5"><tspan id="SvgjsTspan1129" style="">|  1 | a2   |</tspan></tspan><tspan id="SvgjsTspan1130" dy="15" x="331.5"><tspan id="SvgjsTspan1131" style="">|  2 | e    |</tspan></tspan><tspan id="SvgjsTspan1132" dy="15" x="331.5"><tspan id="SvgjsTspan1133" style="">|  3 | f    |</tspan></tspan><tspan id="SvgjsTspan1134" dy="15" x="331.5"><tspan id="SvgjsTspan1135" style="">+----+------+</tspan></tspan><tspan id="SvgjsTspan1136" dy="15" x="331.5"><tspan id="SvgjsTspan1137" style="">3 rows in set (1 min 5.61 sec)</tspan></tspan></text></g></g><g id="SvgjsG1138"></g></svg>