<svg id="SvgjsSvg1006" width="1114.01270272" height="207.7256727272727" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1007"><pattern patternUnits="userSpaceOnUse" id="pattern_mark_0" width="300" height="300"><text x="150" y="100" fill="rgba(229,229,229,0.8)" font-size="18" transform="rotate(-45, 150, 150)" style="dominant-baseline: middle; text-anchor: middle;"></text></pattern><pattern patternUnits="userSpaceOnUse" id="pattern_mark_1" width="300" height="300"><text x="150" y="200" fill="rgba(229,229,229,0.8)" font-size="18" transform="rotate(-45, 150, 150)" style="dominant-baseline: middle; text-anchor: middle;"></text></pattern></defs><rect id="svgbackgroundid" width="1114.01270272" height="207.7256727272727" fill="transparent"></rect><rect id="SvgjsRect1009" width="1114.01270272" height="207.7256727272727" fill="url(#pattern_mark_0)"></rect><rect id="SvgjsRect1010" width="1114.01270272" height="207.7256727272727" fill="url(#pattern_mark_1)"></rect><g id="SvgjsG1011" transform="translate(25,25)"><path id="SvgjsPath1012" d="M0 0L120.01270272 0L120.01270272 45.99280616727271 L0 45.99280616727271Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#e9d66f"></path><path id="SvgjsPath1013" d="M120.01270272 0L1063.9424 0L1063.9424 45.99280616727271 L120.01270272 45.99280616727271Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1014" d="M0 45.99280616727271L120.01270272 45.99280616727271L120.01270272 103.73617495272723 L0 103.73617495272723Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#e9d66f"></path><path id="SvgjsPath1015" d="M120.01270272 45.99280616727271L1063.9424 45.99280616727271L1063.9424 103.73617495272723 L120.01270272 103.73617495272723Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><path id="SvgjsPath1016" d="M0 103.7204023854545L120.01270272 103.7204023854545L120.01270272 157.72567272727267 L0 157.72567272727267Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#e9d66f"></path><path id="SvgjsPath1017" d="M120.01270272 103.7204023854545L1063.9424 103.7204023854545L1063.9424 157.72567272727267 L120.01270272 157.72567272727267Z" stroke="rgba(102, 102, 102,1)" stroke-width="1" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1018"><text id="SvgjsText1019" font-family="&quot;Comic Sans MS&quot;" text-anchor="middle" font-size="16px" width="121px" fill="#323232" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="&quot;Comic Sans MS&quot;" size="16px" weight="700" font-style="" opacity="1" y="8.996403083636356" transform="rotate(0)"><tspan id="SvgjsTspan1020" dy="20" x="60.5"><tspan id="SvgjsTspan1021" style="">int</tspan></tspan></text></g><g id="SvgjsG1022"><text id="SvgjsText1023" font-family="&quot;Comic Sans MS&quot;" text-anchor="start" font-size="16px" width="944px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="&quot;Comic Sans MS&quot;" size="16px" weight="400" font-style="" opacity="1" y="8.996403083636356" transform="rotate(0)"><tspan id="SvgjsTspan1024" dy="20" x="120.01270272"><tspan id="SvgjsTspan1025" style="">Long类型整数时，redisObject中的ptr指针直接赋值为整数数据，不再额外的指针再指向整数了，节省了指针的空间开销。</tspan></tspan></text></g><g id="SvgjsG1026"><text id="SvgjsText1027" font-family="&quot;Comic Sans MS&quot;" text-anchor="middle" font-size="16px" width="121px" fill="#323232" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="&quot;Comic Sans MS&quot;" size="16px" weight="700" font-style="" opacity="1" y="60.86449055999998" transform="rotate(0)"><tspan id="SvgjsTspan1028" dy="20" x="60.5"><tspan id="SvgjsTspan1029" style="">embstr</tspan></tspan></text></g><g id="SvgjsG1030"><text id="SvgjsText1031" font-family="&quot;Comic Sans MS&quot;" text-anchor="start" font-size="16px" width="944px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="&quot;Comic Sans MS&quot;" size="16px" weight="400" font-style="" opacity="1" y="50.86449055999997" transform="rotate(0)"><tspan id="SvgjsTspan1032" dy="20" x="120.01270272"><tspan id="SvgjsTspan1033" style="">当保存的是字符串数据且字符串小于等于44字节时，embstr类型将会调用内存分配函数，</tspan><tspan id="SvgjsTspan1034" style="fill: rgb(167, 147, 44);">只分配一块连续的内存空间</tspan><tspan id="SvgjsTspan1035" style="">，空间中依次包</tspan></tspan><tspan id="SvgjsTspan1036" dy="20" x="120.01270272"><tspan id="SvgjsTspan1037" style="">含 redisObject 与 </tspan><tspan id="SvgjsTspan1038" style="fill: rgb(167, 147, 44);">sdshdr</tspan><tspan id="SvgjsTspan1039" style=""> 两个数据结构，让元数据、指针和SDS是一块连续的内存区域，这样就可以避免内存碎片</tspan></tspan></text></g><g id="SvgjsG1040"><text id="SvgjsText1041" font-family="&quot;Comic Sans MS&quot;" text-anchor="middle" font-size="16px" width="121px" fill="#323232" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="&quot;Comic Sans MS&quot;" size="16px" weight="700" font-style="" opacity="1" y="116.72303755636358" transform="rotate(0)"><tspan id="SvgjsTspan1042" dy="20" x="60.5"><tspan id="SvgjsTspan1043" style="">raw</tspan></tspan></text></g><g id="SvgjsG1044"><text id="SvgjsText1045" font-family="&quot;Comic Sans MS&quot;" text-anchor="start" font-size="16px" width="944px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="&quot;Comic Sans MS&quot;" size="16px" weight="400" font-style="" opacity="1" y="106.72303755636358" transform="rotate(0)"><tspan id="SvgjsTspan1046" dy="20" x="120.01270272"><tspan id="SvgjsTspan1047" style="">当字符串大于44字节时，SDS的数据量变多变大了，SDS和redisObject布局分家各自过，会给SDS分配多的空间并用指针指向SDS</tspan></tspan><tspan id="SvgjsTspan1048" dy="20" x="120.01270272"><tspan id="SvgjsTspan1049" style="">结构，raw 类型将会</tspan><tspan id="SvgjsTspan1050" style="fill: rgb(167, 147, 44);">调用两次内存分配函数</tspan><tspan id="SvgjsTspan1051" style="">，分配两块内存空间，一块用于包含 redisObject结构，而另一块用于包含 sdshdr 结构</tspan></tspan></text></g></g></svg>