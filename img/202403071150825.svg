<svg id="SvgjsSvg4242" width="1317.9024390243903" height="696.0426829268289" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs4243"><pattern patternUnits="userSpaceOnUse" id="pattern_mark_0" width="300" height="300"><text x="150" y="100" fill="rgba(229,229,229,0.8)" font-size="18" transform="rotate(-45, 150, 150)" style="dominant-baseline: middle; text-anchor: middle;"></text></pattern><pattern patternUnits="userSpaceOnUse" id="pattern_mark_1" width="300" height="300"><text x="150" y="200" fill="rgba(229,229,229,0.8)" font-size="18" transform="rotate(-45, 150, 150)" style="dominant-baseline: middle; text-anchor: middle;"></text></pattern></defs><rect id="svgbackgroundid" width="1317.9024390243903" height="696.0426829268289" fill="transparent"></rect><rect id="SvgjsRect4245" width="1317.9024390243903" height="696.0426829268289" fill="url(#pattern_mark_0)"></rect><rect id="SvgjsRect4246" width="1317.9024390243903" height="696.0426829268289" fill="url(#pattern_mark_1)"></rect><g id="SvgjsG4247" transform="translate(25,94.73170731707319)"><path id="SvgjsPath4248" d="M 0 0L 603.6585365853659 0L 603.6585365853659 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG4249"><text id="SvgjsText4250" font-family="微软雅黑" text-anchor="middle" font-size="25px" width="604px" fill="#323232" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="25px" weight="700" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan4251" dy="31.25" x="302"><tspan id="SvgjsTspan4252" style="">volatile 写之前的操作，都禁止重排序到 volatile 之后</tspan></tspan></text></g></g><g id="SvgjsG4253" transform="translate(688.9024390243903,94.73170731707319)"><path id="SvgjsPath4254" d="M 0 0L 603.6585365853659 0L 603.6585365853659 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG4255"><text id="SvgjsText4256" font-family="微软雅黑" text-anchor="middle" font-size="25px" width="604px" fill="#323232" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="25px" weight="700" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan4257" dy="31.25" x="302"><tspan id="SvgjsTspan4258" style="">volatile 读之后的操作，都禁止重排序到 volatile 之前</tspan></tspan></text></g></g><g id="SvgjsG4259"><path id="SvgjsPath4260" d="M662.8048780487807 97.17073170731712L662.8048780487807 333.39024390243907L662.8048780487807 333.39024390243907L662.8048780487807 569.6097560975611" stroke="#a7932c" stroke-width="5" fill="none"></path></g><g id="SvgjsG4261" transform="translate(41.63414634146342,180.41463414634148)"><path id="SvgjsPath4262" d="M 0 0L 174.8292682926829 0L 174.8292682926829 40.414634146341484L 0 40.414634146341484Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#7985ec"></path><g id="SvgjsG4263"><text id="SvgjsText4264" font-family="微软雅黑" text-anchor="middle" font-size="19px" width="155px" fill="#ffffff" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="19px" weight="700" font-style="" opacity="1" y="3.832317073170742" transform="rotate(0)"><tspan id="SvgjsTspan4265" dy="23.75" x="87.5"><tspan id="SvgjsTspan4266" style="">i = 2</tspan></tspan></text></g></g><g id="SvgjsG4267" transform="translate(41.63414634146342,285.7804878048781)"><path id="SvgjsPath4268" d="M 0 0L 174.8292682926829 0L 174.8292682926829 40.414634146341484L 0 40.414634146341484Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e0c431"></path><g id="SvgjsG4269"><text id="SvgjsText4270" font-family="微软雅黑" text-anchor="middle" font-size="19px" width="155px" fill="#ffffff" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="19px" weight="700" font-style="" opacity="1" y="3.832317073170742" transform="rotate(0)"><tspan id="SvgjsTspan4271" dy="23.75" x="87.5"><tspan id="SvgjsTspan4272" style="">StoreStore屏障</tspan></tspan></text></g></g><g id="SvgjsG4273" transform="translate(41.63414634146345,391.1463414634147)"><path id="SvgjsPath4274" d="M 0 0L 174.8292682926829 0L 174.8292682926829 40.414634146341484L 0 40.414634146341484Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#a23735"></path><g id="SvgjsG4275"><text id="SvgjsText4276" font-family="微软雅黑" text-anchor="middle" font-size="19px" width="155px" fill="#ffffff" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="19px" weight="700" font-style="" opacity="1" y="3.832317073170742" transform="rotate(0)"><tspan id="SvgjsTspan4277" dy="23.75" x="87.5"><tspan id="SvgjsTspan4278" style="">flag = true</tspan></tspan></text></g></g><g id="SvgjsG4279" transform="translate(41.63414634146342,496.51219512195127)"><path id="SvgjsPath4280" d="M 0 0L 174.8292682926829 0L 174.8292682926829 40.414634146341484L 0 40.414634146341484Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e0c431"></path><g id="SvgjsG4281"><text id="SvgjsText4282" font-family="微软雅黑" text-anchor="middle" font-size="19px" width="155px" fill="#ffffff" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="19px" weight="700" font-style="" opacity="1" y="3.832317073170742" transform="rotate(0)"><tspan id="SvgjsTspan4283" dy="23.75" x="87.5"><tspan id="SvgjsTspan4284" style="">StoreLoad屏障</tspan></tspan></text></g></g><g id="SvgjsG4285" transform="translate(251.8292682926829,180.62195121951223)"><path id="SvgjsPath4286" d="M 0 0L 100 0L 100 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG4287"><text id="SvgjsText4288" font-family="微软雅黑" text-anchor="start" font-size="19px" width="100px" fill="#7985ec" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="19px" weight="400" font-style="" opacity="1" y="3.625" transform="rotate(0)"><tspan id="SvgjsTspan4289" dy="23.75" x="0"><tspan id="SvgjsTspan4290" style="">普通写</tspan></tspan></text></g></g><g id="SvgjsG4291" transform="translate(251.8292682926829,281.61280487804885)"><path id="SvgjsPath4292" d="M 0 0L 201.21951219512198 0L 201.21951219512198 48.75L 0 48.75Z" stroke="none" fill="none"></path><g id="SvgjsG4293"><text id="SvgjsText4294" font-family="微软雅黑" text-anchor="start" font-size="19px" width="202px" fill="#e0c331" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="19px" weight="400" font-style="" opacity="1" y="-4" transform="rotate(0)"><tspan id="SvgjsTspan4295" dy="23.75" x="0"><tspan id="SvgjsTspan4296" style="">禁止上面的普通写与下</tspan></tspan><tspan id="SvgjsTspan4297" dy="23.75" x="0"><tspan id="SvgjsTspan4298" style="">面的 volatile写重排序</tspan></tspan></text></g></g><g id="SvgjsG4299" transform="translate(251.8292682926829,391.35365853658544)"><path id="SvgjsPath4300" d="M 0 0L 100 0L 100 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG4301"><text id="SvgjsText4302" font-family="微软雅黑" text-anchor="start" font-size="19px" width="100px" fill="#a23735" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="19px" weight="400" font-style="" opacity="1" y="3.625" transform="rotate(0)"><tspan id="SvgjsTspan4303" dy="23.75" x="0"><tspan id="SvgjsTspan4304" style="">volatile写</tspan></tspan></text></g></g><g id="SvgjsG4305" transform="translate(251.8292682926829,496.719512195122)"><path id="SvgjsPath4306" d="M 0 0L 237.80487804878055 0L 237.80487804878055 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG4307"><text id="SvgjsText4308" font-family="微软雅黑" text-anchor="start" font-size="19px" width="238px" fill="#e0c331" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="19px" weight="400" font-style="" opacity="1" y="-19.875" transform="rotate(0)"><tspan id="SvgjsTspan4309" dy="23.75" x="0"><tspan id="SvgjsTspan4310" style="">禁止上面的volatile写与下面</tspan></tspan><tspan id="SvgjsTspan4311" dy="23.75" x="0"><tspan id="SvgjsTspan4312" style="">可能有的volatile读/写重排</tspan></tspan><tspan id="SvgjsTspan4313" dy="23.75" x="0"><tspan id="SvgjsTspan4314" style="">序</tspan></tspan></text></g></g><g id="SvgjsG4315" transform="translate(1028.7073170731708,180.62195121951223)"><path id="SvgjsPath4316" d="M 0 0L 174.8292682926829 0L 174.8292682926829 40.414634146341484L 0 40.414634146341484Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#a23735"></path><g id="SvgjsG4317"><text id="SvgjsText4318" font-family="微软雅黑" text-anchor="middle" font-size="19px" width="155px" fill="#ffffff" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="19px" weight="700" font-style="" opacity="1" y="3.832317073170742" transform="rotate(0)"><tspan id="SvgjsTspan4319" dy="23.75" x="87.5"><tspan id="SvgjsTspan4320" style="">if(flag)</tspan></tspan></text></g></g><g id="SvgjsG4321" transform="translate(1028.7073170731708,285.9878048780483)"><path id="SvgjsPath4322" d="M 0 0L 174.8292682926829 0L 174.8292682926829 40.414634146341484L 0 40.414634146341484Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e0c431"></path><g id="SvgjsG4323"><text id="SvgjsText4324" font-family="微软雅黑" text-anchor="middle" font-size="19px" width="155px" fill="#ffffff" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="19px" weight="700" font-style="" opacity="1" y="3.832317073170742" transform="rotate(0)"><tspan id="SvgjsTspan4325" dy="23.75" x="87.5"><tspan id="SvgjsTspan4326" style="">LoadLoad屏障</tspan></tspan></text></g></g><g id="SvgjsG4327" transform="translate(1028.7073170731708,391.3536585365849)"><path id="SvgjsPath4328" d="M 0 0L 174.8292682926829 0L 174.8292682926829 40.414634146341484L 0 40.414634146341484Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e0c331"></path><g id="SvgjsG4329"><text id="SvgjsText4330" font-family="微软雅黑" text-anchor="middle" font-size="19px" width="155px" fill="#ffffff" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="19px" weight="700" font-style="" opacity="1" y="3.832317073170742" transform="rotate(0)"><tspan id="SvgjsTspan4331" dy="23.75" x="87.5"><tspan id="SvgjsTspan4332" style="">LoadStore屏障</tspan></tspan></text></g></g><g id="SvgjsG4333" transform="translate(1028.7073170731708,496.71951219512147)"><path id="SvgjsPath4334" d="M 0 0L 174.8292682926829 0L 174.8292682926829 40.414634146341484L 0 40.414634146341484Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#7985ec"></path><g id="SvgjsG4335"><text id="SvgjsText4336" font-family="微软雅黑" text-anchor="middle" font-size="19px" width="155px" fill="#ffffff" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="19px" weight="700" font-style="" opacity="1" y="3.832317073170742" transform="rotate(0)"><tspan id="SvgjsTspan4337" dy="23.75" x="87.5"><tspan id="SvgjsTspan4338" style="">System...</tspan></tspan></text></g></g><g id="SvgjsG4339" transform="translate(878.4146341463413,180.82926829268297)"><path id="SvgjsPath4340" d="M 0 0L 100 0L 100 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG4341"><text id="SvgjsText4342" font-family="微软雅黑" text-anchor="end" font-size="19px" width="100px" fill="#a23735" font-weight="400" align="middle" lineHeight="125%" anchor="end" family="微软雅黑" size="19px" weight="400" font-style="" opacity="1" y="3.625" transform="rotate(0)"><tspan id="SvgjsTspan4343" dy="23.75" x="100"><tspan id="SvgjsTspan4344" style="">volatile读</tspan></tspan></text></g></g><g id="SvgjsG4345" transform="translate(726.219512195122,286.19512195121905)"><path id="SvgjsPath4346" d="M 0 0L 252.19512195121933 0L 252.19512195121933 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG4347"><text id="SvgjsText4348" font-family="微软雅黑" text-anchor="end" font-size="19px" width="253px" fill="#e0c331" font-weight="400" align="middle" lineHeight="125%" anchor="end" family="微软雅黑" size="19px" weight="400" font-style="" opacity="1" y="-8.375" transform="rotate(0)"><tspan id="SvgjsTspan4349" dy="23.75" x="253"><tspan id="SvgjsTspan4350" style="">禁止处理器把上面的volatile读</tspan></tspan><tspan id="SvgjsTspan4351" dy="23.75" x="253"><tspan id="SvgjsTspan4352" style="">与下面的普通读重排序</tspan></tspan></text></g></g><g id="SvgjsG4353" transform="translate(740.6097560975604,379.06097560975564)"><path id="SvgjsPath4354" d="M 0 0L 237.8048780487809 0L 237.8048780487809 65L 0 65Z" stroke="none" fill="none"></path><g id="SvgjsG4355"><text id="SvgjsText4356" font-family="微软雅黑" text-anchor="end" font-size="19px" width="238px" fill="#e0c331" font-weight="400" align="middle" lineHeight="125%" anchor="end" family="微软雅黑" size="19px" weight="400" font-style="" opacity="1" y="4.125" transform="rotate(0)"><tspan id="SvgjsTspan4357" dy="23.75" x="238"><tspan id="SvgjsTspan4358" style="">静止处理器把上面的volatile</tspan></tspan><tspan id="SvgjsTspan4359" dy="23.75" x="238"><tspan id="SvgjsTspan4360" style="">读与下面的普通写重排序</tspan></tspan></text></g></g><g id="SvgjsG4361" transform="translate(740.6097560975606,496.92682926829224)"><path id="SvgjsPath4362" d="M 0 0L 237.80487804878055 0L 237.80487804878055 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG4363"><text id="SvgjsText4364" font-family="微软雅黑" text-anchor="end" font-size="19px" width="238px" fill="#7985ec" font-weight="400" align="middle" lineHeight="125%" anchor="end" family="微软雅黑" size="19px" weight="400" font-style="" opacity="1" y="3.625" transform="rotate(0)"><tspan id="SvgjsTspan4365" dy="23.75" x="238"><tspan id="SvgjsTspan4366" style="">普通读</tspan></tspan></text></g></g><g id="SvgjsG4367" transform="translate(32.878048780487816,50.00000000000001)"><path id="SvgjsPath4368" d="M 0 0L 447 0L 447 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG4369"><text id="SvgjsText4370" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="447px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="400" font-style="" opacity="1" y="-4" transform="rotate(0)"><tspan id="SvgjsTspan4371" dy="20" x="223.5"><tspan id="SvgjsTspan4372" style="font-weight: bold;">- 在每一个`volatile`写操作前面插入一个`StoreStore`屏障</tspan></tspan><tspan id="SvgjsTspan4373" dy="20" x="223.5"><tspan id="SvgjsTspan4374" style="font-weight: bold;">- 在每一个`volatile`写操作后面插入一个`StoreLoad`屏障</tspan></tspan></text></g></g><g id="SvgjsG4375" transform="translate(760.3658536585367,25)"><path id="SvgjsPath4376" d="M 0 0L 434.6829268292681 0L 434.6829268292681 65L 0 65Z" stroke="none" fill="none"></path><g id="SvgjsG4377"><text id="SvgjsText4378" font-family="微软雅黑" text-anchor="middle" font-size="16px" width="435px" fill="#323232" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="16px" weight="700" font-style="" opacity="1" y="8.5" transform="rotate(0)"><tspan id="SvgjsTspan4379" dy="20" x="217.5"><tspan id="SvgjsTspan4380" style="">- 在每一个`volatile`读操作后面插入一个`LoadLoad`屏障</tspan></tspan><tspan id="SvgjsTspan4381" dy="20" x="217.5"><tspan id="SvgjsTspan4382" style="">- 在每一个`volatile`读操作后面插入一个`LoadStore`屏障</tspan></tspan></text></g></g><g id="SvgjsG4383" transform="translate(153.0487804878049,560.6920731707318)"><path id="SvgjsPath4384" d="M 0 0L 180.48780487804873 0L 180.48780487804873 81.25L 0 81.25Z" stroke="none" fill="none"></path><g id="SvgjsG4385"><text id="SvgjsText4386" font-family="微软雅黑" text-anchor="start" font-size="16px" width="181px" fill="#323232" font-weight="700" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="700" font-style="" opacity="1" y="-3.375" transform="rotate(0)"><tspan id="SvgjsTspan4387" dy="20" x="0"><tspan id="SvgjsTspan4388" style="">public void write() {</tspan></tspan><tspan id="SvgjsTspan4389" dy="20" x="0"><tspan id="SvgjsTspan4390" style="">    i = 2;</tspan></tspan><tspan id="SvgjsTspan4391" dy="20" x="0"><tspan id="SvgjsTspan4392" style="">    flag = true;</tspan></tspan><tspan id="SvgjsTspan4393" dy="20" x="0"><tspan id="SvgjsTspan4394" style="">  }</tspan></tspan></text></g></g><g id="SvgjsG4395" transform="translate(861.3639652903487,589.7926829268289)"><path id="SvgjsPath4396" d="M 0 0L 289.80865478515625 0L 289.80865478515625 81.25L 0 81.25Z" stroke="none" fill="none"></path><g id="SvgjsG4397"><text id="SvgjsText4398" font-family="微软雅黑" text-anchor="start" font-size="16px" width="290px" fill="#323232" font-weight="700" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="16px" weight="700" font-style="" opacity="1" y="-13.375" transform="rotate(0)"><tspan id="SvgjsTspan4399" dy="20" x="0"><tspan id="SvgjsTspan4400" style="">  public void read() {</tspan></tspan><tspan id="SvgjsTspan4401" dy="20" x="0"><tspan id="SvgjsTspan4402" style="">    if(flag) {</tspan></tspan><tspan id="SvgjsTspan4403" dy="20" x="0"><tspan id="SvgjsTspan4404" style="">      System.out.println("---i = " + i);</tspan></tspan><tspan id="SvgjsTspan4405" dy="20" x="0"><tspan id="SvgjsTspan4406" style="">    }</tspan></tspan><tspan id="SvgjsTspan4407" dy="20" x="0"><tspan id="SvgjsTspan4408" style="">  }</tspan></tspan></text></g></g></svg>