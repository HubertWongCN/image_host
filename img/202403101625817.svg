<svg id="SvgjsSvg2996" width="4393.0513329476435" height="3106.444444444445" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs2997"><pattern patternUnits="userSpaceOnUse" id="pattern_mark_0" width="300" height="300"><text x="150" y="100" fill="rgba(229,229,229,0.8)" font-size="18" transform="rotate(-45, 150, 150)" style="dominant-baseline: middle; text-anchor: middle;"></text></pattern><pattern patternUnits="userSpaceOnUse" id="pattern_mark_1" width="300" height="300"><text x="150" y="200" fill="rgba(229,229,229,0.8)" font-size="18" transform="rotate(-45, 150, 150)" style="dominant-baseline: middle; text-anchor: middle;"></text></pattern><marker id="SvgjsMarker3035" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3036" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3072" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3073" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3082" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3083" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3092" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3093" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3106" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3107" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3154" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3155" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3164" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3165" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3174" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3175" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3212" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3213" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3228" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3229" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3238" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3239" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3256" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3257" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3272" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3273" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3394" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3395" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3408" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3409" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3438" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3439" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3452" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3453" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3473" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3474" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3498" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3499" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3506" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3507" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3535" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3536" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3539" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3540" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3567" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3568" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3575" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3576" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3606" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3607" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3656" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3657" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3684" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3685" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3698" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3699" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3712" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3713" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3726" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3727" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3746" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3747" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3796" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3797" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3800" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3801" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3804" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3805" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3816" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3817" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3826" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3827" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3855" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3856" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker3872" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath3873" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4052" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4053" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4074" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4075" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4093" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4094" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4104" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4105" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4115" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4116" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4241" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4242" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4249" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4250" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4257" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4258" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4261" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4262" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4377" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4378" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4381" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4382" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4385" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4386" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4393" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4394" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4401" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4402" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4409" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4410" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4436" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4437" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4480" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4481" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4643" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4644" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4657" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4658" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4679" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4680" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4683" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4684" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4691" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4692" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4699" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4700" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4725" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4726" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4739" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4740" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4749" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4750" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4875" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4876" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4890" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4891" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4904" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4905" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4927" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4928" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4938" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4939" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker4948" markerWidth="13" markerHeight="9" refX="9.5" refY="4.5" viewBox="0 0 13 9" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath4949" d="M0,0 L13,4.5 L0,9 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker></defs><rect id="svgbackgroundid" width="4393.0513329476435" height="3106.444444444445" fill="transparent"></rect><rect id="SvgjsRect2999" width="4393.0513329476435" height="3106.444444444445" fill="url(#pattern_mark_0)"></rect><rect id="SvgjsRect3000" width="4393.0513329476435" height="3106.444444444445" fill="url(#pattern_mark_1)"></rect><g id="SvgjsG3001" transform="translate(2695.1849136526534,192.9339178018655)"><path id="SvgjsPath3002" d="M 0 0L 1672.86641929499 0L 1672.86641929499 1385.1102302716452L 0 1385.1102302716452Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#fbe9d0"></path><g id="SvgjsG3003"><text id="SvgjsText3004" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="1653px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="681.9301151358226" transform="rotate(0)"></text></g></g><g id="SvgjsG3005" transform="translate(25,361.2941176470585)"><path id="SvgjsPath3006" d="M 0 0L 1200.111111111111 0L 1200.111111111111 2720.1503267973862L 0 2720.1503267973862Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#fbe9d0"></path><g id="SvgjsG3007"><text id="SvgjsText3008" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="1181px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1349.4501633986931" transform="rotate(0)"></text></g></g><g id="SvgjsG3009" transform="translate(30.839758480718615,147)"><path id="SvgjsPath3010" d="M 0 0L 325 0L 341 16L 341 100L 0 100L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath3011" d="M 325 0L 325 16L 341 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath3012" d="M 0 0L 325 0L 341 16L 341 100L 0 100L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG3013"><text id="SvgjsText3014" font-family="微软雅黑" text-anchor="start" font-size="13px" width="321px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.625" transform="rotate(0)"><tspan id="SvgjsTspan3015" dy="16.25" x="10"><tspan id="SvgjsTspan3016" style="">整个ReentrantLock的加锁过程，可以分为三个阶段：</tspan></tspan><tspan id="SvgjsTspan3017" dy="16.25" x="10"><tspan id="SvgjsTspan3018" style="">1. 尝试加锁</tspan></tspan><tspan id="SvgjsTspan3019" dy="16.25" x="10"><tspan id="SvgjsTspan3020" style="">2. 加锁失败，线程进入队列</tspan></tspan><tspan id="SvgjsTspan3021" dy="16.25" x="10"><tspan id="SvgjsTspan3022" style="">3. 线程进入队列后，进入阻塞状态</tspan></tspan><tspan id="SvgjsTspan3023" dy="16.25" x="10"><tspan id="SvgjsTspan3024" style=""> </tspan></tspan><tspan id="SvgjsTspan3025" dy="16.25" x="10"><tspan id="SvgjsTspan3026" style="">对应下面 ① ② ③ 三部分</tspan></tspan></text></g></g><g id="SvgjsG3027" transform="translate(1880.777777777778,25)"><path id="SvgjsPath3028" d="M 16.666666666666668 0L 98.33333333333333 0C 120.55555555555556 0 120.55555555555556 50 98.33333333333333 50L 16.666666666666668 50C -5.555555555555556 50 -5.555555555555556 0 16.666666666666668 0Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3029"><text id="SvgjsText3030" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="95px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="14.375" transform="rotate(0)"><tspan id="SvgjsTspan3031" dy="16.25" x="57.5"><tspan id="SvgjsTspan3032" style="">ReentrantLock</tspan></tspan></text></g></g><g id="SvgjsG3033"><path id="SvgjsPath3034" d="M1938.277777777778 75.75L1938.277777777778 95L1938.277777777778 95L1938.277777777778 112.30000000000001" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3035)"></path></g><g id="SvgjsG3037" transform="translate(1899.777777777778,115)"><path id="SvgjsPath3038" d="M 0 4Q 0 0 4 0L 73 0Q 77 0 77 4L 77 28Q 77 32 73 32L 4 32Q 0 32 0 28Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3039"><text id="SvgjsText3040" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="57px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="5.375" transform="rotate(0)"><tspan id="SvgjsTspan3041" dy="16.25" x="38.5"><tspan id="SvgjsTspan3042" style="">lock</tspan></tspan></text></g></g><g id="SvgjsG3043"><path id="SvgjsPath3044" d="M1977.527777777778 131L2010.0959595959596 131L2010.0959595959596 131L2042.664141414141 131" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG3045" transform="translate(2043.414141414141,101.09090909090912)"><path id="SvgjsPath3046" d="M 0 0L 149.09090909090924 0L 149.09090909090924 59.81818181818181L 0 59.81818181818181Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3047"><text id="SvgjsText3048" font-family="微软雅黑" text-anchor="start" font-size="13px" width="130px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="2.7840909090909065" transform="rotate(0)"><tspan id="SvgjsTspan3049" dy="16.25" x="10"><tspan id="SvgjsTspan3050" style="font-weight: bold;fill: rgb(91, 121, 232);">public void</tspan><tspan id="SvgjsTspan3051" style=""> lock() {</tspan></tspan><tspan id="SvgjsTspan3052" dy="16.25" x="10"><tspan id="SvgjsTspan3053" style="">    </tspan><tspan id="SvgjsTspan3054" style="fill: rgb(91, 121, 232);">sync</tspan><tspan id="SvgjsTspan3055" style="">.lock();</tspan></tspan><tspan id="SvgjsTspan3056" dy="16.25" x="10"><tspan id="SvgjsTspan3057" style="">}</tspan></tspan></text></g></g><g id="SvgjsG3058"><path id="SvgjsPath3059" d="M2193.2550505050513 131L2225.8232323232323 131L2225.8232323232323 131L2259.1414141414143 131" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG3060" transform="translate(2259.1414141414143,102.4090909090909)"><path id="SvgjsPath3061" d="M 0 0L 271.27272727272725 0L 287.27272727272725 16L 287.27272727272725 57.18181818181819L 0 57.18181818181819L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath3062" d="M 271.27272727272725 0L 271.27272727272725 16L 287.27272727272725 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath3063" d="M 0 0L 271.27272727272725 0L 287.27272727272725 16L 287.27272727272725 57.18181818181819L 0 57.18181818181819L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG3064"><text id="SvgjsText3065" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="268px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="17.965909090909093" transform="rotate(0)"><tspan id="SvgjsTspan3066" dy="16.25" x="144"><tspan id="SvgjsTspan3067" style="font-weight: bold;font-style: italic;fill: rgb(91, 121, 232);">Sync</tspan><tspan id="SvgjsTspan3068" style=""> 继承自 </tspan><tspan id="SvgjsTspan3069" style="font-weight: bold;font-style: italic;fill: rgb(91, 121, 232);">AbstractQueuedSynchronizer</tspan></tspan></text></g></g><g id="SvgjsG3070"><path id="SvgjsPath3071" d="M1938.277777777778 147.75L1938.277777777778 167L1938.277777777778 167L1938.277777777778 184.3" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3072)"></path></g><g id="SvgjsG3074" transform="translate(1890.277777777778,187)"><path id="SvgjsPath3075" d="M 0 4Q 0 0 4 0L 92 0Q 96 0 96 4L 96 50Q 96 54 92 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3076"><text id="SvgjsText3077" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan3078" dy="16.25" x="48"><tspan id="SvgjsTspan3079" style="">sync.lock()</tspan></tspan></text></g></g><g id="SvgjsG3080"><path id="SvgjsPath3081" d="M1938.277777777778 241.75L1938.277777777778 261L1938.277777777778 261L1938.277777777778 278.3" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3082)"></path></g><g id="SvgjsG3084" transform="translate(1863.391414141414,281)"><path id="SvgjsPath3085" d="M 0 35L 74.88636363636363 0L 149.77272727272725 35L 74.88636363636363 70Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3086"><text id="SvgjsText3087" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="130px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.725" transform="rotate(0)"><tspan id="SvgjsTspan3088" dy="16.25" x="75"><tspan id="SvgjsTspan3089" style="font-style: italic;">abstract void lock()</tspan></tspan></text></g></g><g id="SvgjsG3090"><path id="SvgjsPath3091" d="M1862.641414141414 316L1831.277777777778 316L1831.277777777778 369.29999999999995" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3092)"></path><rect id="SvgjsRect3094" width="39" height="16" x="1811.777777777778" y="328.980634042254" fill="#ffffff"></rect><text id="SvgjsText3095" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="39px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="326.355634042254" transform="rotate(0)"><tspan id="SvgjsTspan3096" dy="16.25" x="1831.277777777778"><tspan id="SvgjsTspan3097" style="">公平锁</tspan></tspan></text></g><g id="SvgjsG3098" transform="translate(1772.277777777778,371.99999999999994)"><path id="SvgjsPath3099" d="M 0 4Q 0 0 4 0L 114 0Q 118 0 118 4L 118 50Q 118 54 114 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3100"><text id="SvgjsText3101" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="98px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan3102" dy="16.25" x="59"><tspan id="SvgjsTspan3103" style="">FairSync#lock()</tspan></tspan></text></g></g><g id="SvgjsG3104"><path id="SvgjsPath3105" d="M2013.914141414141 316L2058.0050505050513 316L2058.0050505050513 369.29999999999995" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3106)"></path><rect id="SvgjsRect3108" width="52" height="16" x="2032.0050505050513" y="327.9364251029562" fill="#ffffff"></rect><text id="SvgjsText3109" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="52px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="325.3114251029562" transform="rotate(0)"><tspan id="SvgjsTspan3110" dy="16.25" x="2058.0050505050513"><tspan id="SvgjsTspan3111" style="">非公平锁</tspan></tspan></text></g><g id="SvgjsG3112" transform="translate(1986.277777777778,371.99999999999994)"><path id="SvgjsPath3113" d="M 0 0L 143.4545454545455 0L 143.4545454545455 54L 0 54Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3114"><text id="SvgjsText3115" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="124px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan3116" dy="16.25" x="72"><tspan id="SvgjsTspan3117" style="">NonFairSync#lock()</tspan></tspan></text></g></g><g id="SvgjsG3118"><path id="SvgjsPath3119" d="M2130.4546026283188 398.79797902554327C 2168.2856414696353 398.99999999999994 2147.8608231768294 321.0454545454545 2185.691862018146 321.24747551991123" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG3120" transform="translate(2186.4141414141413,258)"><path id="SvgjsPath3121" d="M 0 0L 367.27272727272725 0L 367.27272727272725 126.09090909090907L 0 126.09090909090907Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3122"><text id="SvgjsText3123" font-family="微软雅黑" text-anchor="start" font-size="13px" width="348px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="11.420454545454533" transform="rotate(0)"><tspan id="SvgjsTspan3124" dy="16.25" x="10"><tspan id="SvgjsTspan3125" style="">final void lock() {</tspan></tspan><tspan id="SvgjsTspan3126" dy="16.25" x="10"><tspan id="SvgjsTspan3127" style="">    if (compareAndSetState(0, 1))</tspan></tspan><tspan id="SvgjsTspan3128" dy="16.25" x="10"><tspan id="SvgjsTspan3129" style="">        setExclusiveOwnerThread(Thread.currentThread());</tspan></tspan><tspan id="SvgjsTspan3130" dy="16.25" x="10"><tspan id="SvgjsTspan3131" style="">    else</tspan></tspan><tspan id="SvgjsTspan3132" dy="16.25" x="10"><tspan id="SvgjsTspan3133" style="">        acquire(1);</tspan></tspan><tspan id="SvgjsTspan3134" dy="16.25" x="10"><tspan id="SvgjsTspan3135" style="">}</tspan></tspan></text></g></g><g id="SvgjsG3136"><path id="SvgjsPath3137" d="M1771.5413266713729 398.85808535003565C 1726.1347267622157 398.99999999999994 1736.2844651569765 318.00000000000006 1690.8778652478193 318.14191464996435" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG3138" transform="translate(102.30022005041405,498.11111111111126)"><path id="SvgjsPath3139" d="M 0 0L 1083.8392046790345 0L 1083.8392046790345 1327.7777777777778L 0 1327.7777777777778Z" stroke-dasharray="10,6,3,6" stroke="rgba(121,133,236,1)" stroke-width="1.5" fill-opacity="1" fill="#d2d6f9"></path><g id="SvgjsG3140"><text id="SvgjsText3141" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="1064px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="653.2638888888889" transform="rotate(0)"></text></g></g><g id="SvgjsG3142" transform="translate(1551.959595959596,294)"><path id="SvgjsPath3143" d="M 0 0L 138.1818181818182 0L 138.1818181818182 54L 0 54Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3144"><text id="SvgjsText3145" font-family="微软雅黑" text-anchor="start" font-size="13px" width="119px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="-0.125" transform="rotate(0)"><tspan id="SvgjsTspan3146" dy="16.25" x="10"><tspan id="SvgjsTspan3147" style="">final void lock() {</tspan></tspan><tspan id="SvgjsTspan3148" dy="16.25" x="10"><tspan id="SvgjsTspan3149" style="">    acquire(1);</tspan></tspan><tspan id="SvgjsTspan3150" dy="16.25" x="10"><tspan id="SvgjsTspan3151" style="">}</tspan></tspan></text></g></g><g id="SvgjsG3152"><path id="SvgjsPath3153" d="M1831.277777777778 426.75000000000006C 1831.277777777778 457.12727272727267 1831.277777777778 472.6909090909092 1831.277777777778 501.11818181818177" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3154)"></path></g><g id="SvgjsG3156" transform="translate(1783.277777777778,503.8181818181818)"><path id="SvgjsPath3157" d="M 0 4Q 0 0 4 0L 92 0Q 96 0 96 4L 96 50Q 96 54 92 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#95da69"></path><g id="SvgjsG3158"><text id="SvgjsText3159" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan3160" dy="16.25" x="48"><tspan id="SvgjsTspan3161" style="">acquire(1)</tspan></tspan></text></g></g><g id="SvgjsG3162"><path id="SvgjsPath3163" d="M2058.0050505050513 426.75000000000006L2058.0050505050513 493.11818181818177" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3164)"></path></g><g id="SvgjsG3166" transform="translate(2010.0050505050501,495.8181818181818)"><path id="SvgjsPath3167" d="M 0 35L 48 0L 96 35L 48 70Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3168"><text id="SvgjsText3169" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.725" transform="rotate(0)"><tspan id="SvgjsTspan3170" dy="16.25" x="48"><tspan id="SvgjsTspan3171" style="">CAS获取锁</tspan></tspan></text></g></g><g id="SvgjsG3172"><path id="SvgjsPath3173" d="M2009.2550505050501 530.8181818181818L1881.9777777777779 530.8181818181818" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3174)"></path><rect id="SvgjsRect3176" width="29" height="16" x="1939.9231517188573" y="522.8181818181818" fill="#ffffff"></rect><text id="SvgjsText3177" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="29px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="520.1931818181818" transform="rotate(0)"><tspan id="SvgjsTspan3178" dy="16.25" x="1954.4231517188573"><tspan id="SvgjsTspan3179" style="">false</tspan></tspan></text></g><g id="SvgjsG3180"><path id="SvgjsPath3181" d="M1782.5318365138817 530.7402611481596C 1733.9674197892307 530.8181818181818 1721.1790448572344 478.04545454545456 1672.6146281325834 478.12337521547676" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG3182" transform="translate(1300.959595959596,415.90909090909093)"><path id="SvgjsPath3183" d="M 0 0L 370.9090909090909 0L 370.9090909090909 124.2727272727272L 0 124.2727272727272Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3184"><text id="SvgjsText3185" font-family="微软雅黑" text-anchor="start" font-size="13px" width="351px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="10.511363636363598" transform="rotate(0)"><tspan id="SvgjsTspan3186" dy="16.25" x="10"><tspan id="SvgjsTspan3187" style="">public final void acquire(int arg) {</tspan></tspan><tspan id="SvgjsTspan3188" dy="16.25" x="10"><tspan id="SvgjsTspan3189" style="">    if (!tryAcquire(arg) &amp;&amp;</tspan></tspan><tspan id="SvgjsTspan3190" dy="16.25" x="10"><tspan id="SvgjsTspan3191" style="">            acquireQueued(addWaiter(Node.EXCLUSIVE), ar</tspan></tspan><tspan id="SvgjsTspan3192" dy="16.25" x="10"><tspan id="SvgjsTspan3193" style="">g))</tspan></tspan><tspan id="SvgjsTspan3194" dy="16.25" x="10"><tspan id="SvgjsTspan3195" style="">        selfInterrupt();</tspan></tspan><tspan id="SvgjsTspan3196" dy="16.25" x="10"><tspan id="SvgjsTspan3197" style="">}</tspan></tspan></text></g></g><g id="SvgjsG3198"><path id="SvgjsPath3199" d="M1486.2626459156684 415.1745508394267C 1486.4141414141416 358.47738011306217 1358.436868686869 408.2498926142104 1358.436868686869 350.8181818181818" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG3200" transform="translate(1275.5050505050506,291.18181818181813)"><path id="SvgjsPath3201" d="M 0 0L 149.86363636363637 0L 165.86363636363637 16L 165.86363636363637 59.63636363636368L 0 59.63636363636368L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath3202" d="M 149.86363636363637 0L 149.86363636363637 16L 165.86363636363637 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath3203" d="M 0 0L 149.86363636363637 0L 165.86363636363637 16L 165.86363636363637 59.63636363636368L 0 59.63636363636368L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG3204"><text id="SvgjsText3205" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="146px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.693181818181841" transform="rotate(0)"><tspan id="SvgjsTspan3206" dy="16.25" x="83"><tspan id="SvgjsTspan3207" style="">尝试获取锁，如果获取不</tspan></tspan><tspan id="SvgjsTspan3208" dy="16.25" x="83"><tspan id="SvgjsTspan3209" style="">到，排队(阻塞当前线程)</tspan></tspan></text></g></g><g id="SvgjsG3210"><path id="SvgjsPath3211" d="M2106.7550505050503 530.8181818181818L2236.2777777777783 530.8181818181818L2236.2777777777783 615.9666666666667" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3212)"></path><rect id="SvgjsRect3214" width="24" height="16" x="2151.627320285359" y="522.8181818181818" fill="#ffffff"></rect><text id="SvgjsText3215" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="24px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="520.1931818181818" transform="rotate(0)"><tspan id="SvgjsTspan3216" dy="16.25" x="2163.627320285359"><tspan id="SvgjsTspan3217" style="">true</tspan></tspan></text></g><g id="SvgjsG3218" transform="translate(2149.7777777777783,618.6666666666667)"><path id="SvgjsPath3219" d="M 0 0L 173 0L 173 54L 0 54Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#f6edc1"></path><g id="SvgjsG3220"><text id="SvgjsText3221" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="153px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan3222" dy="16.25" x="86.5"><tspan id="SvgjsTspan3223" style="">成功获取到锁，设置锁持</tspan></tspan><tspan id="SvgjsTspan3224" dy="16.25" x="86.5"><tspan id="SvgjsTspan3225" style="">有线程为当前线程，返回</tspan></tspan></text></g></g><g id="SvgjsG3226"><path id="SvgjsPath3227" d="M1831.277777777778 558.5681818181818L1831.277777777778 607.409090909091L1831.277777777778 607.409090909091L1831.277777777778 654.3000000000002" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3228)"></path></g><g id="SvgjsG3230" transform="translate(1772.1944444444441,657.0000000000002)"><path id="SvgjsPath3231" d="M 0 35L 59.083333333333314 0L 118.16666666666663 35L 59.083333333333314 70Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3232"><text id="SvgjsText3233" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="99px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="24.725" transform="rotate(0)"><tspan id="SvgjsTspan3234" dy="16.25" x="59.5"><tspan id="SvgjsTspan3235" style="">tryAcquire(arg)</tspan></tspan></text></g></g><g id="SvgjsG3236"><path id="SvgjsPath3237" d="M1771.4444444444441 692.0000000000002L1684.277777777778 692.0000000000002L1684.277777777778 760.9666666666667" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3238)"></path><rect id="SvgjsRect3240" width="24" height="16" x="1672.277777777778" y="716.9508949180762" fill="#ffffff"></rect><text id="SvgjsText3241" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="24px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="714.3258949180762" transform="rotate(0)"><tspan id="SvgjsTspan3242" dy="16.25" x="1684.277777777778"><tspan id="SvgjsTspan3243" style="">true</tspan></tspan></text></g><g id="SvgjsG3244" transform="translate(1612.777777777778,763.6666666666667)"><path id="SvgjsPath3245" d="M 0 0L 143 0L 143 54L 0 54Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#f6edc1"></path><g id="SvgjsG3246"><text id="SvgjsText3247" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="123px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.125" transform="rotate(0)"><tspan id="SvgjsTspan3248" dy="16.25" x="71.5"><tspan id="SvgjsTspan3249" style="">返回 true，表示获取</tspan></tspan><tspan id="SvgjsTspan3250" dy="16.25" x="71.5"><tspan id="SvgjsTspan3251" style="">到锁了，线程逐级返</tspan></tspan><tspan id="SvgjsTspan3252" dy="16.25" x="71.5"><tspan id="SvgjsTspan3253" style="">回，加锁过程结束</tspan></tspan></text></g></g><g id="SvgjsG3254"><path id="SvgjsPath3255" d="M1891.111111111111 692.0000000000002L1974.5762603544924 692.0000000000002L1974.5762603544924 760.9666666666667" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3256)"></path><rect id="SvgjsRect3258" width="29" height="16" x="1960.0762603544924" y="716.9697922516957" fill="#ffffff"></rect><text id="SvgjsText3259" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="29px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="714.3447922516957" transform="rotate(0)"><tspan id="SvgjsTspan3260" dy="16.25" x="1974.5762603544924"><tspan id="SvgjsTspan3261" style="">false</tspan></tspan></text></g><g id="SvgjsG3262" transform="translate(1908.830808080808,763.6666666666667)"><path id="SvgjsPath3263" d="M 0 0L 128.94696969696975 0L 128.94696969696975 54L 0 54Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#f8f531"></path><g id="SvgjsG3264"><text id="SvgjsText3265" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="109px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan3266" dy="16.25" x="64.5"><tspan id="SvgjsTspan3267" style="">返回 false，表示</tspan></tspan><tspan id="SvgjsTspan3268" dy="16.25" x="64.5"><tspan id="SvgjsTspan3269" style="">线程没有获取到锁</tspan></tspan></text></g></g><g id="SvgjsG3270"><path id="SvgjsPath3271" d="M1973.304292929293 818.4166666666667L1973.304292929293 861.5000000000002L1973.304292929293 861.5000000000002L1973.304292929293 902.6333333333334" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3272)"></path></g><g id="SvgjsG3274" transform="translate(1890.400883838384,905.3333333333335)"><path id="SvgjsPath3275" d="M 0 4Q 0 0 4 0L 161.80681818181824 0Q 165.80681818181824 0 165.80681818181824 4L 165.80681818181824 50Q 165.80681818181824 54 161.80681818181824 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3276"><text id="SvgjsText3277" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="146px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan3278" dy="16.25" x="83"><tspan id="SvgjsTspan3279" style="">addWaiter(Node mode)</tspan></tspan></text></g></g><g id="SvgjsG3280"><path id="SvgjsPath3281" d="M1805.5885863121096 672.2710204605496C 1660.9955989132839 431.59436294895335 1384.1642252428467 698.2344666980516 1103.3932745378515 698.2225525171445" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path><rect id="SvgjsRect3282" width="65" height="16" x="1443.412189624799" y="596.288988185691" fill="#ffffff"></rect><text id="SvgjsText3283" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="65px" fill="#a7932c" font-weight="700" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="700" font-style="" opacity="1" y="593.663988185691" transform="rotate(0)"><tspan id="SvgjsTspan3284" dy="16.25" x="1475.912189624799"><tspan id="SvgjsTspan3285" style="">尝试获取锁</tspan></tspan></text></g><g id="SvgjsG3286" transform="translate(30.839758480718615,362.59573043456584)"><path id="SvgjsPath3287" d="M 0 0L 373.0536106949087 0L 373.0536106949087 72.8085391308681L 0 72.8085391308681Z" stroke="none" fill="none"></path><g id="SvgjsG3288"><text id="SvgjsText3289" font-family="微软雅黑" text-anchor="start" font-size="13px" width="374px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="9.27926956543405" transform="rotate(0)"><tspan id="SvgjsTspan3290" dy="16.25" x="0"><tspan id="SvgjsTspan3291" style="">这部分所有逻辑，都是 </tspan><tspan id="SvgjsTspan3292" style="font-style: italic;">tryAcquire</tspan><tspan id="SvgjsTspan3293" style=""> 方法调用引申出来的</tspan></tspan><tspan id="SvgjsTspan3294" dy="16.25" x="0"><tspan id="SvgjsTspan3295" style=""> </tspan></tspan><tspan id="SvgjsTspan3296" dy="16.25" x="0"><tspan id="SvgjsTspan3297" style="font-style: italic;">tryAcquire</tspan><tspan id="SvgjsTspan3298" style=""> 方法，顾名思义，就是尝试获取一次锁</tspan></tspan></text></g></g><g id="SvgjsG3299" transform="translate(35.3857113901812,415.90909090909093)"><path id="SvgjsPath3300" d="M 0 0L 54.813593845055486 0L 54.813593845055486 95.02216668634723L 0 95.02216668634723Z" stroke="none" fill="none"></path><g id="SvgjsG3301"><text id="SvgjsText3302" font-family="微软雅黑" text-anchor="middle" font-size="60px" width="55px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="60px" weight="400" font-style="" opacity="1" y="-2.488916656826383" transform="rotate(0)"><tspan id="SvgjsTspan3303" dy="75" x="27.5"><tspan id="SvgjsTspan3304" style="font-weight: bold;">①</tspan></tspan></text></g></g><g id="SvgjsG3305" transform="translate(732.8517025089607,522.6094666980518)"><path id="SvgjsPath3306" d="M 0 0L 369.79166666666663 0L 369.79166666666663 351.25L 0 351.25Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3307"><text id="SvgjsText3308" font-family="微软雅黑" text-anchor="start" font-size="13px" width="350px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="10.5" transform="rotate(0)"><tspan id="SvgjsTspan3309" dy="16.25" x="10"><tspan id="SvgjsTspan3310" style="">protected final boolean tryAcquire(int acquires) {</tspan></tspan><tspan id="SvgjsTspan3311" dy="16.25" x="10"><tspan id="SvgjsTspan3312" style="">    final Thread current = Thread.currentThread();</tspan></tspan><tspan id="SvgjsTspan3313" dy="16.25" x="10"><tspan id="SvgjsTspan3314" style="">    int c = getState();</tspan></tspan><tspan id="SvgjsTspan3315" dy="16.25" x="10"><tspan id="SvgjsTspan3316" style="">    if (c == 0) {</tspan></tspan><tspan id="SvgjsTspan3317" dy="16.25" x="10"><tspan id="SvgjsTspan3318" style="">        if (!hasQueuedPredecessors() &amp;&amp;</tspan></tspan><tspan id="SvgjsTspan3319" dy="16.25" x="10"><tspan id="SvgjsTspan3320" style="">                compareAndSetState(0, acquires)) {</tspan></tspan><tspan id="SvgjsTspan3321" dy="16.25" x="10"><tspan id="SvgjsTspan3322" style="">            setExclusiveOwnerThread(current);</tspan></tspan><tspan id="SvgjsTspan3323" dy="16.25" x="10"><tspan id="SvgjsTspan3324" style="">            return true;</tspan></tspan><tspan id="SvgjsTspan3325" dy="16.25" x="10"><tspan id="SvgjsTspan3326" style="">        }</tspan></tspan><tspan id="SvgjsTspan3327" dy="16.25" x="10"><tspan id="SvgjsTspan3328" style="">    }</tspan></tspan><tspan id="SvgjsTspan3329" dy="16.25" x="10"><tspan id="SvgjsTspan3330" style="">    else if (current == getExclusiveOwnerThread()) {</tspan></tspan><tspan id="SvgjsTspan3331" dy="16.25" x="10"><tspan id="SvgjsTspan3332" style="">        int nextc = c + acquires;</tspan></tspan><tspan id="SvgjsTspan3333" dy="16.25" x="10"><tspan id="SvgjsTspan3334" style="">        if (nextc &lt; 0)</tspan></tspan><tspan id="SvgjsTspan3335" dy="16.25" x="10"><tspan id="SvgjsTspan3336" style="">            throw new Error("Maximum lock count exceeded</tspan></tspan><tspan id="SvgjsTspan3337" dy="16.25" x="10"><tspan id="SvgjsTspan3338" style="">");</tspan></tspan><tspan id="SvgjsTspan3339" dy="16.25" x="10"><tspan id="SvgjsTspan3340" style="">        setState(nextc);</tspan></tspan><tspan id="SvgjsTspan3341" dy="16.25" x="10"><tspan id="SvgjsTspan3342" style="">        return true;</tspan></tspan><tspan id="SvgjsTspan3343" dy="16.25" x="10"><tspan id="SvgjsTspan3344" style="">    }</tspan></tspan><tspan id="SvgjsTspan3345" dy="16.25" x="10"><tspan id="SvgjsTspan3346" style="">    return false;</tspan></tspan><tspan id="SvgjsTspan3347" dy="16.25" x="10"><tspan id="SvgjsTspan3348" style="">}</tspan></tspan></text></g></g><g id="SvgjsG3349" transform="translate(166.96460573476702,636.3644764732223)"><path id="SvgjsPath3350" d="M 0 0L 444.8333333333335 0L 460.8333333333335 16L 460.8333333333335 168.14015151515162L 0 168.14015151515162L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath3351" d="M 444.8333333333335 0L 444.8333333333335 16L 460.8333333333335 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath3352" d="M 0 0L 444.8333333333335 0L 460.8333333333335 16L 460.8333333333335 168.14015151515162L 0 168.14015151515162L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG3353"><text id="SvgjsText3354" font-family="微软雅黑" text-anchor="start" font-size="13px" width="441px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="8.445075757575808" transform="rotate(0)"><tspan id="SvgjsTspan3355" dy="16.25" x="10"><tspan id="SvgjsTspan3356" style="font-style: italic;">tryAcquire</tspan><tspan id="SvgjsTspan3357" style=""> 方法，尝试获取锁，以下几种情况，会导致获取锁失败：</tspan></tspan><tspan id="SvgjsTspan3358" dy="16.25" x="10"><tspan id="SvgjsTspan3359" style="">1. 锁已经被其他线程获取</tspan></tspan><tspan id="SvgjsTspan3360" dy="16.25" x="10"><tspan id="SvgjsTspan3361" style="">2. 锁没有被其他线程获取，但当前线程需要排队</tspan></tspan><tspan id="SvgjsTspan3362" dy="16.25" x="10"><tspan id="SvgjsTspan3363" style="">3. CAS 失败(可能过程中已经有其他线程拿到锁了)</tspan></tspan><tspan id="SvgjsTspan3364" dy="16.25" x="10"><tspan id="SvgjsTspan3365" style=""> </tspan></tspan><tspan id="SvgjsTspan3366" dy="16.25" x="10"><tspan id="SvgjsTspan3367" style="">锁为自由状态(</tspan><tspan id="SvgjsTspan3368" style="font-style: italic;">c == 0</tspan><tspan id="SvgjsTspan3369" style="">)，并不能说明可以立刻执行 CAS 获取锁，因为可能在</tspan></tspan><tspan id="SvgjsTspan3370" dy="16.25" x="10"><tspan id="SvgjsTspan3371" style="">当前线程获取锁之前，已经有其他线程在排队了，必须遵循先来后到原则获</tspan></tspan><tspan id="SvgjsTspan3372" dy="16.25" x="10"><tspan id="SvgjsTspan3373" style="">取锁。所以还要调用 </tspan><tspan id="SvgjsTspan3374" style="font-style: italic;">hasQueuedPredecessors</tspan><tspan id="SvgjsTspan3375" style=""> 方法，查看自己是否需要排</tspan></tspan><tspan id="SvgjsTspan3376" dy="16.25" x="10"><tspan id="SvgjsTspan3377" style="">队</tspan></tspan></text></g></g><g id="SvgjsG3378"><path id="SvgjsPath3379" d="M732.102905733474 698.2769330261331C 689.902174901315 698.2344666980514 670.7474666757462 720.4345522307983 627.7979390681005 720.4345522307983" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG3380"><path id="SvgjsPath3381" d="M917.6412289052084 874.6018943612801C 917.7475358422942 941.0708362532364 792.3199377709343 898.9673364764981 776.3436340026005 963.4879270029601" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path><rect id="SvgjsRect3382" width="170" height="16" x="755.9846874898501" y="913.9167177766351" fill="#ffffff"></rect><text id="SvgjsText3383" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="170px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="911.2917177766351" transform="rotate(0)"><tspan id="SvgjsTspan3384" dy="16.25" x="840.9846874898501"><tspan id="SvgjsTspan3385" style="">tryAcquire 方法执行流程详解</tspan></tspan></text></g><g id="SvgjsG3386" transform="translate(715.1433691756274,964.1822411130506)"><path id="SvgjsPath3387" d="M 0 35L 60.91666666666677 0L 121.83333333333354 35L 60.91666666666677 70Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3388"><text id="SvgjsText3389" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="102px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="24.725" transform="rotate(0)"><tspan id="SvgjsTspan3390" dy="16.25" x="61"><tspan id="SvgjsTspan3391" style="">getState() == 0</tspan></tspan></text></g></g><g id="SvgjsG3392"><path id="SvgjsPath3393" d="M714.3933691756274 999.1822411130502L530.0808691756274 999.1822411130502L530.0808691756274 1267.7322411130506" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3394)"></path><rect id="SvgjsRect3396" width="136" height="16" x="462.0808691756274" y="1094.0261947051965" fill="#ffffff"></rect><text id="SvgjsText3397" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="136px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1091.4011947051965" transform="rotate(0)"><tspan id="SvgjsTspan3398" dy="16.25" x="530.0808691756274"><tspan id="SvgjsTspan3399" style="">== 0 表示锁为自由状态</tspan></tspan></text></g><g id="SvgjsG3400" transform="translate(436.3933691756274,1270.4322411130506)"><path id="SvgjsPath3401" d="M 0 43.125L 93.6875 0L 187.375 43.125L 93.6875 86.25Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3402"><text id="SvgjsText3403" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="168px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="32.93125" transform="rotate(0)"><tspan id="SvgjsTspan3404" dy="16.25" x="94"><tspan id="SvgjsTspan3405" style="font-style: italic;">hasQueuedPredecessors()</tspan></tspan></text></g></g><g id="SvgjsG3406"><path id="SvgjsPath3407" d="M837.7267025089609 999.1822411130502L889.7683691756274 999.1822411130502L889.7683691756274 1088.9822411130506" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3408)"></path><rect id="SvgjsRect3410" width="107" height="16" x="836.2683691756274" y="1029.7288714543179" fill="#ffffff"></rect><text id="SvgjsText3411" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="107px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1027.1038714543179" transform="rotate(0)"><tspan id="SvgjsTspan3412" dy="16.25" x="889.7683691756274"><tspan id="SvgjsTspan3413" style="">!= 0 表示占用状态</tspan></tspan></text></g><g id="SvgjsG3414" transform="translate(815.1433691756274,1087.9322411130506)"><path id="SvgjsPath3415" d="M 0 35L 74.625 0L 149.25 35L 74.625 70Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3416"><text id="SvgjsText3417" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="130px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="16.225" transform="rotate(0)"><tspan id="SvgjsTspan3418" dy="16.25" x="75"><tspan id="SvgjsTspan3419" style="">判断之前是不是当前线</tspan></tspan><tspan id="SvgjsTspan3420" dy="16.25" x="75"><tspan id="SvgjsTspan3421" style="">程获取到锁的</tspan></tspan></text></g></g><g id="SvgjsG3422"><path id="SvgjsPath3423" d="M922.9882695220781 1103.7447280991437C 936.6021245304667 1074.4282273035346 959.571892135109 1060.4322411130506 992.6433691756274 1060.4322411130506" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG3424" transform="translate(100.10595352645578,1847.6498353469)"><path id="SvgjsPath3425" d="M 0 0L 1092.0687496164196 0L 1092.0687496164196 1175.0000000000002L 0 1175.0000000000002Z" stroke-dasharray="10,6,3,6" stroke="rgba(91,121,232,1)" stroke-width="2" fill-opacity="1" fill="#f2f2f2"></path><g id="SvgjsG3426"><text id="SvgjsText3427" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="1073px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="576.8750000000001" transform="rotate(0)"></text></g></g><g id="SvgjsG3428" transform="translate(992.6433691756274,1041.6822411130506)"><path id="SvgjsPath3429" d="M 0 0L 127.75 0L 143.75 16L 143.75 37.5L 0 37.5L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath3430" d="M 127.75 0L 127.75 16L 143.75 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath3431" d="M 0 0L 127.75 0L 143.75 16L 143.75 37.5L 0 37.5L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG3432"><text id="SvgjsText3433" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="124px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="8.125" transform="rotate(0)"><tspan id="SvgjsTspan3434" dy="16.25" x="72"><tspan id="SvgjsTspan3435" style="">重入锁的实现原理</tspan></tspan></text></g></g><g id="SvgjsG3436"><path id="SvgjsPath3437" d="M965.1433691756274 1122.9322411130506L1025.898577508961 1122.9322411130506L1025.898577508961 1189.7322411130506" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3438)"></path><rect id="SvgjsRect3440" width="13" height="16" x="1019.3985775089609" y="1143.2724669310444" fill="#ffffff"></rect><text id="SvgjsText3441" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="13px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1140.6474669310444" transform="rotate(0)"><tspan id="SvgjsTspan3442" dy="16.25" x="1025.898577508961"><tspan id="SvgjsTspan3443" style="">是</tspan></tspan></text></g><g id="SvgjsG3444" transform="translate(960.1433691756274,1189.6822411130506)"><path id="SvgjsPath3445" d="M 0 4Q 0 0 4 0L 122.25 0Q 126.25 0 126.25 4L 126.25 50Q 126.25 54 122.25 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3446"><text id="SvgjsText3447" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="107px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan3448" dy="16.25" x="63.5"><tspan id="SvgjsTspan3449" style="">设置重入锁计数器</tspan></tspan></text></g></g><g id="SvgjsG3450"><path id="SvgjsPath3451" d="M814.3933691756274 1122.9322411130506L776.0600358422942 1122.9322411130506L776.0600358422942 1186.9822411130506" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3452)"></path><rect id="SvgjsRect3454" width="13" height="16" x="769.5600358422942" y="1141.0117293020269" fill="#ffffff"></rect><text id="SvgjsText3455" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="13px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1138.3867293020269" transform="rotate(0)"><tspan id="SvgjsTspan3456" dy="16.25" x="776.0600358422942"><tspan id="SvgjsTspan3457" style="">否</tspan></tspan></text></g><g id="SvgjsG3458" transform="translate(700.1850358422942,1189.6822411130506)"><path id="SvgjsPath3459" d="M 0 4Q 0 0 4 0L 147.75 0Q 151.75 0 151.75 4L 151.75 50Q 151.75 54 147.75 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#f9f630"></path><g id="SvgjsG3460"><text id="SvgjsText3461" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="132px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.125" transform="rotate(0)"><tspan id="SvgjsTspan3462" dy="16.25" x="76"><tspan id="SvgjsTspan3463" style="">整个 </tspan><tspan id="SvgjsTspan3464" style="font-style: italic;">tryAcquire</tspan><tspan id="SvgjsTspan3465" style=""> 返回 </tspan></tspan><tspan id="SvgjsTspan3466" dy="16.25" x="76"><tspan id="SvgjsTspan3467" style="font-style: italic;">false</tspan><tspan id="SvgjsTspan3468" style="">，表示获取锁失</tspan></tspan><tspan id="SvgjsTspan3469" dy="16.25" x="76"><tspan id="SvgjsTspan3470" style="">败</tspan></tspan></text></g></g><g id="SvgjsG3471"><path id="SvgjsPath3472" d="M1028.8933691756276 1243.9322411130506L1028.8933691756276 1278.0572411130506L1028.6433691756276 1278.0572411130506L1028.6433691756276 1310.2322411130506" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3473)"></path></g><g id="SvgjsG3475" transform="translate(954.6433691756274,1312.9322411130506)"><path id="SvgjsPath3476" d="M 0 4Q 0 0 4 0L 144 0Q 148 0 148 4L 148 50Q 148 54 144 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e7fbd0"></path><g id="SvgjsG3477"><text id="SvgjsText3478" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="128px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan3479" dy="16.25" x="74"><tspan id="SvgjsTspan3480" style="">整个 </tspan><tspan id="SvgjsTspan3481" style="font-style: italic;">tryAcquire</tspan><tspan id="SvgjsTspan3482" style=""> 返回 </tspan></tspan><tspan id="SvgjsTspan3483" dy="16.25" x="74"><tspan id="SvgjsTspan3484" style="font-style: italic;">true</tspan><tspan id="SvgjsTspan3485" style="">，表示获取锁成功</tspan></tspan></text></g></g><g id="SvgjsG3486" transform="translate(266.3933691756274,1379.6822411130506)"><path id="SvgjsPath3487" d="M 0 4Q 0 0 4 0L 159.75 0Q 163.75 0 163.75 4L 163.75 50Q 163.75 54 159.75 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3488"><text id="SvgjsText3489" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="144px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan3490" dy="16.25" x="82"><tspan id="SvgjsTspan3491" style="">返回 </tspan><tspan id="SvgjsTspan3492" style="font-style: italic;">true</tspan><tspan id="SvgjsTspan3493" style="">，表示需要排</tspan></tspan><tspan id="SvgjsTspan3494" dy="16.25" x="82"><tspan id="SvgjsTspan3495" style="">队</tspan></tspan></text></g></g><g id="SvgjsG3496"><path id="SvgjsPath3497" d="M435.6433691756274 1313.5572411130506L348.2683691756274 1313.5572411130506L348.2683691756274 1376.9822411130506" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3498)"></path><rect id="SvgjsRect3500" width="24" height="16" x="336.2683691756274" y="1320.095651883906" fill="#ffffff"></rect><text id="SvgjsText3501" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="24px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1317.470651883906" transform="rotate(0)"><tspan id="SvgjsTspan3502" dy="16.25" x="348.2683691756274"><tspan id="SvgjsTspan3503" style="">true</tspan></tspan></text></g><g id="SvgjsG3504"><path id="SvgjsPath3505" d="M624.5183691756274 1313.5572411130506L694.8933691756274 1313.5572411130506L694.8933691756274 1376.9822411130506" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3506)"></path><rect id="SvgjsRect3508" width="29" height="16" x="680.3933691756274" y="1323.6231517859537" fill="#ffffff"></rect><text id="SvgjsText3509" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="29px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1320.9981517859537" transform="rotate(0)"><tspan id="SvgjsTspan3510" dy="16.25" x="694.8933691756274"><tspan id="SvgjsTspan3511" style="">false</tspan></tspan></text></g><g id="SvgjsG3512" transform="translate(607.5183691756274,1379.6822411130506)"><path id="SvgjsPath3513" d="M 0 4Q 0 0 4 0L 170.75 0Q 174.75 0 174.75 4L 174.75 50Q 174.75 54 170.75 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3514"><text id="SvgjsText3515" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="155px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan3516" dy="16.25" x="87.5"><tspan id="SvgjsTspan3517" style="">返回 </tspan><tspan id="SvgjsTspan3518" style="font-style: italic;">false</tspan><tspan id="SvgjsTspan3519" style="">，表示无需排队</tspan></tspan></text></g></g><g id="SvgjsG3520" transform="translate(272.3933691756274,1498.4322411130506)"><path id="SvgjsPath3521" d="M 0 4Q 0 0 4 0L 147.75 0Q 151.75 0 151.75 4L 151.75 50Q 151.75 54 147.75 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#f9f630"></path><g id="SvgjsG3522"><text id="SvgjsText3523" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="132px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.125" transform="rotate(0)"><tspan id="SvgjsTspan3524" dy="16.25" x="76"><tspan id="SvgjsTspan3525" style="">整个 </tspan><tspan id="SvgjsTspan3526" style="font-style: italic;">tryAcquire</tspan><tspan id="SvgjsTspan3527" style=""> 返回 </tspan></tspan><tspan id="SvgjsTspan3528" dy="16.25" x="76"><tspan id="SvgjsTspan3529" style="font-style: italic;">false</tspan><tspan id="SvgjsTspan3530" style="">，表示获取锁失</tspan></tspan><tspan id="SvgjsTspan3531" dy="16.25" x="76"><tspan id="SvgjsTspan3532" style="">败</tspan></tspan></text></g></g><g id="SvgjsG3533"><path id="SvgjsPath3534" d="M348.2683691756274 1434.4322411130506L348.2683691756274 1466.0572411130506L348.2683691756274 1466.0572411130506L348.2683691756274 1495.7322411130506" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3535)"></path></g><g id="SvgjsG3537"><path id="SvgjsPath3538" d="M694.8933691756274 1434.4322411130506L694.8933691756274 1457.3697411130506L694.8933691756274 1457.3697411130506L694.8933691756274 1478.3572411130506" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3539)"></path></g><g id="SvgjsG3541" transform="translate(605.8308691756274,1481.0572411130506)"><path id="SvgjsPath3542" d="M 0 44.375L 89.0625 0L 178.125 44.375L 89.0625 88.75Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3543"><text id="SvgjsText3544" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="159px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="17.69375" transform="rotate(0)"><tspan id="SvgjsTspan3545" dy="16.25" x="89.5"><tspan id="SvgjsTspan3546" style="">执行 </tspan></tspan><tspan id="SvgjsTspan3547" dy="16.25" x="89.5"><tspan id="SvgjsTspan3548" style="font-style: italic;">compareAndSetState(0, 1)</tspan><tspan id="SvgjsTspan3549" style=""> </tspan></tspan><tspan id="SvgjsTspan3550" dy="16.25" x="89.5"><tspan id="SvgjsTspan3551" style="">尝试获取锁</tspan></tspan></text></g></g><g id="SvgjsG3552" transform="translate(767.2494297816884,1617.1822411130506)"><path id="SvgjsPath3553" d="M 0 4Q 0 0 4 0L 147.75 0Q 151.75 0 151.75 4L 151.75 50Q 151.75 54 147.75 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#f9f630"></path><g id="SvgjsG3554"><text id="SvgjsText3555" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="132px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.125" transform="rotate(0)"><tspan id="SvgjsTspan3556" dy="16.25" x="76"><tspan id="SvgjsTspan3557" style="">整个 </tspan><tspan id="SvgjsTspan3558" style="font-style: italic;">tryAcquire</tspan><tspan id="SvgjsTspan3559" style=""> 返回 </tspan></tspan><tspan id="SvgjsTspan3560" dy="16.25" x="76"><tspan id="SvgjsTspan3561" style="font-style: italic;">false</tspan><tspan id="SvgjsTspan3562" style="">，表示获取锁失</tspan></tspan><tspan id="SvgjsTspan3563" dy="16.25" x="76"><tspan id="SvgjsTspan3564" style="">败</tspan></tspan></text></g></g><g id="SvgjsG3565"><path id="SvgjsPath3566" d="M784.7058691756274 1525.4322411130506L843.1244297816884 1525.4322411130506L843.1244297816884 1614.4822411130506" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3567)"></path><rect id="SvgjsRect3569" width="29" height="16" x="828.6244297816884" y="1559.579521655185" fill="#ffffff"></rect><text id="SvgjsText3570" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="29px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1556.954521655185" transform="rotate(0)"><tspan id="SvgjsTspan3571" dy="16.25" x="843.1244297816884"><tspan id="SvgjsTspan3572" style="">false</tspan></tspan></text></g><g id="SvgjsG3573"><path id="SvgjsPath3574" d="M605.0808691756274 1525.4322411130506L540.7683691756274 1525.4322411130506L540.7683691756274 1605.8572411130506" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3575)"></path><rect id="SvgjsRect3577" width="24" height="16" x="528.7683691756274" y="1554.064704341989" fill="#ffffff"></rect><text id="SvgjsText3578" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="24px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1551.439704341989" transform="rotate(0)"><tspan id="SvgjsTspan3579" dy="16.25" x="540.7683691756274"><tspan id="SvgjsTspan3580" style="">true</tspan></tspan></text></g><g id="SvgjsG3581" transform="translate(408.8933691756274,1608.5572411130506)"><path id="SvgjsPath3582" d="M 0 4Q 0 0 4 0L 259.75 0Q 263.75 0 263.75 4L 263.75 67.25Q 263.75 71.25 259.75 71.25L 4 71.25Q 0 71.25 0 67.25Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3583"><text id="SvgjsText3584" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="244px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="8.5" transform="rotate(0)"><tspan id="SvgjsTspan3585" dy="16.25" x="132"><tspan id="SvgjsTspan3586" style="">调</tspan></tspan><tspan id="SvgjsTspan3587" dy="16.25" x="132"><tspan id="SvgjsTspan3588" style="">用 </tspan><tspan id="SvgjsTspan3589" style="font-style: italic;">setExclusiveOwnerThread(current)</tspan><tspan id="SvgjsTspan3590" style="">，</tspan></tspan><tspan id="SvgjsTspan3591" dy="16.25" x="132"><tspan id="SvgjsTspan3592" style="">设置当前线程为锁持有线程</tspan></tspan></text></g></g><g id="SvgjsG3593" transform="translate(466.7683691756274,1744.1822411130502)"><path id="SvgjsPath3594" d="M 0 4Q 0 0 4 0L 144 0Q 148 0 148 4L 148 50Q 148 54 144 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e7fbd0"></path><g id="SvgjsG3595"><text id="SvgjsText3596" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="128px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan3597" dy="16.25" x="74"><tspan id="SvgjsTspan3598" style="">整个 </tspan><tspan id="SvgjsTspan3599" style="font-style: italic;">tryAcquire</tspan><tspan id="SvgjsTspan3600" style=""> 返回 </tspan></tspan><tspan id="SvgjsTspan3601" dy="16.25" x="74"><tspan id="SvgjsTspan3602" style="font-style: italic;">true</tspan><tspan id="SvgjsTspan3603" style="">，表示获取锁成功</tspan></tspan></text></g></g><g id="SvgjsG3604"><path id="SvgjsPath3605" d="M540.7683691756274 1680.5572411130506L540.7683691756274 1711.9947411130504L540.7683691756274 1711.9947411130504L540.7683691756274 1741.4822411130501" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3606)"></path></g><g id="SvgjsG3608"><path id="SvgjsPath3609" d="M489.0719260871351 1289.401289670403C 77.36111111111109 1062.8333333333335 59.861111111111086 1964.0833333333335 222.09115177830358 2003.773346484379" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path><rect id="SvgjsRect3610" width="182" height="48" x="43.09200450925704" y="1564.2768145245388" fill="#ffffff"></rect><text id="SvgjsText3611" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="182px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1561.6518145245388" transform="rotate(0)"><tspan id="SvgjsTspan3612" dy="16.25" x="134.09200450925704"><tspan id="SvgjsTspan3613" style="">判断在当前线程前面，是否</tspan></tspan><tspan id="SvgjsTspan3614" dy="16.25" x="134.09200450925704"><tspan id="SvgjsTspan3615" style="">已经有其他线程在排队了；</tspan></tspan><tspan id="SvgjsTspan3616" dy="16.25" x="134.09200450925704"><tspan id="SvgjsTspan3617" style="">有，则表示当前线程也需要排队</tspan></tspan></text></g><g id="SvgjsG3618" transform="translate(222.80272246654704,1904.6353425932766)"><path id="SvgjsPath3619" d="M 0 0L 563.1752873563219 0L 563.1752873563219 198.75L 0 198.75Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3620"><text id="SvgjsText3621" font-family="微软雅黑" text-anchor="start" font-size="13px" width="544px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="15.25" transform="rotate(0)"><tspan id="SvgjsTspan3622" dy="16.25" x="10"><tspan id="SvgjsTspan3623" style="">public final boolean hasQueuedPredecessors() {</tspan></tspan><tspan id="SvgjsTspan3624" dy="16.25" x="10"><tspan id="SvgjsTspan3625" style="">    // The correctness of this depends on head being initialized</tspan></tspan><tspan id="SvgjsTspan3626" dy="16.25" x="10"><tspan id="SvgjsTspan3627" style="">    // before tail and on head.next being accurate if the current</tspan></tspan><tspan id="SvgjsTspan3628" dy="16.25" x="10"><tspan id="SvgjsTspan3629" style="">    // thread is first in queue.</tspan></tspan><tspan id="SvgjsTspan3630" dy="16.25" x="10"><tspan id="SvgjsTspan3631" style="">    AbstractQueuedSynchronizer.Node t = tail; // Read fields in reverse initialization order</tspan></tspan><tspan id="SvgjsTspan3632" dy="16.25" x="10"><tspan id="SvgjsTspan3633" style="">    AbstractQueuedSynchronizer.Node h = head;</tspan></tspan><tspan id="SvgjsTspan3634" dy="16.25" x="10"><tspan id="SvgjsTspan3635" style="">    AbstractQueuedSynchronizer.Node s;</tspan></tspan><tspan id="SvgjsTspan3636" dy="16.25" x="10"><tspan id="SvgjsTspan3637" style="">    return h != t &amp;&amp;</tspan></tspan><tspan id="SvgjsTspan3638" dy="16.25" x="10"><tspan id="SvgjsTspan3639" style="">            ((s = h.next) == null || s.thread != Thread.currentThread());</tspan></tspan><tspan id="SvgjsTspan3640" dy="16.25" x="10"><tspan id="SvgjsTspan3641" style="">}</tspan></tspan></text></g></g><g id="SvgjsG3642"><path id="SvgjsPath3643" d="M504.39036614470797 2104.1353425932766L504.39036614470797 2140.0103425932766L504.39036614470797 2140.0103425932766L504.39036614470797 2175.8853425932766" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path><rect id="SvgjsRect3644" width="231" height="16" x="388.89036614470797" y="2130.3324472703366" fill="#ffffff"></rect><text id="SvgjsText3645" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="231px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2127.7074472703366" transform="rotate(0)"><tspan id="SvgjsTspan3646" dy="16.25" x="504.39036614470797"><tspan id="SvgjsTspan3647" style="">hasQueuedPredecessors 方法执行流程</tspan></tspan></text></g><g id="SvgjsG3648" transform="translate(424.5965443056275,2176.6353425932766)"><path id="SvgjsPath3649" d="M 0 35L 79.79382183908046 0L 159.58764367816093 35L 79.79382183908046 70Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3650"><text id="SvgjsText3651" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="140px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.725" transform="rotate(0)"><tspan id="SvgjsTspan3652" dy="16.25" x="80"><tspan id="SvgjsTspan3653" style="">队列是否初始化？</tspan></tspan></text></g></g><g id="SvgjsG3654"><path id="SvgjsPath3655" d="M423.8465443056275 2211.6353425932766L322.8027224665468 2211.6353425932766L322.8027224665468 2283.729324074758" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3656)"></path><rect id="SvgjsRect3658" width="26" height="16" x="309.8027224665468" y="2235.487219809304" fill="#ffffff"></rect><text id="SvgjsText3659" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="26px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2232.862219809304" transform="rotate(0)"><tspan id="SvgjsTspan3660" dy="16.25" x="322.8027224665468"><tspan id="SvgjsTspan3661" style="">没有</tspan></tspan></text></g><g id="SvgjsG3662" transform="translate(214.0527224665468,2286.8853425932766)"><path id="SvgjsPath3663" d="M 0 4Q 0 0 4 0L 213.5 0Q 217.5 0 217.5 4L 217.5 94.5Q 217.5 98.5 213.5 98.5L 4 98.5Q 0 98.5 0 94.5Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e7fbd0"></path><g id="SvgjsG3664"><text id="SvgjsText3665" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="198px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="14.125" transform="rotate(0)"><tspan id="SvgjsTspan3666" dy="16.25" x="109"><tspan id="SvgjsTspan3667" style="">队列没有初始化，则 </tspan><tspan id="SvgjsTspan3668" style="font-style: italic;">h != t</tspan><tspan id="SvgjsTspan3669" style=""> 返回 </tspan></tspan><tspan id="SvgjsTspan3670" dy="16.25" x="109"><tspan id="SvgjsTspan3671" style="font-style: italic;">false</tspan><tspan id="SvgjsTspan3672" style="">，因为此时 </tspan><tspan id="SvgjsTspan3673" style="font-style: italic;">h == t == null</tspan><tspan id="SvgjsTspan3674" style="">。</tspan></tspan><tspan id="SvgjsTspan3675" dy="16.25" x="109"><tspan id="SvgjsTspan3676" style="">整个 </tspan><tspan id="SvgjsTspan3677" style="font-style: italic;">hasQueuedPredecessors</tspan><tspan id="SvgjsTspan3678" style=""> 方</tspan></tspan><tspan id="SvgjsTspan3679" dy="16.25" x="109"><tspan id="SvgjsTspan3680" style="">法返回 false，</tspan><tspan id="SvgjsTspan3681" style="font-weight: bold;fill: rgb(167, 147, 44);">表示不需要排队</tspan></tspan></text></g></g><g id="SvgjsG3682"><path id="SvgjsPath3683" d="M584.9341879837882 2211.6353425932766L667.8027224665459 2211.6353425932766L667.8027224665459 2298.435342593277" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3684)"></path><rect id="SvgjsRect3686" width="65" height="16" x="635.3027224665459" y="2246.8221627160256" fill="#ffffff"></rect><text id="SvgjsText3687" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="65px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2244.1971627160256" transform="rotate(0)"><tspan id="SvgjsTspan3688" dy="16.25" x="667.8027224665459"><tspan id="SvgjsTspan3689" style="">已经初始化</tspan></tspan></text></g><g id="SvgjsG3690" transform="translate(619.8027224665468,2301.1353425932766)"><path id="SvgjsPath3691" d="M 0 35L 48 0L 96 35L 48 70Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3692"><text id="SvgjsText3693" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.725" transform="rotate(0)"><tspan id="SvgjsTspan3694" dy="16.25" x="48"><tspan id="SvgjsTspan3695" style="">元素个数 &gt; 1</tspan></tspan></text></g></g><g id="SvgjsG3696"><path id="SvgjsPath3697" d="M619.0527224665468 2336.1353425932766L475.8716879837882 2336.1353425932766L475.8716879837882 2409.571307505557" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3698)"></path><rect id="SvgjsRect3700" width="13" height="16" x="469.3716879837882" y="2361.709105918881" fill="#ffffff"></rect><text id="SvgjsText3701" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="13px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2359.084105918881" transform="rotate(0)"><tspan id="SvgjsTspan3702" dy="16.25" x="475.8716879837882"><tspan id="SvgjsTspan3703" style="">否</tspan></tspan></text></g><g id="SvgjsG3704" transform="translate(415.4966879837882,2412.2713075055567)"><path id="SvgjsPath3705" d="M 0 4Q 0 0 4 0L 116.75 0Q 120.75 0 120.75 4L 120.75 50Q 120.75 54 116.75 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3706"><text id="SvgjsText3707" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="101px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan3708" dy="16.25" x="60.5"><tspan id="SvgjsTspan3709" style="">队列元素等于 1</tspan></tspan></text></g></g><g id="SvgjsG3710"><path id="SvgjsPath3711" d="M716.5527224665452 2336.1353425932766L854.3027224665452 2336.1353425932766L854.3027224665452 2405.1853425932763" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3712)"></path><rect id="SvgjsRect3714" width="13" height="16" x="847.8027224665452" y="2361.5301701794833" fill="#ffffff"></rect><text id="SvgjsText3715" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="13px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2358.9051701794833" transform="rotate(0)"><tspan id="SvgjsTspan3716" dy="16.25" x="854.3027224665452"><tspan id="SvgjsTspan3717" style="">是</tspan></tspan></text></g><g id="SvgjsG3718" transform="translate(796.5527224665454,2407.885342593276)"><path id="SvgjsPath3719" d="M 0 4Q 0 0 4 0L 111.5 0Q 115.5 0 115.5 4L 115.5 50Q 115.5 54 111.5 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3720"><text id="SvgjsText3721" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="96px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan3722" dy="16.25" x="58"><tspan id="SvgjsTspan3723" style="">队列元素大于 1</tspan></tspan></text></g></g><g id="SvgjsG3724"><path id="SvgjsPath3725" d="M854.3027224665452 2462.635342593276L854.3027224665452 2505.5103425932766L854.3027224665452 2505.5103425932766L854.3027224665452 2546.4353425932773" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3726)"></path></g><g id="SvgjsG3728" transform="translate(729.9902224665454,2549.135342593277)"><path id="SvgjsPath3729" d="M 0 4Q 0 0 4 0L 244.625 0Q 248.625 0 248.625 4L 248.625 84.75Q 248.625 88.75 244.625 88.75L 4 88.75Q 0 88.75 0 84.75Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3730"><text id="SvgjsText3731" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="229px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="9.25" transform="rotate(0)"><tspan id="SvgjsTspan3732" dy="16.25" x="124.5"><tspan id="SvgjsTspan3733" style="">队列元素大于 1，则至少为 2 个，</tspan></tspan><tspan id="SvgjsTspan3734" dy="16.25" x="124.5"><tspan id="SvgjsTspan3735" style="font-style: italic;">h.next</tspan><tspan id="SvgjsTspan3736" style=""> 指向第二个元素，肯定不是</tspan></tspan><tspan id="SvgjsTspan3737" dy="16.25" x="124.5"><tspan id="SvgjsTspan3738" style="font-style: italic;">null</tspan><tspan id="SvgjsTspan3739" style="">，所以 </tspan><tspan id="SvgjsTspan3740" style="font-style: italic;">(s = h.next) == null</tspan><tspan id="SvgjsTspan3741" style=""> 返回 </tspan></tspan><tspan id="SvgjsTspan3742" dy="16.25" x="124.5"><tspan id="SvgjsTspan3743" style="font-style: italic;">false</tspan></tspan></text></g></g><g id="SvgjsG3744"><path id="SvgjsPath3745" d="M475.8716879837882 2467.0213075055567L475.8716879837882 2514.333807505557L475.8716879837882 2514.333807505557L475.8716879837882 2559.696307505558" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3746)"></path></g><g id="SvgjsG3748" transform="translate(367.55918798378843,2562.3963075055576)"><path id="SvgjsPath3749" d="M 0 4Q 0 0 4 0L 212.625 0Q 216.625 0 216.625 4L 216.625 67Q 216.625 71 212.625 71L 4 71Q 0 71 0 67Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3750"><text id="SvgjsText3751" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="197px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="8.375" transform="rotate(0)"><tspan id="SvgjsTspan3752" dy="16.25" x="108.5"><tspan id="SvgjsTspan3753" style="">当最后一个排队线程也获取到锁之</tspan></tspan><tspan id="SvgjsTspan3754" dy="16.25" x="108.5"><tspan id="SvgjsTspan3755" style="">后，此时 </tspan><tspan id="SvgjsTspan3756" style="font-style: italic;">head = tail</tspan><tspan id="SvgjsTspan3757" style="">，且 </tspan><tspan id="SvgjsTspan3758" style="font-style: italic;">!= </tspan></tspan><tspan id="SvgjsTspan3759" dy="16.25" x="108.5"><tspan id="SvgjsTspan3760" style="font-style: italic;">null</tspan><tspan id="SvgjsTspan3761" style="">。排队队列如左图</tspan></tspan></text></g></g><g id="SvgjsG3762"><path id="SvgjsPath3763" d="M366.80918798378843 2597.8963075055576L335.0844639970976 2597.8963075055576L335.0844639970976 2597.8963075055576L303.35974001040677 2597.8963075055576" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG3764" transform="translate(120.80272246654704,2475.315662344267)"><path id="SvgjsPath3765" d="M 0 0L 181.80701754385964 0L 181.80701754385964 245.16129032258073L 0 245.16129032258073Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e9e9e9"></path><g id="SvgjsG3766"><text id="SvgjsText3767" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="162px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="111.95564516129036" transform="rotate(0)"></text></g></g><g id="SvgjsG3768" transform="translate(173.80272246654704,2491.646289051287)"><path id="SvgjsPath3769" d="M 0 4Q 0 0 4 0L 72.0701754385965 0Q 76.0701754385965 0 76.0701754385965 4L 76.0701754385965 23Q 76.0701754385965 27 72.0701754385965 27L 4 27Q 0 27 0 23Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3770"><text id="SvgjsText3771" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="57px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.875" transform="rotate(0)"><tspan id="SvgjsTspan3772" dy="16.25" x="38.5"><tspan id="SvgjsTspan3773" style="">head</tspan></tspan></text></g></g><g id="SvgjsG3774" transform="translate(173.80272246654704,2555.6813767705858)"><path id="SvgjsPath3775" d="M 0 4Q 0 0 4 0L 72.0701754385965 0Q 76.0701754385965 0 76.0701754385965 4L 76.0701754385965 23Q 76.0701754385965 27 72.0701754385965 27L 4 27Q 0 27 0 23Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3776"><text id="SvgjsText3777" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="57px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.875" transform="rotate(0)"><tspan id="SvgjsTspan3778" dy="16.25" x="38.5"><tspan id="SvgjsTspan3779" style="">tail</tspan></tspan></text></g></g><g id="SvgjsG3780" transform="translate(159.8027224665468,2619.7164644898835)"><path id="SvgjsPath3781" d="M 0 0L 104.5263157894737 0L 104.5263157894737 88.40350877192986L 0 88.40350877192986Z" stroke="rgba(166,174,243,1)" stroke-width="1.5" fill-opacity="1" fill="#fad8ea"></path><g id="SvgjsG3782"><text id="SvgjsText3783" font-family="微软雅黑" text-anchor="start" font-size="13px" width="85px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1.0767543859649322" transform="rotate(0)"><tspan id="SvgjsTspan3784" dy="16.25" x="10"><tspan id="SvgjsTspan3785" style="">Node : n1</tspan></tspan><tspan id="SvgjsTspan3786" dy="16.25" x="10"><tspan id="SvgjsTspan3787" style=""> </tspan></tspan><tspan id="SvgjsTspan3788" dy="16.25" x="10"><tspan id="SvgjsTspan3789" style="">thread = null</tspan></tspan><tspan id="SvgjsTspan3790" dy="16.25" x="10"><tspan id="SvgjsTspan3791" style="">prev = null</tspan></tspan><tspan id="SvgjsTspan3792" dy="16.25" x="10"><tspan id="SvgjsTspan3793" style="">next = null</tspan></tspan></text></g></g><g id="SvgjsG3794"><path id="SvgjsPath3795" d="M173.05272246654704 2505.146289051287L129.80272246654704 2505.146289051287L129.80272246654704 2663.918218875849L157.10272246654677 2663.918218875849" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3796)"></path></g><g id="SvgjsG3798"><path id="SvgjsPath3799" d="M265.079038256021 2663.918218875849L294.3290382560208 2663.918218875849L294.3290382560208 2569.1813767705858L252.5728979051437 2569.1813767705858" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3800)"></path></g><g id="SvgjsG3802"><path id="SvgjsPath3803" d="M475.8716879837882 2634.1463075055576L475.8716879837882 2681.458807505557L475.8716879837882 2681.458807505557L475.8716879837882 2726.821307505557" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3804)"></path></g><g id="SvgjsG3806" transform="translate(413.2521704399287,2729.5213075055567)"><path id="SvgjsPath3807" d="M 0 4Q 0 0 4 0L 121.23903508771923 0Q 125.23903508771923 0 125.23903508771923 4L 125.23903508771923 50Q 125.23903508771923 54 121.23903508771923 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3808"><text id="SvgjsText3809" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="106px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan3810" dy="16.25" x="63"><tspan id="SvgjsTspan3811" style="font-style: italic;">h != t</tspan><tspan id="SvgjsTspan3812" style=""> 返回 </tspan><tspan id="SvgjsTspan3813" style="font-style: italic;">false</tspan></tspan></text></g></g><g id="SvgjsG3814"><path id="SvgjsPath3815" d="M854.3027224665452 2638.635342593277L854.3027224665452 2685.19152196715L854.3027224665452 2685.19152196715L854.3027224665452 2729.797701341023" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3816)"></path></g><g id="SvgjsG3818" transform="translate(733.0264066770717,2732.4730618915214)"><path id="SvgjsPath3819" d="M 0 19.662280701754526L 121.27631578947376 0L 242.5526315789475 19.662280701754526L 121.27631578947376 39.32456140350905Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3820"><text id="SvgjsText3821" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="223px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="9.233903508772071" transform="rotate(0)"><tspan id="SvgjsTspan3822" dy="16.25" x="121.5"><tspan id="SvgjsTspan3823" style="">s.thread != Thread.currentThread()</tspan></tspan></text></g></g><g id="SvgjsG3824"><path id="SvgjsPath3825" d="M732.2764066770717 2752.135342593276L649.3961660683913 2752.135342593276L649.3961660683913 2892.721892300879" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3826)"></path><rect id="SvgjsRect3828" width="29" height="16" x="634.8961660683913" y="2814.3195489750533" fill="#ffffff"></rect><text id="SvgjsText3829" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="29px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2811.6945489750533" transform="rotate(0)"><tspan id="SvgjsTspan3830" dy="16.25" x="649.3961660683913"><tspan id="SvgjsTspan3831" style="">false</tspan></tspan></text></g><g id="SvgjsG3832" transform="translate(413.2521704399287,2895.421892300879)"><path id="SvgjsPath3833" d="M 0 4Q 0 0 4 0L 461.77631578947376 0Q 465.77631578947376 0 465.77631578947376 4L 465.77631578947376 68.88011695906425Q 465.77631578947376 72.88011695906425 461.77631578947376 72.88011695906425L 4 72.88011695906425Q 0 72.88011695906425 0 68.88011695906425Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e7fbd0"></path><g id="SvgjsG3834"><text id="SvgjsText3835" font-family="微软雅黑" text-anchor="start" font-size="13px" width="446px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1.3150584795321265" transform="rotate(0)"><tspan id="SvgjsTspan3836" dy="16.25" x="10"><tspan id="SvgjsTspan3837" style="font-style: italic;">s</tspan><tspan id="SvgjsTspan3838" style=""> 是第二个节点(第一个节点是占位空节点)，代表下一个应该获取锁的线程。</tspan></tspan><tspan id="SvgjsTspan3839" dy="16.25" x="10"><tspan id="SvgjsTspan3840" style="font-style: italic;">s.thread != Thread.currentThread()</tspan><tspan id="SvgjsTspan3841" style=""> 为 </tspan><tspan id="SvgjsTspan3842" style="font-style: italic;">false</tspan><tspan id="SvgjsTspan3843" style="">，表示二者相等，即下一个可以</tspan></tspan><tspan id="SvgjsTspan3844" dy="16.25" x="10"><tspan id="SvgjsTspan3845" style="">获取锁的线程，正是当前线程，所以，此时整个 </tspan><tspan id="SvgjsTspan3846" style="font-style: italic;">hasQueuedPredecessors</tspan><tspan id="SvgjsTspan3847" style=""> 返</tspan></tspan><tspan id="SvgjsTspan3848" dy="16.25" x="10"><tspan id="SvgjsTspan3849" style="">回 </tspan><tspan id="SvgjsTspan3850" style="font-style: italic;">false</tspan><tspan id="SvgjsTspan3851" style="">，</tspan><tspan id="SvgjsTspan3852" style="font-weight: bold;fill: rgb(167, 147, 44);">表示不需要排队</tspan></tspan></text></g></g><g id="SvgjsG3853"><path id="SvgjsPath3854" d="M475.8716879837882 2784.2713075055576L475.8716879837882 2803.7077110143296L475.8716879837882 2803.7077110143296L475.8716879837882 2821.1941145231017" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3855)"></path></g><g id="SvgjsG3857" transform="translate(374.01776078072317,2823.8941145231015)"><path id="SvgjsPath3858" d="M 0 4Q 0 0 4 0L 199.70785440613025 0Q 203.70785440613025 0 203.70785440613025 4L 203.70785440613025 50Q 203.70785440613025 54 199.70785440613025 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e7fbd0"></path><g id="SvgjsG3859"><text id="SvgjsText3860" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="184px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan3861" dy="16.25" x="102"><tspan id="SvgjsTspan3862" style="">整个 </tspan><tspan id="SvgjsTspan3863" style="font-style: italic;">hasQueuedPredecessors</tspan><tspan id="SvgjsTspan3864" style=""> </tspan></tspan><tspan id="SvgjsTspan3865" dy="16.25" x="102"><tspan id="SvgjsTspan3866" style="">返回 </tspan><tspan id="SvgjsTspan3867" style="font-style: italic;">false</tspan><tspan id="SvgjsTspan3868" style="">，</tspan><tspan id="SvgjsTspan3869" style="font-weight: bold;fill: rgb(167, 147, 44);">表示不需要排队</tspan></tspan></text></g></g><g id="SvgjsG3870"><path id="SvgjsPath3871" d="M976.3290382560187 2752.135342593276L1080.8592314927337 2752.135342593276L1080.8592314927337 2886.5140039205075" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker3872)"></path><rect id="SvgjsRect3874" width="24" height="16" x="1068.8592314927337" y="2811.4976964663574" fill="#ffffff"></rect><text id="SvgjsText3875" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="24px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2808.8726964663574" transform="rotate(0)"><tspan id="SvgjsTspan3876" dy="16.25" x="1080.8592314927337"><tspan id="SvgjsTspan3877" style="">true</tspan></tspan></text></g><g id="SvgjsG3878" transform="translate(975.5790382560187,2889.2140039205074)"><path id="SvgjsPath3879" d="M 0 4Q 0 0 4 0L 206.56038647342984 0Q 210.56038647342984 0 210.56038647342984 4L 210.56038647342984 81.29589371980637Q 210.56038647342984 85.29589371980637 206.56038647342984 85.29589371980637L 4 85.29589371980637Q 0 85.29589371980637 0 81.29589371980637Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#f9f630"></path><g id="SvgjsG3880"><text id="SvgjsText3881" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="191px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.4770531400968139" transform="rotate(0)"><tspan id="SvgjsTspan3882" dy="16.25" x="105.5"><tspan id="SvgjsTspan3883" style="">二者不相等，说明下一个可以获</tspan></tspan><tspan id="SvgjsTspan3884" dy="16.25" x="105.5"><tspan id="SvgjsTspan3885" style="">得锁的线程，不是当前线程，所</tspan></tspan><tspan id="SvgjsTspan3886" dy="16.25" x="105.5"><tspan id="SvgjsTspan3887" style="">以整</tspan></tspan><tspan id="SvgjsTspan3888" dy="16.25" x="105.5"><tspan id="SvgjsTspan3889" style="">个 </tspan><tspan id="SvgjsTspan3890" style="font-style: italic;">hasQueuedPredecessors</tspan><tspan id="SvgjsTspan3891" style=""> 返</tspan></tspan><tspan id="SvgjsTspan3892" dy="16.25" x="105.5"><tspan id="SvgjsTspan3893" style="">回 </tspan><tspan id="SvgjsTspan3894" style="font-style: italic;">true</tspan><tspan id="SvgjsTspan3895" style="">，表示需要排队</tspan></tspan></text></g></g><g id="SvgjsG3896" transform="translate(102.30022005041405,1854.7657773758856)"><path id="SvgjsPath3897" d="M 0 0L 248.81089106069703 0L 248.81089106069703 48.75L 0 48.75Z" stroke="none" fill="none"></path><g id="SvgjsG3898"><text id="SvgjsText3899" font-family="微软雅黑" text-anchor="middle" font-size="19px" width="249px" fill="#7985ec" font-weight="700" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="19px" weight="700" font-style="" opacity="1" y="-4" transform="rotate(0)"><tspan id="SvgjsTspan3900" dy="23.75" x="124.5"><tspan id="SvgjsTspan3901" style="">hasQueuedPredecessors </tspan></tspan><tspan id="SvgjsTspan3902" dy="23.75" x="124.5"><tspan id="SvgjsTspan3903" style="">方法执行流程</tspan></tspan></text></g></g><g id="SvgjsG3904" transform="translate(99.11656382817296,495.4299242424242)"><path id="SvgjsPath3905" d="M 0 0L 236.5 0L 236.5 70.77651515151524L 0 70.77651515151524Z" stroke="none" fill="none"></path><g id="SvgjsG3906"><text id="SvgjsText3907" font-family="微软雅黑" text-anchor="middle" font-size="17px" width="237px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="17px" weight="400" font-style="" opacity="1" y="20.76325757575762" transform="rotate(0)"><tspan id="SvgjsTspan3908" dy="21.25" x="118.5"><tspan id="SvgjsTspan3909" style="font-weight: bold;fill: rgb(167, 147, 44);">tryAcquire 方法执行流程详解</tspan></tspan></text></g></g><g id="SvgjsG3910"><path id="SvgjsPath3911" d="M2056.9576161185823 932.3219823399656C 2408.136017421608 932.333333333333 2492.889251312473 542.2319347319344 2844.0676526154975 542.2432857253023" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path><rect id="SvgjsRect3912" width="78" height="16" x="2385.3226338339778" y="752.6381024571674" fill="#ffffff"></rect><text id="SvgjsText3913" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="78px" fill="#a7932c" font-weight="700" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="700" font-style="" opacity="1" y="750.0131024571674" transform="rotate(0)"><tspan id="SvgjsTspan3914" dy="16.25" x="2424.3226338339778"><tspan id="SvgjsTspan3915" style="">执行排队逻辑</tspan></tspan></text></g><g id="SvgjsG3916" transform="translate(2844.8175667138785,406.7319347319349)"><path id="SvgjsPath3917" d="M 0 0L 388.34920634920627 0L 388.34920634920627 271L 0 271Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG3918"><text id="SvgjsText3919" font-family="微软雅黑" text-anchor="start" font-size="13px" width="369px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="18.875" transform="rotate(0)"><tspan id="SvgjsTspan3920" dy="16.25" x="10"><tspan id="SvgjsTspan3921" style="">private Node addWaiter(Node mode) {</tspan></tspan><tspan id="SvgjsTspan3922" dy="16.25" x="10"><tspan id="SvgjsTspan3923" style="">   Node node = new Node(Thread.currentThread(), mode);</tspan></tspan><tspan id="SvgjsTspan3924" dy="16.25" x="10"><tspan id="SvgjsTspan3925" style="">    // Try the fast path of enq; backup to full enq on failure</tspan></tspan><tspan id="SvgjsTspan3926" dy="16.25" x="10"><tspan id="SvgjsTspan3927" style="">    Node pred = tail;</tspan></tspan><tspan id="SvgjsTspan3928" dy="16.25" x="10"><tspan id="SvgjsTspan3929" style="">    if (pred != null) {</tspan></tspan><tspan id="SvgjsTspan3930" dy="16.25" x="10"><tspan id="SvgjsTspan3931" style="">        node.prev = pred;</tspan></tspan><tspan id="SvgjsTspan3932" dy="16.25" x="10"><tspan id="SvgjsTspan3933" style="">        if (compareAndSetTail(pred, node)) {</tspan></tspan><tspan id="SvgjsTspan3934" dy="16.25" x="10"><tspan id="SvgjsTspan3935" style="">            pred.next = node;</tspan></tspan><tspan id="SvgjsTspan3936" dy="16.25" x="10"><tspan id="SvgjsTspan3937" style="">            return node;</tspan></tspan><tspan id="SvgjsTspan3938" dy="16.25" x="10"><tspan id="SvgjsTspan3939" style="">        }</tspan></tspan><tspan id="SvgjsTspan3940" dy="16.25" x="10"><tspan id="SvgjsTspan3941" style="">    }</tspan></tspan><tspan id="SvgjsTspan3942" dy="16.25" x="10"><tspan id="SvgjsTspan3943" style="">    enq(node);</tspan></tspan><tspan id="SvgjsTspan3944" dy="16.25" x="10"><tspan id="SvgjsTspan3945" style="">    return node;</tspan></tspan><tspan id="SvgjsTspan3946" dy="16.25" x="10"><tspan id="SvgjsTspan3947" style="">}</tspan></tspan></text></g></g><g id="SvgjsG3948" transform="translate(2871.8060227023334,512.1922521922525)"><path id="SvgjsPath3949" d="M 0 0L 232.78932178932246 0L 232.78932178932246 81.76190476190482L 0 81.76190476190482Z" stroke="none" fill-opacity="1" fill="#f9f469"></path><g id="SvgjsG3950"><text id="SvgjsText3951" font-family="微软雅黑" text-anchor="start" font-size="13px" width="213px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="-10.744047619047592" transform="rotate(0)"><tspan id="SvgjsTspan3952" dy="16.25" x="10"><tspan id="SvgjsTspan3953" style="">node.prev = pred;</tspan></tspan><tspan id="SvgjsTspan3954" dy="16.25" x="10"><tspan id="SvgjsTspan3955" style="">if (compareAndSetTail(pred, node))</tspan></tspan><tspan id="SvgjsTspan3956" dy="16.25" x="10"><tspan id="SvgjsTspan3957" style=""> {</tspan></tspan><tspan id="SvgjsTspan3958" dy="16.25" x="10"><tspan id="SvgjsTspan3959" style="">    pred.next = node;</tspan></tspan><tspan id="SvgjsTspan3960" dy="16.25" x="10"><tspan id="SvgjsTspan3961" style="">    return node;</tspan></tspan><tspan id="SvgjsTspan3962" dy="16.25" x="10"><tspan id="SvgjsTspan3963" style="">}</tspan></tspan></text></g></g><g id="SvgjsG3964" transform="translate(2861.077306973618,606.8268742576834)"><path id="SvgjsPath3965" d="M 0 0L 101.04329004329065 0L 101.04329004329065 20L 0 20Z" stroke="none" fill-opacity="1" fill="#f9f469"></path><g id="SvgjsG3966"><text id="SvgjsText3967" font-family="微软雅黑" text-anchor="start" font-size="13px" width="82px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.625" transform="rotate(0)"><tspan id="SvgjsTspan3968" dy="16.25" x="10"><tspan id="SvgjsTspan3969" style="">enq(node);</tspan></tspan></text></g></g><g id="SvgjsG3970" transform="translate(3073.642963539276,575.5414585414583)"><path id="SvgjsPath3971" d="M 0 0L 30.158730158730123 0L 30.158730158730123 19.325098255907733L 0 19.325098255907733Z" stroke="none" fill="none"></path><g id="SvgjsG3972"><text id="SvgjsText3973" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="31px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.9624508720461336" transform="rotate(0)"><tspan id="SvgjsTspan3974" dy="16.25" x="15.5"><tspan id="SvgjsTspan3975" style="">❶</tspan></tspan></text></g></g><g id="SvgjsG3976" transform="translate(2942.1205970169085,607.5649694957788)"><path id="SvgjsPath3977" d="M 0 0L 20 0L 20 20L 0 20Z" stroke="none" fill="none"></path><g id="SvgjsG3978"><text id="SvgjsText3979" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="20px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.625" transform="rotate(0)"><tspan id="SvgjsTspan3980" dy="16.25" x="10"><tspan id="SvgjsTspan3981" style="">❷</tspan></tspan></text></g></g><g id="SvgjsG3982" transform="translate(4108.3393058443135,198.56133215377406)"><path id="SvgjsPath3983" d="M 0 0L 250 0L 250 65L 0 65Z" stroke="none" fill="none"></path><g id="SvgjsG3984"><text id="SvgjsText3985" font-family="微软雅黑" text-anchor="start" font-size="13px" width="250px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="5.375" transform="rotate(0)"><tspan id="SvgjsTspan3986" dy="16.25" x="0"><tspan id="SvgjsTspan3987" style="">这部分逻辑，是尝试获取锁失败的情况下，</tspan></tspan><tspan id="SvgjsTspan3988" dy="16.25" x="0"><tspan id="SvgjsTspan3989" style="">当前线程(尝试获取锁的)封装成 </tspan><tspan id="SvgjsTspan3990" style="font-style: italic;">Node</tspan><tspan id="SvgjsTspan3991" style=""> 对</tspan></tspan><tspan id="SvgjsTspan3992" dy="16.25" x="0"><tspan id="SvgjsTspan3993" style="">象，加入到 AQS 队列的处理逻辑</tspan></tspan></text></g></g><g id="SvgjsG3994" transform="translate(4244.7029422079495,263.20404965133076)"><path id="SvgjsPath3995" d="M 0 0L 100 0L 100 68.5757575757575L 0 68.5757575757575Z" stroke="none" fill="none"></path><g id="SvgjsG3996"><text id="SvgjsText3997" font-family="微软雅黑" text-anchor="middle" font-size="60px" width="100px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="60px" weight="400" font-style="" opacity="1" y="-15.712121212121247" transform="rotate(0)"><tspan id="SvgjsTspan3998" dy="75" x="50"><tspan id="SvgjsTspan3999" style="font-weight: bold;">②</tspan></tspan></text></g></g><g id="SvgjsG4000"><path id="SvgjsPath4001" d="M3233.9084161291103 542.1202854479304C 3295.2460181584165 542.2319347319344 3275.2206963866365 427.15484130068813 3337.299941481967 427.15484130068813" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4002" transform="translate(3337.299941481967,342.92911589452086)"><path id="SvgjsPath4003" d="M 0 0L 372.6363636363635 0L 388.6363636363635 16L 388.6363636363635 181.60563767482836L 0 181.60563767482836L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath4004" d="M 372.6363636363635 0L 372.6363636363635 16L 388.6363636363635 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath4005" d="M 0 0L 372.6363636363635 0L 388.6363636363635 16L 388.6363636363635 181.60563767482836L 0 181.60563767482836L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG4006"><text id="SvgjsText4007" font-family="微软雅黑" text-anchor="start" font-size="13px" width="369px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.677818837414179" transform="rotate(0)"><tspan id="SvgjsTspan4008" dy="16.25" x="10"><tspan id="SvgjsTspan4009" style="">将当前线程封装成 </tspan><tspan id="SvgjsTspan4010" style="font-style: italic;">Node</tspan><tspan id="SvgjsTspan4011" style=""> 对象，并加入排队队列中</tspan></tspan><tspan id="SvgjsTspan4012" dy="16.25" x="10"><tspan id="SvgjsTspan4013" style=""> </tspan></tspan><tspan id="SvgjsTspan4014" dy="16.25" x="10"><tspan id="SvgjsTspan4015" style="">根据排队队列是否执行过初始化，执行❶、❷不同处理逻辑。</tspan></tspan><tspan id="SvgjsTspan4016" dy="16.25" x="10"><tspan id="SvgjsTspan4017" style=""> </tspan></tspan><tspan id="SvgjsTspan4018" dy="16.25" x="10"><tspan id="SvgjsTspan4019" style="">❶：表示排队队列不为空，即之前已经初始化过了，此时只需将</tspan></tspan><tspan id="SvgjsTspan4020" dy="16.25" x="10"><tspan id="SvgjsTspan4021" style="">新的 </tspan><tspan id="SvgjsTspan4022" style="font-style: italic;">node</tspan><tspan id="SvgjsTspan4023" style=""> 加入排队队列末尾即可</tspan></tspan><tspan id="SvgjsTspan4024" dy="16.25" x="10"><tspan id="SvgjsTspan4025" style=""> </tspan></tspan><tspan id="SvgjsTspan4026" dy="16.25" x="10"><tspan id="SvgjsTspan4027" style="">❷：表示排队队列为空，需要执行队列初始化。 </tspan><tspan id="SvgjsTspan4028" style="font-style: italic;">enq(node)</tspan><tspan id="SvgjsTspan4029" style=""> 会初</tspan></tspan><tspan id="SvgjsTspan4030" dy="16.25" x="10"><tspan id="SvgjsTspan4031" style="">始化一个空的 </tspan><tspan id="SvgjsTspan4032" style="font-style: italic;">Node</tspan><tspan id="SvgjsTspan4033" style="">，作为排队队列的 </tspan><tspan id="SvgjsTspan4034" style="font-style: italic;">head</tspan><tspan id="SvgjsTspan4035" style=""> ，然后将需要排队</tspan></tspan><tspan id="SvgjsTspan4036" dy="16.25" x="10"><tspan id="SvgjsTspan4037" style="">的线程，作为 </tspan><tspan id="SvgjsTspan4038" style="font-style: italic;">head</tspan><tspan id="SvgjsTspan4039" style=""> 的 </tspan><tspan id="SvgjsTspan4040" style="font-style: italic;">next</tspan><tspan id="SvgjsTspan4041" style=""> 节点插入</tspan></tspan></text></g></g><g id="SvgjsG4042"><path id="SvgjsPath4043" d="M3038.992169888481 678.4819347319344L3038.992169888481 778.9364801864804" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4044" transform="translate(2990.992169888481,779.955842511652)"><path id="SvgjsPath4045" d="M 0 35L 48 0L 96 35L 48 70Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4046"><text id="SvgjsText4047" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="24.725" transform="rotate(0)"><tspan id="SvgjsTspan4048" dy="16.25" x="48"><tspan id="SvgjsTspan4049" style="">pred != null</tspan></tspan></text></g></g><g id="SvgjsG4050"><path id="SvgjsPath4051" d="M3087.7421698884827 814.955842511652L3219.9993848956974 814.955842511652L3219.9993848956974 889.4717516025607" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4052)"></path><rect id="SvgjsRect4054" width="133" height="16" x="3153.4993848956974" y="843.4839414040785" fill="#ffffff"></rect><text id="SvgjsText4055" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="133px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="840.8589414040785" transform="rotate(0)"><tspan id="SvgjsTspan4056" dy="16.25" x="3219.9993848956974"><tspan id="SvgjsTspan4057" style="">false，执行上图步骤❷</tspan></tspan></text></g><g id="SvgjsG4058" transform="translate(3133.6357485320605,892.1717516025608)"><path id="SvgjsPath4059" d="M 0 4Q 0 0 4 0L 168.72727272727252 0Q 172.72727272727252 0 172.72727272727252 4L 172.72727272727252 53.673819493010114Q 172.72727272727252 57.673819493010114 168.72727272727252 57.673819493010114L 4 57.673819493010114Q 0 57.673819493010114 0 53.673819493010114Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4060"><text id="SvgjsText4061" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="153px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1.7119097465050572" transform="rotate(0)"><tspan id="SvgjsTspan4062" dy="16.25" x="86.5"><tspan id="SvgjsTspan4063" style="">没有其他线程在排队，调</tspan></tspan><tspan id="SvgjsTspan4064" dy="16.25" x="86.5"><tspan id="SvgjsTspan4065" style="">用 </tspan><tspan id="SvgjsTspan4066" style="font-style: italic;">enq(node)</tspan><tspan id="SvgjsTspan4067" style=""> 构造队列，</tspan></tspan><tspan id="SvgjsTspan4068" dy="16.25" x="86.5"><tspan id="SvgjsTspan4069" style="">并将 </tspan><tspan id="SvgjsTspan4070" style="font-style: italic;">node</tspan><tspan id="SvgjsTspan4071" style=""> 加入到队列</tspan></tspan></text></g></g><g id="SvgjsG4072"><path id="SvgjsPath4073" d="M2990.242169888481 814.955842511652L2883.0069606532716 814.955842511652L2883.0069606532716 892.8197100420177" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4074)"></path><rect id="SvgjsRect4076" width="128" height="16" x="2819.0069606532716" y="843.6180603662889" fill="#ffffff"></rect><text id="SvgjsText4077" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="128px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="840.9930603662889" transform="rotate(0)"><tspan id="SvgjsTspan4078" dy="16.25" x="2883.0069606532716"><tspan id="SvgjsTspan4079" style="">true，执行上图步骤❶</tspan></tspan></text></g><g id="SvgjsG4080" transform="translate(2803.8933242896355,893.1603879661973)"><path id="SvgjsPath4081" d="M 0 4Q 0 0 4 0L 154.22727272727298 0Q 158.22727272727298 0 158.22727272727298 4L 158.22727272727298 51.69654676573737Q 158.22727272727298 55.69654676573737 154.22727272727298 55.69654676573737L 4 55.69654676573737Q 0 55.69654676573737 0 51.69654676573737Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4082"><text id="SvgjsText4083" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="139px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="0.7232733828686833" transform="rotate(0)"><tspan id="SvgjsTspan4084" dy="16.25" x="79.5"><tspan id="SvgjsTspan4085" style="">队列已经初始化，将 </tspan></tspan><tspan id="SvgjsTspan4086" dy="16.25" x="79.5"><tspan id="SvgjsTspan4087" style="font-style: italic;">node</tspan><tspan id="SvgjsTspan4088" style=""> 加入到队列末尾，</tspan></tspan><tspan id="SvgjsTspan4089" dy="16.25" x="79.5"><tspan id="SvgjsTspan4090" style="">加入后队列可能如下</tspan></tspan></text></g></g><g id="SvgjsG4091"><path id="SvgjsPath4092" d="M2883.0069606532716 949.6069347319349L2883.0069606532716 980.1807983682986L2883.0069606532716 980.1807983682986L2883.0069606532716 1008.8046620046623" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4093)"></path></g><g id="SvgjsG4095" transform="translate(2835.0069606532716,1011.5046620046624)"><path id="SvgjsPath4096" d="M 0 4Q 0 0 4 0L 92 0Q 96 0 96 4L 96 50Q 96 54 92 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4097"><text id="SvgjsText4098" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan4099" dy="16.25" x="48"><tspan id="SvgjsTspan4100" style="">返回 </tspan><tspan id="SvgjsTspan4101" style="font-style: italic;">node</tspan></tspan></text></g></g><g id="SvgjsG4102"><path id="SvgjsPath4103" d="M3219.9993848956974 950.5955710955714L3219.9993848956974 982.3699808420763L3219.9993848956974 982.3699808420763L3219.9993848956974 1012.1943905885812" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4104)"></path></g><g id="SvgjsG4106" transform="translate(3171.9993848956974,1011.5046620046624)"><path id="SvgjsPath4107" d="M 0 4Q 0 0 4 0L 92 0Q 96 0 96 4L 96 50Q 96 54 92 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4108"><text id="SvgjsText4109" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan4110" dy="16.25" x="48"><tspan id="SvgjsTspan4111" style="">返回 </tspan><tspan id="SvgjsTspan4112" style="font-style: italic;">node</tspan></tspan></text></g></g><g id="SvgjsG4113"><path id="SvgjsPath4114" d="M3307.1130212593334 921.0086613490657L3390.8824550013233 921.0086613490657L3390.8824550013233 921.0086613490666L3472.7018887433132 921.0086613490666" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4115)"></path><rect id="SvgjsRect4117" width="52" height="16" x="3339.290791516738" y="913.008661349066" fill="#ffffff"></rect><text id="SvgjsText4118" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="52px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="910.383661349066" transform="rotate(0)"><tspan id="SvgjsTspan4119" dy="16.25" x="3365.290791516738"><tspan id="SvgjsTspan4120" style="">enq 方法</tspan></tspan></text></g><g id="SvgjsG4121" transform="translate(3464.6422420385543,781.2386163862179)"><path id="SvgjsPath4122" d="M 0 0L 302.9916512059376 0L 302.9916512059376 279.54008992569675L 0 279.54008992569675Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4123"><text id="SvgjsText4124" font-family="微软雅黑" text-anchor="start" font-size="13px" width="283px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="15.145044962848374" transform="rotate(0)"><tspan id="SvgjsTspan4125" dy="16.25" x="10"><tspan id="SvgjsTspan4126" style="">private Node enq(final Node node) {</tspan></tspan><tspan id="SvgjsTspan4127" dy="16.25" x="10"><tspan id="SvgjsTspan4128" style="">    for (;;) {</tspan></tspan><tspan id="SvgjsTspan4129" dy="16.25" x="10"><tspan id="SvgjsTspan4130" style="">        Node t = tail;</tspan></tspan><tspan id="SvgjsTspan4131" dy="16.25" x="10"><tspan id="SvgjsTspan4132" style="">        if (t == null) { // Must initialize</tspan></tspan><tspan id="SvgjsTspan4133" dy="16.25" x="10"><tspan id="SvgjsTspan4134" style="">            if (compareAndSetHead(Node()))</tspan></tspan><tspan id="SvgjsTspan4135" dy="16.25" x="10"><tspan id="SvgjsTspan4136" style="">                tail = head;</tspan></tspan><tspan id="SvgjsTspan4137" dy="16.25" x="10"><tspan id="SvgjsTspan4138" style="">        } else {</tspan></tspan><tspan id="SvgjsTspan4139" dy="16.25" x="10"><tspan id="SvgjsTspan4140" style="">            node.prev = t;</tspan></tspan><tspan id="SvgjsTspan4141" dy="16.25" x="10"><tspan id="SvgjsTspan4142" style="">            if (compareAndSetTail(t, node)) {</tspan></tspan><tspan id="SvgjsTspan4143" dy="16.25" x="10"><tspan id="SvgjsTspan4144" style="">                t.next = node;</tspan></tspan><tspan id="SvgjsTspan4145" dy="16.25" x="10"><tspan id="SvgjsTspan4146" style="">                return t;</tspan></tspan><tspan id="SvgjsTspan4147" dy="16.25" x="10"><tspan id="SvgjsTspan4148" style="">            }</tspan></tspan><tspan id="SvgjsTspan4149" dy="16.25" x="10"><tspan id="SvgjsTspan4150" style="">        }</tspan></tspan><tspan id="SvgjsTspan4151" dy="16.25" x="10"><tspan id="SvgjsTspan4152" style="">    }</tspan></tspan><tspan id="SvgjsTspan4153" dy="16.25" x="10"><tspan id="SvgjsTspan4154" style="">}</tspan></tspan></text></g></g><g id="SvgjsG4155"><path id="SvgjsPath4156" d="M3768.3838932444914 921.0086613490662L3846.773503634102 921.0086613490662L3846.773503634102 921.0086613490657L3925.1631140237123 921.0086613490657" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4157" transform="translate(3925.9131140237123,667.693479039187)"><path id="SvgjsPath4158" d="M 0 4Q 0 0 4 0L 392.590909090909 0Q 396.590909090909 0 396.590909090909 4L 396.590909090909 502.63036461975753Q 396.590909090909 506.63036461975753 392.590909090909 506.63036461975753L 4 506.63036461975753Q 0 506.63036461975753 0 502.63036461975753Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e9e9e9"></path><g id="SvgjsG4159"><text id="SvgjsText4160" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="377px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="242.69018230987876" transform="rotate(0)"></text></g></g><g id="SvgjsG4161" transform="translate(3929.3222049328024,672.1500241659346)"><path id="SvgjsPath4162" d="M 0 0L 415.909090909091 0L 415.909090909091 48.75L 0 48.75Z" stroke="none" fill="none"></path><g id="SvgjsG4163"><text id="SvgjsText4164" font-family="微软雅黑" text-anchor="start" font-size="13px" width="416px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="5.25" transform="rotate(0)"><tspan id="SvgjsTspan4165" dy="16.25" x="0"><tspan id="SvgjsTspan4166" style="">AQS 有两个属性 </tspan><tspan id="SvgjsTspan4167" style="font-style: italic;">head</tspan><tspan id="SvgjsTspan4168" style=""> 和 </tspan><tspan id="SvgjsTspan4169" style="font-style: italic;">tail</tspan><tspan id="SvgjsTspan4170" style="">，分别用来保持 AQS 队列的头尾节点。</tspan></tspan><tspan id="SvgjsTspan4171" dy="16.25" x="0"><tspan id="SvgjsTspan4172" style="">初始时，这两个属性都是 </tspan><tspan id="SvgjsTspan4173" style="font-style: italic;">null</tspan><tspan id="SvgjsTspan4174" style="">。当有一个线程排队，队列如下</tspan></tspan></text></g></g><g id="SvgjsG4175" transform="translate(4153.776750387348,781.4000241659351)"><path id="SvgjsPath4176" d="M 0 4Q 0 0 4 0L 116.72727272727298 0Q 120.72727272727298 0 120.72727272727298 4L 120.72727272727298 151.42381949301011Q 120.72727272727298 155.42381949301011 116.72727272727298 155.42381949301011L 4 155.42381949301011Q 0 155.42381949301011 0 151.42381949301011Z" stroke="none" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4177"><text id="SvgjsText4178" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="101px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.086909746505057" transform="rotate(0)"><tspan id="SvgjsTspan4179" dy="16.25" x="60.5"><tspan id="SvgjsTspan4180" style="">AQS队列(链表)</tspan></tspan><tspan id="SvgjsTspan4181" dy="16.25" x="60.5"><tspan id="SvgjsTspan4182" style=""> </tspan></tspan><tspan id="SvgjsTspan4183" dy="16.25" x="60.5"><tspan id="SvgjsTspan4184" style=""> </tspan></tspan><tspan id="SvgjsTspan4185" dy="16.25" x="60.5"><tspan id="SvgjsTspan4186" style=""> </tspan></tspan><tspan id="SvgjsTspan4187" dy="16.25" x="60.5"><tspan id="SvgjsTspan4188" style=""> </tspan></tspan><tspan id="SvgjsTspan4189" dy="16.25" x="60.5"><tspan id="SvgjsTspan4190" style=""> </tspan></tspan><tspan id="SvgjsTspan4191" dy="16.25" x="60.5"><tspan id="SvgjsTspan4192" style=""> </tspan></tspan><tspan id="SvgjsTspan4193" dy="16.25" x="60.5"><tspan id="SvgjsTspan4194" style=""> </tspan></tspan></text></g></g><g id="SvgjsG4195" transform="translate(4174.776750387348,823.4602072953089)"><path id="SvgjsPath4196" d="M 0 4Q 0 0 4 0L 75.81818181818198 0Q 79.81818181818198 0 79.81818181818198 4L 79.81818181818198 26.409090909090764Q 79.81818181818198 30.409090909090764 75.81818181818198 30.409090909090764L 4 30.409090909090764Q 0 30.409090909090764 0 26.409090909090764Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4197"><text id="SvgjsText4198" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="60px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="4.579545454545382" transform="rotate(0)"><tspan id="SvgjsTspan4199" dy="16.25" x="40"><tspan id="SvgjsTspan4200" style="">head</tspan></tspan></text></g></g><g id="SvgjsG4201" transform="translate(4174.776750387348,881.4147527498542)"><path id="SvgjsPath4202" d="M 0 4Q 0 0 4 0L 75.81818181818198 0Q 79.81818181818198 0 79.81818181818198 4L 79.81818181818198 26.409090909090764Q 79.81818181818198 30.409090909090764 75.81818181818198 30.409090909090764L 4 30.409090909090764Q 0 30.409090909090764 0 26.409090909090764Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4203"><text id="SvgjsText4204" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="60px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="4.579545454545382" transform="rotate(0)"><tspan id="SvgjsTspan4205" dy="16.25" x="40"><tspan id="SvgjsTspan4206" style="">tail</tspan></tspan></text></g></g><g id="SvgjsG4207" transform="translate(3952.0494776600744,1006.0511163862179)"><path id="SvgjsPath4208" d="M 0 4Q 0 0 4 0L 332.36363636363785 0Q 336.36363636363785 0 336.36363636363785 4L 336.36363636363785 131.31818181818176Q 336.36363636363785 135.31818181818176 332.36363636363785 135.31818181818176L 4 135.31818181818176Q 0 135.31818181818176 0 131.31818181818176Z" stroke="none" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4209"><text id="SvgjsText4210" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="317px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="57.03409090909088" transform="rotate(0)"></text></g></g><g id="SvgjsG4211" transform="translate(3977.9131140237123,1018.9000241659351)"><path id="SvgjsPath4212" d="M 0 4Q 0 0 4 0L 92 0Q 96 0 96 4L 96 80.66708959789821Q 96 84.66708959789821 92 84.66708959789821L 4 84.66708959789821Q 0 84.66708959789821 0 80.66708959789821Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#fad8ea"></path><g id="SvgjsG4213"><text id="SvgjsText4214" font-family="微软雅黑" text-anchor="start" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.7914552010508942" transform="rotate(0)"><tspan id="SvgjsTspan4215" dy="16.25" x="10"><tspan id="SvgjsTspan4216" style="">Node : n1</tspan></tspan><tspan id="SvgjsTspan4217" dy="16.25" x="10"><tspan id="SvgjsTspan4218" style=""> </tspan></tspan><tspan id="SvgjsTspan4219" dy="16.25" x="10"><tspan id="SvgjsTspan4220" style="">thread = null</tspan></tspan><tspan id="SvgjsTspan4221" dy="16.25" x="10"><tspan id="SvgjsTspan4222" style="">prev = null</tspan></tspan><tspan id="SvgjsTspan4223" dy="16.25" x="10"><tspan id="SvgjsTspan4224" style="">next = null</tspan></tspan></text></g></g><g id="SvgjsG4225" transform="translate(4166.140386750984,1018.9000241659351)"><path id="SvgjsPath4226" d="M 0 4Q 0 0 4 0L 92 0Q 96 0 96 4L 96 80.66708959789821Q 96 84.66708959789821 92 84.66708959789821L 4 84.66708959789821Q 0 84.66708959789821 0 80.66708959789821Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4227"><text id="SvgjsText4228" font-family="微软雅黑" text-anchor="start" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.7914552010508942" transform="rotate(0)"><tspan id="SvgjsTspan4229" dy="16.25" x="10"><tspan id="SvgjsTspan4230" style="">Node : n2</tspan></tspan><tspan id="SvgjsTspan4231" dy="16.25" x="10"><tspan id="SvgjsTspan4232" style=""> </tspan></tspan><tspan id="SvgjsTspan4233" dy="16.25" x="10"><tspan id="SvgjsTspan4234" style="">thread = t2</tspan></tspan><tspan id="SvgjsTspan4235" dy="16.25" x="10"><tspan id="SvgjsTspan4236" style="">prev = n1</tspan></tspan><tspan id="SvgjsTspan4237" dy="16.25" x="10"><tspan id="SvgjsTspan4238" style="">next = null</tspan></tspan></text></g></g><g id="SvgjsG4239"><path id="SvgjsPath4240" d="M4165.390386750984 1061.233568964884L4120.026750387348 1061.233568964884L4120.026750387348 1061.233568964884L4076.613114023712 1061.233568964884" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4241)"></path><rect id="SvgjsRect4243" width="26" height="16" x="4108.942656644433" y="1053.233568964884" fill="#ffffff"></rect><text id="SvgjsText4244" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="26px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1050.608568964884" transform="rotate(0)"><tspan id="SvgjsTspan4245" dy="16.25" x="4121.942656644433"><tspan id="SvgjsTspan4246" style="">prev</tspan></tspan></text></g><g id="SvgjsG4247"><path id="SvgjsPath4248" d="M4025.9131140237123 1104.3171137638333L4025.9131140237123 1133.5671137638333L4214.140386750984 1133.5671137638333L4214.140386750984 1106.2671137638333" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4249)"></path><rect id="SvgjsRect4251" width="26" height="16" x="4105.132883130269" y="1125.5671137638333" fill="#ffffff"></rect><text id="SvgjsText4252" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="26px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1122.9421137638333" transform="rotate(0)"><tspan id="SvgjsTspan4253" dy="16.25" x="4118.132883130269"><tspan id="SvgjsTspan4254" style="">next</tspan></tspan></text></g><g id="SvgjsG4255"><path id="SvgjsPath4256" d="M4214.68584129644 912.573843658945L4214.68584129644 965.36193391244L4214.68584129644 965.36193391244L4214.68584129644 1016.200024165935" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4257)"></path></g><g id="SvgjsG4259"><path id="SvgjsPath4260" d="M4174.026750387348 838.6647527498542L4025.9131140237123 838.6647527498542L4025.9131140237123 1016.200024165935" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4261)"></path></g><g id="SvgjsG4263"><path id="SvgjsPath4264" d="M3616.317821919988 780.5104760155657C 3616.138067641524 745.2833926217245 3678.4798445282304 752.4376352022621 3678.4798445282304 716.4824114377684" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4265" transform="translate(3525.9288241200684,607.5649694957788)"><path id="SvgjsPath4266" d="M 0 0L 289.1020408163258 0L 305.1020408163258 16L 305.1020408163258 108.91744194198941L 0 108.91744194198941L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath4267" d="M 289.1020408163258 0L 289.1020408163258 16L 305.1020408163258 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath4268" d="M 0 0L 289.1020408163258 0L 305.1020408163258 16L 305.1020408163258 108.91744194198941L 0 108.91744194198941L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG4269"><text id="SvgjsText4270" font-family="微软雅黑" text-anchor="start" font-size="13px" width="286px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.8337209709947047" transform="rotate(0)"><tspan id="SvgjsTspan4271" dy="16.25" x="10"><tspan id="SvgjsTspan4272" style="">队列尚未初始化，调用这个 </tspan><tspan id="SvgjsTspan4273" style="font-style: italic;">enq</tspan><tspan id="SvgjsTspan4274" style=""> 方法。</tspan></tspan><tspan id="SvgjsTspan4275" dy="16.25" x="10"><tspan id="SvgjsTspan4276" style=""> </tspan></tspan><tspan id="SvgjsTspan4277" dy="16.25" x="10"><tspan id="SvgjsTspan4278" style="">该方法生成一个空的 </tspan><tspan id="SvgjsTspan4279" style="font-style: italic;">Node</tspan><tspan id="SvgjsTspan4280" style=""> 对象(</tspan><tspan id="SvgjsTspan4281" style="font-style: italic;">new Node()</tspan><tspan id="SvgjsTspan4282" style="">，右</tspan></tspan><tspan id="SvgjsTspan4283" dy="16.25" x="10"><tspan id="SvgjsTspan4284" style="">图粉色部分)，插入到 AQS 队列头部，然后将参</tspan></tspan><tspan id="SvgjsTspan4285" dy="16.25" x="10"><tspan id="SvgjsTspan4286" style="">数 </tspan><tspan id="SvgjsTspan4287" style="font-style: italic;">node</tspan><tspan id="SvgjsTspan4288" style="">，作为其后继节点，插入队列，方法执行</tspan></tspan><tspan id="SvgjsTspan4289" dy="16.25" x="10"><tspan id="SvgjsTspan4290" style="">完毕，队列如右图</tspan></tspan></text></g></g><g id="SvgjsG4291"><path id="SvgjsPath4292" d="M2962.869779888215 921.0436617110904C 3088.1171334077317 921.0086613490657 3110.291497784261 1072.9778225835366 3110.2862717838325 1198.2243771819678" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4293" transform="translate(2825.8175667138785,1198.9743589743598)"><path id="SvgjsPath4294" d="M 0 4Q 0 0 4 0L 554.8012780869926 0Q 558.8012780869926 0 558.8012780869926 4L 558.8012780869926 347.6464646464642Q 558.8012780869926 351.6464646464642 554.8012780869926 351.6464646464642L 4 351.6464646464642Q 0 351.6464646464642 0 347.6464646464642Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e9e9e9"></path><g id="SvgjsG4295"><text id="SvgjsText4296" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="539px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="165.1982323232321" transform="rotate(0)"></text></g></g><g id="SvgjsG4297" transform="translate(3044.831069084523,1208.66615997197)"><path id="SvgjsPath4298" d="M 0 4Q 0 0 4 0L 116.72727272727298 0Q 120.72727272727298 0 120.72727272727298 4L 120.72727272727298 151.42381949301011Q 120.72727272727298 155.42381949301011 116.72727272727298 155.42381949301011L 4 155.42381949301011Q 0 155.42381949301011 0 151.42381949301011Z" stroke="none" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4299"><text id="SvgjsText4300" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="101px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="10.086909746505057" transform="rotate(0)"><tspan id="SvgjsTspan4301" dy="16.25" x="60.5"><tspan id="SvgjsTspan4302" style="">AQS队列(链表)</tspan></tspan><tspan id="SvgjsTspan4303" dy="16.25" x="60.5"><tspan id="SvgjsTspan4304" style=""> </tspan></tspan><tspan id="SvgjsTspan4305" dy="16.25" x="60.5"><tspan id="SvgjsTspan4306" style=""> </tspan></tspan><tspan id="SvgjsTspan4307" dy="16.25" x="60.5"><tspan id="SvgjsTspan4308" style=""> </tspan></tspan><tspan id="SvgjsTspan4309" dy="16.25" x="60.5"><tspan id="SvgjsTspan4310" style=""> </tspan></tspan><tspan id="SvgjsTspan4311" dy="16.25" x="60.5"><tspan id="SvgjsTspan4312" style=""> </tspan></tspan><tspan id="SvgjsTspan4313" dy="16.25" x="60.5"><tspan id="SvgjsTspan4314" style=""> </tspan></tspan><tspan id="SvgjsTspan4315" dy="16.25" x="60.5"><tspan id="SvgjsTspan4316" style=""> </tspan></tspan></text></g></g><g id="SvgjsG4317" transform="translate(3065.831069084523,1250.726343101344)"><path id="SvgjsPath4318" d="M 0 4Q 0 0 4 0L 75.81818181818198 0Q 79.81818181818198 0 79.81818181818198 4L 79.81818181818198 26.409090909090764Q 79.81818181818198 30.409090909090764 75.81818181818198 30.409090909090764L 4 30.409090909090764Q 0 30.409090909090764 0 26.409090909090764Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4319"><text id="SvgjsText4320" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="60px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="4.579545454545382" transform="rotate(0)"><tspan id="SvgjsTspan4321" dy="16.25" x="40"><tspan id="SvgjsTspan4322" style="">head</tspan></tspan></text></g></g><g id="SvgjsG4323" transform="translate(3065.831069084523,1308.6808885558894)"><path id="SvgjsPath4324" d="M 0 4Q 0 0 4 0L 75.81818181818198 0Q 79.81818181818198 0 79.81818181818198 4L 79.81818181818198 26.409090909090764Q 79.81818181818198 30.409090909090764 75.81818181818198 30.409090909090764L 4 30.409090909090764Q 0 30.409090909090764 0 26.409090909090764Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4325"><text id="SvgjsText4326" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="60px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="4.579545454545382" transform="rotate(0)"><tspan id="SvgjsTspan4327" dy="16.25" x="40"><tspan id="SvgjsTspan4328" style="">tail</tspan></tspan></text></g></g><g id="SvgjsG4329" transform="translate(2835.0069606532716,1389.3844497195519)"><path id="SvgjsPath4330" d="M 0 4Q 0 0 4 0L 332.36363636363785 0Q 336.36363636363785 0 336.36363636363785 4L 336.36363636363785 131.31818181818176Q 336.36363636363785 135.31818181818176 332.36363636363785 135.31818181818176L 4 135.31818181818176Q 0 135.31818181818176 0 131.31818181818176Z" stroke="none" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4331"><text id="SvgjsText4332" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="317px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="57.03409090909088" transform="rotate(0)"></text></g></g><g id="SvgjsG4333" transform="translate(2860.8705970169094,1402.7319347319353)"><path id="SvgjsPath4334" d="M 0 4Q 0 0 4 0L 92 0Q 96 0 96 4L 96 80.66708959789821Q 96 84.66708959789821 92 84.66708959789821L 4 84.66708959789821Q 0 84.66708959789821 0 80.66708959789821Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#fad8ea"></path><g id="SvgjsG4335"><text id="SvgjsText4336" font-family="微软雅黑" text-anchor="start" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.7914552010508942" transform="rotate(0)"><tspan id="SvgjsTspan4337" dy="16.25" x="10"><tspan id="SvgjsTspan4338" style="">Node : n1</tspan></tspan><tspan id="SvgjsTspan4339" dy="16.25" x="10"><tspan id="SvgjsTspan4340" style=""> </tspan></tspan><tspan id="SvgjsTspan4341" dy="16.25" x="10"><tspan id="SvgjsTspan4342" style="">thread = null</tspan></tspan><tspan id="SvgjsTspan4343" dy="16.25" x="10"><tspan id="SvgjsTspan4344" style="">prev = null</tspan></tspan><tspan id="SvgjsTspan4345" dy="16.25" x="10"><tspan id="SvgjsTspan4346" style="">next = null</tspan></tspan></text></g></g><g id="SvgjsG4347" transform="translate(3049.0978697441824,1402.7319347319353)"><path id="SvgjsPath4348" d="M 0 4Q 0 0 4 0L 92 0Q 96 0 96 4L 96 80.66708959789821Q 96 84.66708959789821 92 84.66708959789821L 4 84.66708959789821Q 0 84.66708959789821 0 80.66708959789821Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4349"><text id="SvgjsText4350" font-family="微软雅黑" text-anchor="start" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.7914552010508942" transform="rotate(0)"><tspan id="SvgjsTspan4351" dy="16.25" x="10"><tspan id="SvgjsTspan4352" style="">Node : n2</tspan></tspan><tspan id="SvgjsTspan4353" dy="16.25" x="10"><tspan id="SvgjsTspan4354" style=""> </tspan></tspan><tspan id="SvgjsTspan4355" dy="16.25" x="10"><tspan id="SvgjsTspan4356" style="">thread = t2</tspan></tspan><tspan id="SvgjsTspan4357" dy="16.25" x="10"><tspan id="SvgjsTspan4358" style="">prev = n1</tspan></tspan><tspan id="SvgjsTspan4359" dy="16.25" x="10"><tspan id="SvgjsTspan4360" style="">next = null</tspan></tspan></text></g></g><g id="SvgjsG4361" transform="translate(3254.653425299738,1402.7319347319353)"><path id="SvgjsPath4362" d="M 0 4Q 0 0 4 0L 92 0Q 96 0 96 4L 96 80.66708959789821Q 96 84.66708959789821 92 84.66708959789821L 4 84.66708959789821Q 0 84.66708959789821 0 80.66708959789821Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4363"><text id="SvgjsText4364" font-family="微软雅黑" text-anchor="start" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.7914552010508942" transform="rotate(0)"><tspan id="SvgjsTspan4365" dy="16.25" x="10"><tspan id="SvgjsTspan4366" style="">Node : n2</tspan></tspan><tspan id="SvgjsTspan4367" dy="16.25" x="10"><tspan id="SvgjsTspan4368" style=""> </tspan></tspan><tspan id="SvgjsTspan4369" dy="16.25" x="10"><tspan id="SvgjsTspan4370" style="">thread = t2</tspan></tspan><tspan id="SvgjsTspan4371" dy="16.25" x="10"><tspan id="SvgjsTspan4372" style="">prev = n1</tspan></tspan><tspan id="SvgjsTspan4373" dy="16.25" x="10"><tspan id="SvgjsTspan4374" style="">next = null</tspan></tspan></text></g></g><g id="SvgjsG4375"><path id="SvgjsPath4376" d="M3065.081069084523 1265.930888555889L2830.8705970169094 1265.930888555889L2830.8705970169094 1445.0654795308847L2858.1705970169096 1445.0654795308847" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4377)"></path></g><g id="SvgjsG4379"><path id="SvgjsPath4380" d="M3146.399250902705 1323.8854340104344L3302.653425299738 1323.8854340104344L3302.653425299738 1400.0319347319353" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4381)"></path></g><g id="SvgjsG4383"><path id="SvgjsPath4384" d="M3253.903425299738 1445.0654795308847L3199.8756475219607 1445.0654795308847L3199.8756475219607 1445.0654795308847L3147.797869744182 1445.0654795308847" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4385)"></path><rect id="SvgjsRect4387" width="26" height="16" x="3187.041110852014" y="1437.0654795308847" fill="#ffffff"></rect><text id="SvgjsText4388" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="26px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1434.4404795308847" transform="rotate(0)"><tspan id="SvgjsTspan4389" dy="16.25" x="3200.041110852014"><tspan id="SvgjsTspan4390" style="">prev</tspan></tspan></text></g><g id="SvgjsG4391"><path id="SvgjsPath4392" d="M3048.3478697441824 1445.0654795308847L3002.9842333805464 1445.0654795308847L3002.9842333805464 1445.0654795308847L2959.57059701691 1445.0654795308847" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4393)"></path><rect id="SvgjsRect4395" width="26" height="16" x="2991.440529585572" y="1437.0654795308847" fill="#ffffff"></rect><text id="SvgjsText4396" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="26px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1434.4404795308847" transform="rotate(0)"><tspan id="SvgjsTspan4397" dy="16.25" x="3004.440529585572"><tspan id="SvgjsTspan4398" style="">prev</tspan></tspan></text></g><g id="SvgjsG4399"><path id="SvgjsPath4400" d="M2909.342387615112 1487.9820454541918C 2953.4842333805445 1550.6208236208236 3054.595344491656 1553.9541569541575 3095.4891028159554 1489.5674036717942" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4401)"></path><rect id="SvgjsRect4403" width="26" height="16" x="2989.138817937467" y="1528.3745349873707" fill="#ffffff"></rect><text id="SvgjsText4404" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="26px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1525.7495349873707" transform="rotate(0)"><tspan id="SvgjsTspan4405" dy="16.25" x="3002.138817937467"><tspan id="SvgjsTspan4406" style="">next</tspan></tspan></text></g><g id="SvgjsG4407"><path id="SvgjsPath4408" d="M3097.5484312586013 1487.998602783186C 3139.039788936101 1552.8430458430462 3261.262011158323 1556.1763791763792 3301.088613547533 1489.5993343489358" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4409)"></path><rect id="SvgjsRect4411" width="26" height="16" x="3185.151445181573" y="1530.0443020083326" fill="#ffffff"></rect><text id="SvgjsText4412" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="26px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1527.4193020083326" transform="rotate(0)"><tspan id="SvgjsTspan4413" dy="16.25" x="3198.151445181573"><tspan id="SvgjsTspan4414" style="">next</tspan></tspan></text></g><g id="SvgjsG4415"><path id="SvgjsPath4416" d="M3385.357715435809 1374.9263165275452C 3422.668290423516 1374.7975912975921 3426.59279641591 1426.2248004940006 3464.6422420385543 1426.2248004940006" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4417" transform="translate(3464.6422420385543,1389.3844497195519)"><path id="SvgjsPath4418" d="M 0 0L 152.8888888888887 0L 168.8888888888887 16L 168.8888888888887 68.97033373522572L 0 68.97033373522572L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath4419" d="M 152.8888888888887 0L 152.8888888888887 16L 168.8888888888887 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath4420" d="M 0 0L 152.8888888888887 0L 168.8888888888887 16L 168.8888888888887 68.97033373522572L 0 68.97033373522572L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG4421"><text id="SvgjsText4422" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="149px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-0.6398331323871389" transform="rotate(0)"><tspan id="SvgjsTspan4423" dy="16.25" x="84.5"><tspan id="SvgjsTspan4424" style="">这个队列表示，在节点 </tspan></tspan><tspan id="SvgjsTspan4425" dy="16.25" x="84.5"><tspan id="SvgjsTspan4426" style="font-style: italic;">n3</tspan><tspan id="SvgjsTspan4427" style=""> 插入之前，已经有一</tspan></tspan><tspan id="SvgjsTspan4428" dy="16.25" x="84.5"><tspan id="SvgjsTspan4429" style="">个节点 </tspan><tspan id="SvgjsTspan4430" style="font-style: italic;">n2</tspan><tspan id="SvgjsTspan4431" style="">，在排队获取</tspan></tspan><tspan id="SvgjsTspan4432" dy="16.25" x="84.5"><tspan id="SvgjsTspan4433" style="">锁了</tspan></tspan></text></g></g><g id="SvgjsG4434"><path id="SvgjsPath4435" d="M1973.304292929293 960.0833333333335L1973.304292929293 1063.99696969697" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4436)"></path></g><g id="SvgjsG4438" transform="translate(1806.219065656566,1066.69696969697)"><path id="SvgjsPath4439" d="M 0 4Q 0 0 4 0L 330.1704545454545 0Q 334.1704545454545 0 334.1704545454545 4L 334.1704545454545 43.27272727272725Q 334.1704545454545 47.27272727272725 330.1704545454545 47.27272727272725L 4 47.27272727272725Q 0 47.27272727272725 0 43.27272727272725Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4440"><text id="SvgjsText4441" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="315px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="13.011363636363626" transform="rotate(0)"><tspan id="SvgjsTspan4442" dy="16.25" x="167.5"><tspan id="SvgjsTspan4443" style="">acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</tspan></tspan></text></g></g><g id="SvgjsG4444"><path id="SvgjsPath4445" d="M4124.428635125662 1175.040830904796C 4124.208568569168 1207.1591042427817 4186.698228069331 1194.719279722874 4186.698228069331 1227.5545403067104" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4446" transform="translate(4084.983342114948,1227.5545403067104)"><path id="SvgjsPath4447" d="M 0 0L 187.42977190876445 0L 203.42977190876445 16L 203.42977190876445 67.70680618993106L 0 67.70680618993106L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath4448" d="M 187.42977190876445 0L 187.42977190876445 16L 203.42977190876445 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath4449" d="M 0 0L 187.42977190876445 0L 203.42977190876445 16L 203.42977190876445 67.70680618993106L 0 67.70680618993106L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG4450"><text id="SvgjsText4451" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="184px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="14.728403094965529" transform="rotate(0)"><tspan id="SvgjsTspan4452" dy="16.25" x="102"><tspan id="SvgjsTspan4453" style="">这个队列表示，在节点 </tspan><tspan id="SvgjsTspan4454" style="font-style: italic;">n2</tspan><tspan id="SvgjsTspan4455" style=""> 插入</tspan></tspan><tspan id="SvgjsTspan4456" dy="16.25" x="102"><tspan id="SvgjsTspan4457" style="">之前，只有一个占位头节点</tspan></tspan></text></g></g><g id="SvgjsG4458" transform="translate(1300.959595959596,1689.4192263500365)"><path id="SvgjsPath4459" d="M 0 0L 1600.5916645186435 0L 1600.5916645186435 1353.4947521445872L 0 1353.4947521445872Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#fbe9d0"></path><g id="SvgjsG4460"><text id="SvgjsText4461" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="1581px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="666.1223760722936" transform="rotate(0)"></text></g></g><g id="SvgjsG4462" transform="translate(1397.9166666666677,1689.4192263500363)"><path id="SvgjsPath4463" d="M 0 0L 244.79166666666606 0L 244.79166666666606 72.73442555361635L 0 72.73442555361635Z" stroke="none" fill="none"></path><g id="SvgjsG4464"><text id="SvgjsText4465" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="245px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="9.242212776808174" transform="rotate(0)"><tspan id="SvgjsTspan4466" dy="16.25" x="122.5"><tspan id="SvgjsTspan4467" style="">这部分，是 node 加入队列后的处理逻</tspan></tspan><tspan id="SvgjsTspan4468" dy="16.25" x="122.5"><tspan id="SvgjsTspan4469" style="">辑，这里会有一次自旋，尝试获取锁，获</tspan></tspan><tspan id="SvgjsTspan4470" dy="16.25" x="122.5"><tspan id="SvgjsTspan4471" style="">取不到，才调用 park，阻塞自己</tspan></tspan></text></g></g><g id="SvgjsG4472" transform="translate(1402.1325757575762,1752.6410256410268)"><path id="SvgjsPath4473" d="M 0 0L 100 0L 100 59.58333333333326L 0 59.58333333333326Z" stroke="none" fill="none"></path><g id="SvgjsG4474"><text id="SvgjsText4475" font-family="微软雅黑" text-anchor="middle" font-size="60px" width="100px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="60px" weight="400" font-style="" opacity="1" y="-20.20833333333337" transform="rotate(0)"><tspan id="SvgjsTspan4476" dy="75" x="50"><tspan id="SvgjsTspan4477" style="font-weight: bold;">③</tspan></tspan></text></g></g><g id="SvgjsG4478"><path id="SvgjsPath4479" d="M1973.304292929293 1114.7196969696972C 1973.304292929293 1136.2147796647803 1973.3042929292935 1147.337321012322 1973.3042929292935 1166.882403707405" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4480)"></path></g><g id="SvgjsG4482" transform="translate(1849.6717171717175,1169.582403707405)"><path id="SvgjsPath4483" d="M 0 4Q 0 0 4 0L 243.2651515151515 0Q 247.2651515151515 0 247.2651515151515 4L 247.2651515151515 31.416666666666742Q 247.2651515151515 35.41666666666674 243.2651515151515 35.41666666666674L 4 35.41666666666674Q 0 35.41666666666674 0 31.416666666666742Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e7fbd0"></path><g id="SvgjsG4484"><text id="SvgjsText4485" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="228px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.4166666666666288" transform="rotate(0)"><tspan id="SvgjsTspan4486" dy="16.25" x="124"><tspan id="SvgjsTspan4487" style="font-style: italic;">acquireQueued</tspan><tspan id="SvgjsTspan4488" style=""> 返回，表示线程获取到</tspan></tspan><tspan id="SvgjsTspan4489" dy="16.25" x="124"><tspan id="SvgjsTspan4490" style="">锁，线程逐级返回，加锁过程结束。</tspan></tspan></text></g></g><g id="SvgjsG4491" transform="translate(1331.027777777778,1816.7632922632952)"><path id="SvgjsPath4492" d="M 0 244.25631313131302L 244.25631313131302 0L 1221.2815656565651 0L 1465.537878787878 244.25631313131302L 1465.537878787878 1121.7518592518563L 0 1121.7518592518563L 0 244.25631313131302Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e7ebed"></path><g id="SvgjsG4493"><text id="SvgjsText4494" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="1446px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="550.2509296259282" transform="rotate(0)"></text></g></g><g id="SvgjsG4495"><path id="SvgjsPath4496" d="M1805.4723735752475 1090.4036962191183C 1715.2181890118343 1090.3333333333335 1733.7092099780655 1248.5151515151517 1643.4550254146523 1248.444788629367" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path><rect id="SvgjsRect4497" width="152" height="16" x="1646.3090646637456" y="1166.1650540482265" fill="#ffffff"></rect><text id="SvgjsText4498" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="152px" fill="#a7932c" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1163.5400540482265" transform="rotate(0)"><tspan id="SvgjsTspan4499" dy="16.25" x="1722.3090646637456"><tspan id="SvgjsTspan4500" style="">执行 acquireQueued 逻辑</tspan></tspan></text></g><g id="SvgjsG4501" transform="translate(1284.7537878787878,1066.69696969697)"><path id="SvgjsPath4502" d="M 0 0L 357.95454545454595 0L 357.95454545454595 363.6363636363635L 0 363.6363636363635Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4503"><text id="SvgjsText4504" font-family="微软雅黑" text-anchor="start" font-size="13px" width="338px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="8.693181818181756" transform="rotate(0)"><tspan id="SvgjsTspan4505" dy="16.25" x="10"><tspan id="SvgjsTspan4506" style="">final boolean acquireQueued(final Node node, int arg) {</tspan></tspan><tspan id="SvgjsTspan4507" dy="16.25" x="10"><tspan id="SvgjsTspan4508" style="">    boolean failed = true;</tspan></tspan><tspan id="SvgjsTspan4509" dy="16.25" x="10"><tspan id="SvgjsTspan4510" style="">    try {</tspan></tspan><tspan id="SvgjsTspan4511" dy="16.25" x="10"><tspan id="SvgjsTspan4512" style="">        boolean interrupted = false;</tspan></tspan><tspan id="SvgjsTspan4513" dy="16.25" x="10"><tspan id="SvgjsTspan4514" style="">        for (;;) {</tspan></tspan><tspan id="SvgjsTspan4515" dy="16.25" x="10"><tspan id="SvgjsTspan4516" style="">            final Node p = node.predecessor();</tspan></tspan><tspan id="SvgjsTspan4517" dy="16.25" x="10"><tspan id="SvgjsTspan4518" style="">            if (p == head &amp;&amp; tryAcquire(arg)) {</tspan></tspan><tspan id="SvgjsTspan4519" dy="16.25" x="10"><tspan id="SvgjsTspan4520" style="">                setHead(node);</tspan></tspan><tspan id="SvgjsTspan4521" dy="16.25" x="10"><tspan id="SvgjsTspan4522" style="">                p.next = null; // help GC</tspan></tspan><tspan id="SvgjsTspan4523" dy="16.25" x="10"><tspan id="SvgjsTspan4524" style="">                failed = false;</tspan></tspan><tspan id="SvgjsTspan4525" dy="16.25" x="10"><tspan id="SvgjsTspan4526" style="">                return interrupted;</tspan></tspan><tspan id="SvgjsTspan4527" dy="16.25" x="10"><tspan id="SvgjsTspan4528" style="">            }</tspan></tspan><tspan id="SvgjsTspan4529" dy="16.25" x="10"><tspan id="SvgjsTspan4530" style="">            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</tspan></tspan><tspan id="SvgjsTspan4531" dy="16.25" x="10"><tspan id="SvgjsTspan4532" style="">                    parkAndCheckInterrupt())</tspan></tspan><tspan id="SvgjsTspan4533" dy="16.25" x="10"><tspan id="SvgjsTspan4534" style="">                interrupted = true;</tspan></tspan><tspan id="SvgjsTspan4535" dy="16.25" x="10"><tspan id="SvgjsTspan4536" style="">        }</tspan></tspan><tspan id="SvgjsTspan4537" dy="16.25" x="10"><tspan id="SvgjsTspan4538" style="">    } finally {</tspan></tspan><tspan id="SvgjsTspan4539" dy="16.25" x="10"><tspan id="SvgjsTspan4540" style="">        if (failed)</tspan></tspan><tspan id="SvgjsTspan4541" dy="16.25" x="10"><tspan id="SvgjsTspan4542" style="">            cancelAcquire(node);</tspan></tspan><tspan id="SvgjsTspan4543" dy="16.25" x="10"><tspan id="SvgjsTspan4544" style="">    }</tspan></tspan><tspan id="SvgjsTspan4545" dy="16.25" x="10"><tspan id="SvgjsTspan4546" style="">}</tspan></tspan></text></g></g><g id="SvgjsG4547"><path id="SvgjsPath4548" d="M1463.5153031219918 1065.9786740001514C 1463.7310606060607 1039.2061538666344 1419.2447979797982 1041.800970331055 1419.2447979797982 1014.3101545007194" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4549" transform="translate(1256.1414141414145,687.378787878788)"><path id="SvgjsPath4550" d="M 0 0L 300.33333333333303 0L 316.33333333333303 16L 316.33333333333303 332.9545454545455L 0 332.9545454545455L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath4551" d="M 300.33333333333303 0L 300.33333333333303 16L 316.33333333333303 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath4552" d="M 0 0L 300.33333333333303 0L 316.33333333333303 16L 316.33333333333303 332.9545454545455L 0 332.9545454545455L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG4553"><text id="SvgjsText4554" font-family="微软雅黑" text-anchor="start" font-size="13px" width="297px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1.352272727272748" transform="rotate(0)"><tspan id="SvgjsTspan4555" dy="16.25" x="10"><tspan id="SvgjsTspan4556" style="">整个 AQS 的核心和难点之一。</tspan></tspan><tspan id="SvgjsTspan4557" dy="16.25" x="10"><tspan id="SvgjsTspan4558" style="">注意这里使用 </tspan><tspan id="SvgjsTspan4559" style="font-style: italic;">for(;;)</tspan></tspan><tspan id="SvgjsTspan4560" dy="16.25" x="10"><tspan id="SvgjsTspan4561" style=""> </tspan></tspan><tspan id="SvgjsTspan4562" dy="16.25" x="10"><tspan id="SvgjsTspan4563" style="">首先判断 </tspan><tspan id="SvgjsTspan4564" style="font-style: italic;">node</tspan><tspan id="SvgjsTspan4565" style=""> 的前驱节点，是不是 </tspan><tspan id="SvgjsTspan4566" style="font-style: italic;">head</tspan><tspan id="SvgjsTspan4567" style="">，如果</tspan></tspan><tspan id="SvgjsTspan4568" dy="16.25" x="10"><tspan id="SvgjsTspan4569" style="">是，说明它是下一个可以获得锁的线程，则调用一</tspan></tspan><tspan id="SvgjsTspan4570" dy="16.25" x="10"><tspan id="SvgjsTspan4571" style="">次 </tspan><tspan id="SvgjsTspan4572" style="font-style: italic;">tryAcquire</tspan><tspan id="SvgjsTspan4573" style="">，尝试获取锁，若获取到，则将链表</tspan></tspan><tspan id="SvgjsTspan4574" dy="16.25" x="10"><tspan id="SvgjsTspan4575" style="">关系重新维护下(</tspan><tspan id="SvgjsTspan4576" style="font-style: italic;">node</tspan><tspan id="SvgjsTspan4577" style=""> 设置为 </tspan><tspan id="SvgjsTspan4578" style="font-style: italic;">head</tspan><tspan id="SvgjsTspan4579" style="">，之前的 </tspan><tspan id="SvgjsTspan4580" style="font-style: italic;">head</tspan><tspan id="SvgjsTspan4581" style=""> </tspan></tspan><tspan id="SvgjsTspan4582" dy="16.25" x="10"><tspan id="SvgjsTspan4583" style="">从链表移出)，然后返回</tspan></tspan><tspan id="SvgjsTspan4584" dy="16.25" x="10"><tspan id="SvgjsTspan4585" style=""> </tspan></tspan><tspan id="SvgjsTspan4586" dy="16.25" x="10"><tspan id="SvgjsTspan4587" style="">如果 </tspan><tspan id="SvgjsTspan4588" style="font-style: italic;">node</tspan><tspan id="SvgjsTspan4589" style=""> 的前驱节点不是 </tspan><tspan id="SvgjsTspan4590" style="font-style: italic;">head</tspan><tspan id="SvgjsTspan4591" style="">，或获取锁失败，</tspan></tspan><tspan id="SvgjsTspan4592" dy="16.25" x="10"><tspan id="SvgjsTspan4593" style="">再判断其前驱节点的 </tspan><tspan id="SvgjsTspan4594" style="font-style: italic;">waitState</tspan><tspan id="SvgjsTspan4595" style="">，是不是 </tspan><tspan id="SvgjsTspan4596" style="font-style: italic;">SIGNAL</tspan><tspan id="SvgjsTspan4597" style="">，</tspan></tspan><tspan id="SvgjsTspan4598" dy="16.25" x="10"><tspan id="SvgjsTspan4599" style="">如果是，则当前线程调用 </tspan><tspan id="SvgjsTspan4600" style="font-style: italic;">park</tspan><tspan id="SvgjsTspan4601" style="">，进入阻塞状态。</tspan></tspan><tspan id="SvgjsTspan4602" dy="16.25" x="10"><tspan id="SvgjsTspan4603" style="">如不是：</tspan></tspan><tspan id="SvgjsTspan4604" dy="16.25" x="10"><tspan id="SvgjsTspan4605" style="">1. </tspan><tspan id="SvgjsTspan4606" style="font-style: italic;">== 0</tspan><tspan id="SvgjsTspan4607" style="">，则设置为 </tspan><tspan id="SvgjsTspan4608" style="font-style: italic;">SIGNAL</tspan><tspan id="SvgjsTspan4609" style="">；</tspan></tspan><tspan id="SvgjsTspan4610" dy="16.25" x="10"><tspan id="SvgjsTspan4611" style="">2. </tspan><tspan id="SvgjsTspan4612" style="font-style: italic;">&gt; 0</tspan><tspan id="SvgjsTspan4613" style=""> (</tspan><tspan id="SvgjsTspan4614" style="font-style: italic;">== 1</tspan><tspan id="SvgjsTspan4615" style="">)；则表示前驱节点已经被取消了，将取</tspan></tspan><tspan id="SvgjsTspan4616" dy="16.25" x="10"><tspan id="SvgjsTspan4617" style="">消的节点，从队列移出，重新维护下队列链表关</tspan></tspan><tspan id="SvgjsTspan4618" dy="16.25" x="10"><tspan id="SvgjsTspan4619" style="">系。</tspan></tspan><tspan id="SvgjsTspan4620" dy="16.25" x="10"><tspan id="SvgjsTspan4621" style=""> </tspan></tspan><tspan id="SvgjsTspan4622" dy="16.25" x="10"><tspan id="SvgjsTspan4623" style="">然后再次进入 </tspan><tspan id="SvgjsTspan4624" style="font-style: italic;">for</tspan><tspan id="SvgjsTspan4625" style=""> 循环，上面的逻辑重新执行一</tspan></tspan><tspan id="SvgjsTspan4626" dy="16.25" x="10"><tspan id="SvgjsTspan4627" style="">遍。</tspan></tspan></text></g></g><g id="SvgjsG4628" transform="translate(1638.141414141414,1983.6353425932766)"><path id="SvgjsPath4629" d="M 0 44.34899537002843L 78.4848484848485 0L 156.969696969697 44.34899537002843L 78.4848484848485 88.69799074005687Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4630"><text id="SvgjsText4631" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="137px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="17.66748532372872" transform="rotate(0)"><tspan id="SvgjsTspan4632" dy="16.25" x="78.5"><tspan id="SvgjsTspan4633" style="font-style: italic;">p == head</tspan><tspan id="SvgjsTspan4634" style=""> ? </tspan></tspan><tspan id="SvgjsTspan4635" dy="16.25" x="78.5"><tspan id="SvgjsTspan4636" style="">表示查询 </tspan><tspan id="SvgjsTspan4637" style="font-style: italic;">node</tspan><tspan id="SvgjsTspan4638" style=""> 是不是</tspan></tspan><tspan id="SvgjsTspan4639" dy="16.25" x="78.5"><tspan id="SvgjsTspan4640" style="">第一个排队的</tspan></tspan></text></g></g><g id="SvgjsG4641"><path id="SvgjsPath4642" d="M1716.6262626262626 2073.0833333333335L1716.6262626262626 2119.6333333333337" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4643)"></path><rect id="SvgjsRect4645" width="24" height="16" x="1704.6262626262628" y="2085.226787878788" fill="#ffffff"></rect><text id="SvgjsText4646" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="24px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2082.601787878788" transform="rotate(0)"><tspan id="SvgjsTspan4647" dy="16.25" x="1716.6262626262628"><tspan id="SvgjsTspan4648" style="">true</tspan></tspan></text></g><g id="SvgjsG4649" transform="translate(1668.6262626262626,2122.3333333333335)"><path id="SvgjsPath4650" d="M 0 24.658251006783303L 48 0L 96 24.658251006783303L 48 49.316502013566605Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4651"><text id="SvgjsText4652" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="14.279833516851134" transform="rotate(0)"><tspan id="SvgjsTspan4653" dy="16.25" x="48"><tspan id="SvgjsTspan4654" style="">tryAcquire</tspan></tspan></text></g></g><g id="SvgjsG4655"><path id="SvgjsPath4656" d="M1795.861111111111 2027.9843379633053L1855.7294823232326 2027.9843379633053L1855.7294823232326 2230.8814740814773" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4657)"></path><rect id="SvgjsRect4659" width="29" height="16" x="1841.2294823232326" y="2122.765989134709" fill="#ffffff"></rect><text id="SvgjsText4660" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="29px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2120.140989134709" transform="rotate(0)"><tspan id="SvgjsTspan4661" dy="16.25" x="1855.7294823232326"><tspan id="SvgjsTspan4662" style="">false</tspan></tspan></text></g><g id="SvgjsG4663" transform="translate(1725.181186868687,2233.581474081477)"><path id="SvgjsPath4664" d="M 0 31.375929625928165L 130.5482954545455 0L 261.096590909091 31.375929625928165L 130.5482954545455 62.75185925185633Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4665"><text id="SvgjsText4666" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="242px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="21.064688922187447" transform="rotate(0)"><tspan id="SvgjsTspan4667" dy="16.25" x="131"><tspan id="SvgjsTspan4668" style="">shouldParkAfterFailedAcquire(p, node)</tspan></tspan></text></g></g><g id="SvgjsG4669" transform="translate(1634.929292929293,1882.0282609441292)"><path id="SvgjsPath4670" d="M 0 4Q 0 0 4 0L 159.39393939393904 0Q 163.39393939393904 0 163.39393939393904 4L 163.39393939393904 47.6070816491474Q 163.39393939393904 51.6070816491474 159.39393939393904 51.6070816491474L 4 51.6070816491474Q 0 51.6070816491474 0 47.6070816491474Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4671"><text id="SvgjsText4672" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="144px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="6.678540824573702" transform="rotate(0)"><tspan id="SvgjsTspan4673" dy="16.25" x="82"><tspan id="SvgjsTspan4674" style="font-style: italic;">node.predecessor()</tspan></tspan><tspan id="SvgjsTspan4675" dy="16.25" x="82"><tspan id="SvgjsTspan4676" style="">获取当前节点的前驱节点</tspan></tspan></text></g></g><g id="SvgjsG4677"><path id="SvgjsPath4678" d="M1716.6262626262626 1934.3853425932766L1716.6262626262626 1958.6353425932766L1716.6262626262626 1958.6353425932766L1716.6262626262626 1980.9353425932768" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4679)"></path></g><g id="SvgjsG4681"><path id="SvgjsPath4682" d="M1765.3762626262626 2146.991584340117L1855.7294823232326 2146.991584340117L1855.7294823232326 2230.8814740814773" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4683)"></path><rect id="SvgjsRect4685" width="29" height="16" x="1792.8928228537277" y="2138.991584340117" fill="#ffffff"></rect><text id="SvgjsText4686" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="29px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2136.366584340117" transform="rotate(0)"><tspan id="SvgjsTspan4687" dy="16.25" x="1807.3928228537277"><tspan id="SvgjsTspan4688" style="">false</tspan></tspan></text></g><g id="SvgjsG4689"><path id="SvgjsPath4690" d="M1987.027777777778 2264.9574037074053L2016.277777777778 2264.9574037074053L2016.277777777778 1907.831801768703L1801.023232323232 1907.831801768703" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4691)"></path><rect id="SvgjsRect4693" width="111" height="16" x="1960.7777777777778" y="2115.191680633302" fill="#ffffff"></rect><text id="SvgjsText4694" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="111px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2112.566680633302" transform="rotate(0)"><tspan id="SvgjsTspan4695" dy="16.25" x="2016.2777777777778"><tspan id="SvgjsTspan4696" style="">false 再次循环判断</tspan></tspan></text></g><g id="SvgjsG4697"><path id="SvgjsPath4698" d="M1667.8762626262626 2146.991584340117L1510.3125000000007 2146.991584340117L1510.3125000000007 2201.4939843435154" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4699)"></path><rect id="SvgjsRect4701" width="24" height="16" x="1576.918365540681" y="2138.991584340117" fill="#ffffff"></rect><text id="SvgjsText4702" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="24px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2136.366584340117" transform="rotate(0)"><tspan id="SvgjsTspan4703" dy="16.25" x="1588.918365540681"><tspan id="SvgjsTspan4704" style="">true</tspan></tspan></text></g><g id="SvgjsG4705" transform="translate(1418.075441919192,2201.6355245808254)"><path id="SvgjsPath4706" d="M 0 4Q 0 0 4 0L 180.47411616161708 0Q 184.47411616161708 0 184.47411616161708 4L 184.47411616161708 122.64375825315983Q 184.47411616161708 126.64375825315983 180.47411616161708 126.64375825315983L 4 126.64375825315983Q 0 126.64375825315983 0 122.64375825315983Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#e7fbd0"></path><g id="SvgjsG4707"><text id="SvgjsText4708" font-family="微软雅黑" text-anchor="start" font-size="13px" width="165px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="3.6968791265799155" transform="rotate(0)"><tspan id="SvgjsTspan4709" dy="16.25" x="10"><tspan id="SvgjsTspan4710" style="">表示获取到锁：</tspan></tspan><tspan id="SvgjsTspan4711" dy="16.25" x="10"><tspan id="SvgjsTspan4712" style="">1. node 设置为头节点</tspan></tspan><tspan id="SvgjsTspan4713" dy="16.25" x="10"><tspan id="SvgjsTspan4714" style="">2. 释放之前的头节点</tspan></tspan><tspan id="SvgjsTspan4715" dy="16.25" x="10"><tspan id="SvgjsTspan4716" style="">这个逻辑执行完之后，node </tspan></tspan><tspan id="SvgjsTspan4717" dy="16.25" x="10"><tspan id="SvgjsTspan4718" style="">节点就不会再排队了(获取到</tspan></tspan><tspan id="SvgjsTspan4719" dy="16.25" x="10"><tspan id="SvgjsTspan4720" style="">锁的线程，不会在排队队列</tspan></tspan><tspan id="SvgjsTspan4721" dy="16.25" x="10"><tspan id="SvgjsTspan4722" style="">中了)</tspan></tspan></text></g></g><g id="SvgjsG4723"><path id="SvgjsPath4724" d="M1724.431186868687 2264.9574037074053L1673.29292929293 2264.9574037074053L1673.29292929293 2355.5649720679107" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4725)"></path></g><g id="SvgjsG4727" transform="translate(1590.8080808080815,2358.2649720679105)"><path id="SvgjsPath4728" d="M 0 4Q 0 0 4 0L 160.96969696969654 0Q 164.96969696969654 0 164.96969696969654 4L 164.96969696969654 59.720718012784346Q 164.96969696969654 63.720718012784346 160.96969696969654 63.720718012784346L 4 63.720718012784346Q 0 63.720718012784346 0 59.720718012784346Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#f9f630"></path><g id="SvgjsG4729"><text id="SvgjsText4730" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="145px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="4.735359006392173" transform="rotate(0)"><tspan id="SvgjsTspan4731" dy="16.25" x="82.5"><tspan id="SvgjsTspan4732" style="font-style: italic;">parkAndCheckInterrupt(</tspan></tspan><tspan id="SvgjsTspan4733" dy="16.25" x="82.5"><tspan id="SvgjsTspan4734" style="font-style: italic;">)</tspan></tspan><tspan id="SvgjsTspan4735" dy="16.25" x="82.5"><tspan id="SvgjsTspan4736" style="">线程进入阻塞状态</tspan></tspan></text></g></g><g id="SvgjsG4737"><path id="SvgjsPath4738" d="M1590.0580808080815 2390.1253310743027L1550.505050505051 2390.1253310743027L1550.505050505051 2390.1253310743027L1512.90202020202 2390.1253310743027" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4739)"></path></g><g id="SvgjsG4741" transform="translate(1418.075441919192,2363.1253310743027)"><path id="SvgjsPath4742" d="M 0 4Q 0 0 4 0L 92 0Q 96 0 96 4L 96 50Q 96 54 92 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4743"><text id="SvgjsText4744" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan4745" dy="16.25" x="48"><tspan id="SvgjsTspan4746" style="">阻塞结束</tspan></tspan></text></g></g><g id="SvgjsG4747"><path id="SvgjsPath4748" d="M1417.325441919192 2390.1253310743027L1388.075441919192 2390.1253310743027L1388.075441919192 2061.0576082203156L1505.2518735744545 2061.0576082203156L1505.2518735744545 1907.831801768703L1632.2292929292933 1907.831801768703" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4749)"></path><rect id="SvgjsRect4751" width="78" height="16" x="1349.075441919192" y="2140.0945440777737" fill="#ffffff"></rect><text id="SvgjsText4752" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="78px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2137.4695440777737" transform="rotate(0)"><tspan id="SvgjsTspan4753" dy="16.25" x="1388.075441919192"><tspan id="SvgjsTspan4754" style="">再次循环判断</tspan></tspan></text></g><g id="SvgjsG4755"><path id="SvgjsPath4756" d="M1855.8983184618921 2297.064082509373C 1864.615729387928 2368.706007872785 1964.861597084545 2305.7262516841856 2037.028780953627 2305.76502999528" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4757" transform="translate(2037.777777777778,2176.6353425932766)"><path id="SvgjsPath4758" d="M 0 0L 483.3333333333326 0L 483.3333333333326 258.181818181818L 0 258.181818181818Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4759"><text id="SvgjsText4760" font-family="微软雅黑" text-anchor="start" font-size="13px" width="464px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="4.465909090909008" transform="rotate(0)"><tspan id="SvgjsTspan4761" dy="16.25" x="10"><tspan id="SvgjsTspan4762" style="">private static boolean shouldParkAfterFailedAcquire(Node pred, </tspan></tspan><tspan id="SvgjsTspan4763" dy="16.25" x="10"><tspan id="SvgjsTspan4764" style="">Node node) {</tspan></tspan><tspan id="SvgjsTspan4765" dy="16.25" x="10"><tspan id="SvgjsTspan4766" style="">    int ws = pred.waitStatus;</tspan></tspan><tspan id="SvgjsTspan4767" dy="16.25" x="10"><tspan id="SvgjsTspan4768" style="">    if (ws == Node.SIGNAL)</tspan></tspan><tspan id="SvgjsTspan4769" dy="16.25" x="10"><tspan id="SvgjsTspan4770" style="">        return true;</tspan></tspan><tspan id="SvgjsTspan4771" dy="16.25" x="10"><tspan id="SvgjsTspan4772" style="">    if (ws &gt; 0) {</tspan></tspan><tspan id="SvgjsTspan4773" dy="16.25" x="10"><tspan id="SvgjsTspan4774" style="">        do {</tspan></tspan><tspan id="SvgjsTspan4775" dy="16.25" x="10"><tspan id="SvgjsTspan4776" style="">            node.prev = pred = pred.prev;</tspan></tspan><tspan id="SvgjsTspan4777" dy="16.25" x="10"><tspan id="SvgjsTspan4778" style="">        } while (pred.waitStatus &gt; 0);</tspan></tspan><tspan id="SvgjsTspan4779" dy="16.25" x="10"><tspan id="SvgjsTspan4780" style="">        pred.next = node;</tspan></tspan><tspan id="SvgjsTspan4781" dy="16.25" x="10"><tspan id="SvgjsTspan4782" style="">    } else {</tspan></tspan><tspan id="SvgjsTspan4783" dy="16.25" x="10"><tspan id="SvgjsTspan4784" style="">        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</tspan></tspan><tspan id="SvgjsTspan4785" dy="16.25" x="10"><tspan id="SvgjsTspan4786" style="">    }</tspan></tspan><tspan id="SvgjsTspan4787" dy="16.25" x="10"><tspan id="SvgjsTspan4788" style="">    return false;</tspan></tspan><tspan id="SvgjsTspan4789" dy="16.25" x="10"><tspan id="SvgjsTspan4790" style="">}</tspan></tspan></text></g></g><g id="SvgjsG4791"><path id="SvgjsPath4792" d="M2279.570481651993 2175.896008688797C 2279.4444444444443 2141.5808043351217 2322.5505050505053 2135.3878715914884 2322.5505050505053 2100.3333333333335" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4793" transform="translate(2229.4444444444443,2007.6060606060605)"><path id="SvgjsPath4794" d="M 0 0L 170.21212121212147 0L 186.21212121212147 16L 186.21212121212147 92.72727272727298L 0 92.72727272727298L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath4795" d="M 170.21212121212147 0L 170.21212121212147 16L 186.21212121212147 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath4796" d="M 0 0L 170.21212121212147 0L 186.21212121212147 16L 186.21212121212147 92.72727272727298L 0 92.72727272727298L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG4797"><text id="SvgjsText4798" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="167px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="11.238636363636488" transform="rotate(0)"><tspan id="SvgjsTspan4799" dy="16.25" x="93.5"><tspan id="SvgjsTspan4800" style="">这个方法，接收两个 </tspan><tspan id="SvgjsTspan4801" style="font-style: italic;">Node</tspan><tspan id="SvgjsTspan4802" style=""> </tspan></tspan><tspan id="SvgjsTspan4803" dy="16.25" x="93.5"><tspan id="SvgjsTspan4804" style="">对象参数：参数 2 是准备执</tspan></tspan><tspan id="SvgjsTspan4805" dy="16.25" x="93.5"><tspan id="SvgjsTspan4806" style="">行 </tspan><tspan id="SvgjsTspan4807" style="font-style: italic;">park</tspan><tspan id="SvgjsTspan4808" style=""> 操作的节点 </tspan><tspan id="SvgjsTspan4809" style="font-style: italic;">node</tspan><tspan id="SvgjsTspan4810" style="">，</tspan></tspan><tspan id="SvgjsTspan4811" dy="16.25" x="93.5"><tspan id="SvgjsTspan4812" style="">参数 1 是其前驱节点 </tspan><tspan id="SvgjsTspan4813" style="font-style: italic;">prev</tspan></tspan></text></g></g><g id="SvgjsG4814"><path id="SvgjsPath4815" d="M1673.1177809774701 2422.7149520827156C 1673.29292929293 2472.1069210331143 1561.529671717172 2428.519868907181 1561.7048200326324 2477.9118378575795" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4816" transform="translate(1397.8781565656566,2478.6410998596)"><path id="SvgjsPath4817" d="M 0 0L 327.3030303030305 0L 327.3030303030305 83.7552076459574L 0 83.7552076459574Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4818"><text id="SvgjsText4819" font-family="微软雅黑" text-anchor="start" font-size="13px" width="308px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="6.752603822978699" transform="rotate(0)"><tspan id="SvgjsTspan4820" dy="16.25" x="10"><tspan id="SvgjsTspan4821" style="">private final boolean parkAndCheckInterrupt() {</tspan></tspan><tspan id="SvgjsTspan4822" dy="16.25" x="10"><tspan id="SvgjsTspan4823" style="">    LockSupport.park(this);</tspan></tspan><tspan id="SvgjsTspan4824" dy="16.25" x="10"><tspan id="SvgjsTspan4825" style="">    return Thread.interrupted();</tspan></tspan><tspan id="SvgjsTspan4826" dy="16.25" x="10"><tspan id="SvgjsTspan4827" style="">}</tspan></tspan></text></g></g><g id="SvgjsG4828"><path id="SvgjsPath4829" d="M1561.1269006823456 2563.028980796842C 1561.529671717172 2583.19813357036 1516.6777529078634 2567.9151990755854 1516.6777529078634 2588.7170251403877" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4830" transform="translate(1354.2518939393947,2589.711481091271)"><path id="SvgjsPath4831" d="M 0 0L 325.40467171717046 0L 341.40467171717046 16L 341.40467171717046 130.7654715755766L 0 130.7654715755766L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath4832" d="M 325.40467171717046 0L 325.40467171717046 16L 341.40467171717046 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath4833" d="M 0 0L 325.40467171717046 0L 341.40467171717046 16L 341.40467171717046 130.7654715755766L 0 130.7654715755766L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG4834"><text id="SvgjsText4835" font-family="微软雅黑" text-anchor="start" font-size="13px" width="322px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="13.757735787788306" transform="rotate(0)"><tspan id="SvgjsTspan4836" dy="16.25" x="10"><tspan id="SvgjsTspan4837" style="">两种情况，会导致阻塞结束：</tspan></tspan><tspan id="SvgjsTspan4838" dy="16.25" x="10"><tspan id="SvgjsTspan4839" style="">1. 持有锁的线程，释放锁后，将这个线程 </tspan><tspan id="SvgjsTspan4840" style="font-style: italic;">unpark</tspan><tspan id="SvgjsTspan4841" style=""> 了。</tspan></tspan><tspan id="SvgjsTspan4842" dy="16.25" x="10"><tspan id="SvgjsTspan4843" style="">此时该线程，一定排在队列的队头(不包括 </tspan><tspan id="SvgjsTspan4844" style="font-style: italic;">head</tspan><tspan id="SvgjsTspan4845" style=""> 节点)；</tspan></tspan><tspan id="SvgjsTspan4846" dy="16.25" x="10"><tspan id="SvgjsTspan4847" style="">2. 线程被 </tspan><tspan id="SvgjsTspan4848" style="font-style: italic;">interrupt</tspan><tspan id="SvgjsTspan4849" style=""> 了。(注意，在外部 </tspan><tspan id="SvgjsTspan4850" style="font-style: italic;">interrupt</tspan><tspan id="SvgjsTspan4851" style=""> 这个</tspan></tspan><tspan id="SvgjsTspan4852" dy="16.25" x="10"><tspan id="SvgjsTspan4853" style="">线程，不是抛出 </tspan><tspan id="SvgjsTspan4854" style="font-style: italic;">InterruptException</tspan><tspan id="SvgjsTspan4855" style="">，这一点和 </tspan><tspan id="SvgjsTspan4856" style="font-style: italic;">sleep</tspan><tspan id="SvgjsTspan4857" style="">、</tspan></tspan><tspan id="SvgjsTspan4858" dy="16.25" x="10"><tspan id="SvgjsTspan4859" style="font-style: italic;">wait</tspan><tspan id="SvgjsTspan4860" style=""> 阻塞不一样)</tspan></tspan></text></g></g><g id="SvgjsG4861"><path id="SvgjsPath4862" d="M2279.3302421954877 2435.558415013756C 2279.4444444444443 2472.6954545010485 2234.616638092786 2477.042789527682 2228.2728438915547 2513.632967648154" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path><rect id="SvgjsRect4863" width="235" height="16" x="2135.8365756465214" y="2469.2762705891064" fill="#ffffff"></rect><text id="SvgjsText4864" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="235px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2466.6512705891064" transform="rotate(0)"><tspan id="SvgjsTspan4865" dy="16.25" x="2253.3365756465214"><tspan id="SvgjsTspan4866" style="">shouldParkAfterFailedAcquire 方法详解</tspan></tspan></text></g><g id="SvgjsG4867" transform="translate(2115.1186868686873,2514.345626859875)"><path id="SvgjsPath4868" d="M 0 24.025340322841203L 112.9204545454545 0L 225.840909090909 24.025340322841203L 112.9204545454545 48.050680645682405Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4869"><text id="SvgjsText4870" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="206px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="13.640593726069614" transform="rotate(0)"><tspan id="SvgjsTspan4871" dy="16.25" x="113"><tspan id="SvgjsTspan4872" style="font-style: italic;">pre.waitState == Node.SIGNAL</tspan></tspan></text></g></g><g id="SvgjsG4873"><path id="SvgjsPath4874" d="M2114.3686868686873 2538.3709671827164L2065.6565656565654 2538.3709671827164L2065.6565656565654 2610.3606060606057" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4875)"></path><rect id="SvgjsRect4877" width="24" height="16" x="2053.6565656565654" y="2564.3559774724126" fill="#ffffff"></rect><text id="SvgjsText4878" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="24px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2561.7309774724126" transform="rotate(0)"><tspan id="SvgjsTspan4879" dy="16.25" x="2065.6565656565654"><tspan id="SvgjsTspan4880" style="">true</tspan></tspan></text></g><g id="SvgjsG4881" transform="translate(2019.118686868687,2613.0606060606056)"><path id="SvgjsPath4882" d="M 0 4Q 0 0 4 0L 92 0Q 96 0 96 4L 96 50Q 96 54 92 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4883"><text id="SvgjsText4884" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan4885" dy="16.25" x="48"><tspan id="SvgjsTspan4886" style="">返回 </tspan><tspan id="SvgjsTspan4887" style="font-style: italic;">true</tspan></tspan></text></g></g><g id="SvgjsG4888"><path id="SvgjsPath4889" d="M2341.7095959595963 2538.3709671827164L2370.0505050505044 2538.3709671827164L2370.0505050505044 2615.0878787878787" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4890)"></path><rect id="SvgjsRect4892" width="29" height="16" x="2355.5505050505044" y="2567.3034528191465" fill="#ffffff"></rect><text id="SvgjsText4893" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="29px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2564.6784528191465" transform="rotate(0)"><tspan id="SvgjsTspan4894" dy="16.25" x="2370.0505050505044"><tspan id="SvgjsTspan4895" style="">false</tspan></tspan></text></g><g id="SvgjsG4896" transform="translate(2304.6868686868684,2617.7878787878785)"><path id="SvgjsPath4897" d="M 0 22.272727272727252L 65.36363636363626 0L 130.72727272727252 22.272727272727252L 65.36363636363626 44.545454545454504Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4898"><text id="SvgjsText4899" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="111px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="11.870454545454525" transform="rotate(0)"><tspan id="SvgjsTspan4900" dy="16.25" x="65.5"><tspan id="SvgjsTspan4901" style="">pre.waitState &gt; 0</tspan></tspan></text></g></g><g id="SvgjsG4902"><path id="SvgjsPath4903" d="M2303.9368686868684 2640.0606060606056L2172.8383838383834 2640.0606060606056L2172.8383838383834 2705.4199732618135" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4904)"></path></g><g id="SvgjsG4906" transform="translate(2048.3838383838383,2708.1199732618134)"><path id="SvgjsPath4907" d="M 0 4Q 0 0 4 0L 244.909090909091 0Q 248.909090909091 0 248.909090909091 4L 248.909090909091 84.03073866292561Q 248.909090909091 88.03073866292561 244.909090909091 88.03073866292561L 4 88.03073866292561Q 0 88.03073866292561 0 84.03073866292561Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4908"><text id="SvgjsText4909" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="229px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="8.890369331462807" transform="rotate(0)"><tspan id="SvgjsTspan4910" dy="16.25" x="124.5"><tspan id="SvgjsTspan4911" style="font-style: italic;">&gt; 0</tspan><tspan id="SvgjsTspan4912" style="">；只能 </tspan><tspan id="SvgjsTspan4913" style="font-style: italic;">== 1</tspan><tspan id="SvgjsTspan4914" style="">；</tspan></tspan><tspan id="SvgjsTspan4915" dy="16.25" x="124.5"><tspan id="SvgjsTspan4916" style="">即 </tspan><tspan id="SvgjsTspan4917" style="font-style: italic;">CANCELED</tspan><tspan id="SvgjsTspan4918" style="">。表示 </tspan><tspan id="SvgjsTspan4919" style="font-style: italic;">node</tspan><tspan id="SvgjsTspan4920" style=""> 的前驱节</tspan></tspan><tspan id="SvgjsTspan4921" dy="16.25" x="124.5"><tspan id="SvgjsTspan4922" style="">点，已经取消了，此时将链表关系重新</tspan></tspan><tspan id="SvgjsTspan4923" dy="16.25" x="124.5"><tspan id="SvgjsTspan4924" style="">维护下：即将其前驱节点从队列移出。</tspan></tspan></text></g></g><g id="SvgjsG4925"><path id="SvgjsPath4926" d="M2436.1641414141404 2640.0606060606056L2502.123507805326 2640.0606060606056L2502.123507805326 2720.6179640018704" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4927)"></path></g><g id="SvgjsG4929" transform="translate(2415.6565656565654,2725.135342593276)"><path id="SvgjsPath4930" d="M 0 4Q 0 0 4 0L 165.090909090909 0Q 169.090909090909 0 169.090909090909 4L 169.090909090909 50Q 169.090909090909 54 165.090909090909 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4931"><text id="SvgjsText4932" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="150px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan4933" dy="16.25" x="85"><tspan id="SvgjsTspan4934" style="">设置 </tspan><tspan id="SvgjsTspan4935" style="font-style: italic;">pred.waitState = -1</tspan></tspan></text></g></g><g id="SvgjsG4936"><path id="SvgjsPath4937" d="M2172.8383838383834 2796.900711924739L2172.8383838383834 2818.786302112809L2367.6565656565654 2818.786302112809L2367.6565656565654 2838.721892300879" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4938)"></path></g><g id="SvgjsG4940" transform="translate(2319.6565656565654,2841.421892300879)"><path id="SvgjsPath4941" d="M 0 4Q 0 0 4 0L 92 0Q 96 0 96 4L 96 50Q 96 54 92 54L 4 54Q 0 54 0 50Z" stroke="rgba(33,41,48,1)" stroke-width="1.5" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG4942"><text id="SvgjsText4943" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="76px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="italic" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan4944" dy="16.25" x="48"><tspan id="SvgjsTspan4945" style="">返回 false</tspan></tspan></text></g></g><g id="SvgjsG4946"><path id="SvgjsPath4947" d="M2500.2020202020203 2779.885342593276L2500.2020202020203 2818.4604356288955L2367.6565656565654 2818.4604356288955L2367.6565656565654 2838.721892300879" stroke="#323232" stroke-width="1.5" fill="none" marker-end="url(#SvgjsMarker4948)"></path></g><g id="SvgjsG4950"><path id="SvgjsPath4951" d="M2585.490520067431 2752.0334423847867C 2637.172960419948 2752.135342593276 2623.8383838383834 2679.462474953592 2623.8383838383834 2627.036989281118" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path></g><g id="SvgjsG4952" transform="translate(2478.3838383838383,2447.830690271731)"><path id="SvgjsPath4953" d="M 0 0L 274.909090909091 0L 290.909090909091 16L 290.909090909091 181.08055382197108L 0 181.08055382197108L 0 0Z" stroke="none" fill-opacity="1" fill="#fff7bc"></path><path id="SvgjsPath4954" d="M 274.909090909091 0L 274.909090909091 16L 290.909090909091 16Z" stroke="none" fill-opacity="1" fill="#e4d089"></path><path id="SvgjsPath4955" d="M 0 0L 274.909090909091 0L 290.909090909091 16L 290.909090909091 181.08055382197108L 0 181.08055382197108L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG4956"><text id="SvgjsText4957" font-family="微软雅黑" text-anchor="start" font-size="13px" width="271px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.5847230890144601" transform="rotate(0)"><tspan id="SvgjsTspan4958" dy="16.25" x="10"><tspan id="SvgjsTspan4959" style="">注意，这里是设置 pred 节点，而不是 node 节</tspan></tspan><tspan id="SvgjsTspan4960" dy="16.25" x="10"><tspan id="SvgjsTspan4961" style="">点的 waitState。-1 表示节点处于阻塞状态</tspan></tspan><tspan id="SvgjsTspan4962" dy="16.25" x="10"><tspan id="SvgjsTspan4963" style="">了。</tspan></tspan><tspan id="SvgjsTspan4964" dy="16.25" x="10"><tspan id="SvgjsTspan4965" style=""> </tspan></tspan><tspan id="SvgjsTspan4966" dy="16.25" x="10"><tspan id="SvgjsTspan4967" style="">为何每个线程进入该方法后，修改的是上一个</tspan></tspan><tspan id="SvgjsTspan4968" dy="16.25" x="10"><tspan id="SvgjsTspan4969" style="">节点的 waitState，而不是修改自己的？</tspan></tspan><tspan id="SvgjsTspan4970" dy="16.25" x="10"><tspan id="SvgjsTspan4971" style=""> </tspan></tspan><tspan id="SvgjsTspan4972" dy="16.25" x="10"><tspan id="SvgjsTspan4973" style="">因为线程调用 park 后，无法设置自己的这个状</tspan></tspan><tspan id="SvgjsTspan4974" dy="16.25" x="10"><tspan id="SvgjsTspan4975" style="">态，若在调用 park 前设置，存在不一致问题。</tspan></tspan><tspan id="SvgjsTspan4976" dy="16.25" x="10"><tspan id="SvgjsTspan4977" style="">所以，每个 node 的 waitState，在后继节点加</tspan></tspan><tspan id="SvgjsTspan4978" dy="16.25" x="10"><tspan id="SvgjsTspan4979" style="">入时设置。</tspan></tspan></text></g></g><g id="SvgjsG4980"><path id="SvgjsPath4981" d="M1463.7523550074964 1431.0830309713633C 1463.7310606060607 1637.4021299528767 1716.6262626262626 1674.959464324586 1716.604968224827 1881.2785633060994" stroke-dasharray="8,5" stroke="#323232" stroke-width="1.5" fill="none"></path><rect id="SvgjsRect4982" width="147" height="16" x="1438.6163818097639" y="1564.1076235930373" fill="#ffffff"></rect><text id="SvgjsText4983" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="147px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="1561.4826235930373" transform="rotate(0)"><tspan id="SvgjsTspan4984" dy="16.25" x="1512.1163818097639"><tspan id="SvgjsTspan4985" style="">acquireQueued 方法详解</tspan></tspan></text></g></svg>